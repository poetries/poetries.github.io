<!DOCTYPE html>


  <html class="dark page-post">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>前端页面性能优化方式 | 前端进阶之旅</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="性能优化,">
  

  <meta name="description" content="一、调试工具1、Network 这里可以看到资源加载详情，初步评估影响页面性能的因素。鼠标右键可以自定义选项卡，页面底部是当前加载资源的一个概览。DOMContentLoaded DOM渲染完成的时间，Load：当前页面所有资源加载完成的时间 思考：如何判断哪些资源对当前页面加载无用，做对应优化？ shift + cmd + P 调出控制台的扩展工具，添加规则  监控页面性能变化  瀑布流wate">
<meta name="keywords" content="性能优化">
<meta property="og:type" content="article">
<meta property="og:title" content="前端页面性能优化方式">
<meta property="og:url" content="http://blog.poetries.top/2021/02/08/fe-youhua/index.html">
<meta property="og:site_name" content="前端进阶之旅">
<meta property="og:description" content="一、调试工具1、Network 这里可以看到资源加载详情，初步评估影响页面性能的因素。鼠标右键可以自定义选项卡，页面底部是当前加载资源的一个概览。DOMContentLoaded DOM渲染完成的时间，Load：当前页面所有资源加载完成的时间 思考：如何判断哪些资源对当前页面加载无用，做对应优化？ shift + cmd + P 调出控制台的扩展工具，添加规则  监控页面性能变化  瀑布流wate">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208102537169.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208102549961.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208102650825.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208102723253.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208102851752.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208102949596.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208103032419.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208103054016.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208103127992.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208103321371.png">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b7ab11fc7b94fcf8c79bd3b28706b2c~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208103918197.png">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7618dea1a4774c8685e9926b08d67fdd~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b543d68fab7445da1dedb72bb224f69~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1df5c32c30494c13b3402305f866b327~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208104535672.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208104641677.png">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3666ae07b9eb4d839f7a893b89d83f47~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a459cc811844b7793aff6c9878d19ad~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208105415279.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208105446451.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208105522277.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208105625448.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208105717958.png">
<meta property="og:image" content="https://blog.poetries.top/img/static/images/image-20210208105747314.png">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7427e9243791461b8ffa49f47981cfba~tplv-k3u1fbpfcp-watermark.image?imageslim">
<meta property="og:image" content="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41557f3a361c4cf899a4eab3bde79154~tplv-k3u1fbpfcp-watermark.image">
<meta property="og:updated_time" content="2025-03-30T13:54:29.462Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端页面性能优化方式">
<meta name="twitter:description" content="一、调试工具1、Network 这里可以看到资源加载详情，初步评估影响页面性能的因素。鼠标右键可以自定义选项卡，页面底部是当前加载资源的一个概览。DOMContentLoaded DOM渲染完成的时间，Load：当前页面所有资源加载完成的时间 思考：如何判断哪些资源对当前页面加载无用，做对应优化？ shift + cmd + P 调出控制台的扩展工具，添加规则  监控页面性能变化  瀑布流wate">
<meta name="twitter:image" content="https://blog.poetries.top/img/static/images/image-20210208102537169.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">
<link href="/css/other.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?5081f3afc8d94338e79d319c8b632b31";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  <!-- 聊天系统 -->
  
    
   <link type="text/css" rel="stylesheet" href="/renxi/default.css">
   <style>
      #modal {
        position: static !important;
      }
      .filter {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background: #fe5757;
        animation: colorChange 30s ease-in-out infinite;
        animation-fill-mode: both;
        mix-blend-mode: overlay;
      }
  
      @keyframes colorChange {
        0%, 100% {
            opacity: 0;
        }
        50% {
            opacity: .9;
        }
      }
   </style>
</head>
</html>
<body>
  
  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/categories/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录<i class="iconfont toc-title" style="display:inline-block;color:#87998d;width:20px;height:20px;">&#xf004b;</i></strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、调试工具"><span class="toc-text">一、调试工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、Network"><span class="toc-text">1、Network</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#瀑布流waterfal"><span class="toc-text">瀑布流waterfal</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、Lighthouse"><span class="toc-text">2、Lighthouse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、Peformance"><span class="toc-text">3、Peformance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、webPageTest"><span class="toc-text">4、webPageTest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、资源打包分析"><span class="toc-text">5、资源打包分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-bundle-analyzer"><span class="toc-text">webpack-bundle-analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开启source-map"><span class="toc-text">开启source-map</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、WEB-API"><span class="toc-text">二、WEB API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、监听视窗激活状态"><span class="toc-text">1、监听视窗激活状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、观察长任务（performance-中Task）"><span class="toc-text">2、观察长任务（performance 中Task）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、监听网络变化"><span class="toc-text">3、监听网络变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、计算DOMContentLoaded时间"><span class="toc-text">4、计算DOMContentLoaded时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、更多计算规则"><span class="toc-text">5、更多计算规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、雅虎军规"><span class="toc-text">三、雅虎军规</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、减少cookie传输"><span class="toc-text">1、减少cookie传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、避免过多的回流与重绘"><span class="toc-text">2、避免过多的回流与重绘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、压缩"><span class="toc-text">四、压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、Gzip"><span class="toc-text">1、Gzip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、服务端压缩"><span class="toc-text">2、服务端压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、JavaScript、Css、Html压缩"><span class="toc-text">3、JavaScript、Css、Html压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、http2首部压缩"><span class="toc-text">4、http2首部压缩</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、webpack优化"><span class="toc-text">五、webpack优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、DllPlugin-提升构建速度"><span class="toc-text">1、DllPlugin 提升构建速度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、splitChunks-拆包"><span class="toc-text">2、splitChunks 拆包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、骨架屏"><span class="toc-text">六、骨架屏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、窗口化"><span class="toc-text">七、窗口化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八、缓存"><span class="toc-text">八、缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、http缓存"><span class="toc-text">1、http缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#keep-alive"><span class="toc-text">keep-alive</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cache-Control-Expires-Max-Age"><span class="toc-text">Cache-Control / Expires / Max-Age</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Etag-If-None-Match"><span class="toc-text">Etag / If-None-Match</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Last-Modified-If-Modified-Since"><span class="toc-text">Last-Modified / If-Modified-Since</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、Service-Worker"><span class="toc-text">2、Service Worker</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九、预加载-amp-amp-懒加载"><span class="toc-text">九、预加载 &amp;&amp; 懒加载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、preload"><span class="toc-text">1、preload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、prefetch"><span class="toc-text">2、prefetch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、懒加载"><span class="toc-text">3、懒加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图片"><span class="toc-text">图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#路由懒加载"><span class="toc-text">路由懒加载</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十、ssr-amp-amp-react-snap"><span class="toc-text">十、ssr &amp;&amp; react-snap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十一、体验优化"><span class="toc-text">十一、体验优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#白屏loading"><span class="toc-text">白屏loading</span></a></li></ol></li></ol>
  </div>
  




<div class="content content-post CENTER">
   <!-- canvas 彩带 -->
<canvas id="evanyou" width="1302" height="678" style="position: fixed;width: 100%;height: 100%;top: 0;left:0;z-index:-1;"></canvas>

<div class="qrcode_container">
  <div class="tencent_code">
    <h4>关注作者公众号</h4> 
    <p>和万千小伙伴一起学习</p> 
    <img src="https://interview.poetries.top/qrcode.jpg" alt="公众号：前端进价之旅">
  </div> 
</div>

<article id="post-fe-youhua" class="article article-type-post" itemprop="blogPost">
  <header class="article-header" style="position:relative;">
    <h1 class="post-title">前端页面性能优化方式</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2021.02.08</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Poetry</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Front-End/">Front-End</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
       
          <span class="post-count">
            <i class="fa fa-file-word-o"></i>&nbsp
            <span>字数统计 3k字</span>
          </span>

          <span class="post-count">
            <i class="fa fa-columns"></i>&nbsp
            <span>阅读时长 13分</span>
          </span>
      
      
    </div>

    <i class="iconfont" id="toc-eye" style="display:inline-block;color:#b36619;position:absolute;top:20px;right:-11px;cursor:pointer;
    font-size: 24px;">&#xe61c;</i>

  </header>

  <div class="article-content">
    
      <div id="container">
        <h2 id="一、调试工具"><a href="#一、调试工具" class="headerlink" title="一、调试工具"></a>一、调试工具</h2><h3 id="1、Network"><a href="#1、Network" class="headerlink" title="1、Network"></a>1、Network</h3><p><img src="https://blog.poetries.top/img/static/images/image-20210208102537169.png" alt="image-20210208102537169"></p>
<p>这里可以看到资源加载详情，初步评估影响<code>页面性能</code>的因素。鼠标右键可以自定义选项卡，页面底部是当前加载资源的一个概览。<code>DOMContentLoaded</code> DOM渲染完成的时间，<code>Load</code>：当前页面所有资源加载完成的时间</p>
<p><strong>思考：如何判断哪些资源对当前页面加载无用，做对应优化？</strong></p>
<p><strong>shift + cmd + P 调出控制台的扩展工具，添加规则</strong></p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208102549961.png" alt="image-20210208102549961"></p>
<p><strong>监控页面性能变化</strong></p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208102650825.png" alt="image-20210208102650825"></p>
<h4 id="瀑布流waterfal"><a href="#瀑布流waterfal" class="headerlink" title="瀑布流waterfal"></a>瀑布流waterfal</h4><p><img src="https://blog.poetries.top/img/static/images/image-20210208102723253.png" alt="image-20210208102723253"></p>
<ul>
<li><p><code>Queueing</code> 浏览器将资源放入队列时间</p>
</li>
<li><p><code>Stalled</code> 因放入队列时间而发生的停滞时间</p>
</li>
<li><p><code>DNS Lookup</code> DNS解析时间</p>
</li>
<li><p><code>Initial connection</code>  建立HTTP连接的时间</p>
</li>
<li><p><code>SSL</code> 浏览器与服务器建立安全性连接的时间</p>
</li>
<li><p><code>TTFB</code> 等待服务端返回数据的时间</p>
</li>
<li><p><code>Content Download</code>  浏览器下载资源的时间</p>
</li>
</ul>
<h3 id="2、Lighthouse"><a href="#2、Lighthouse" class="headerlink" title="2、Lighthouse"></a>2、Lighthouse</h3><p><img src="https://blog.poetries.top/img/static/images/image-20210208102851752.png" alt="image-20210208102851752"></p>
<ul>
<li><code>First Contentful Paint</code> 首屏渲染时间，1s以内绿色</li>
<li><code>Speed Index</code> 速度指数，4s以内绿色</li>
<li><code>Time to Interactive</code> 到页面可交换的时间</li>
</ul>
<blockquote>
<p>根据chrome的一些策略自动对网站做一个质量评估，并且会给出一些优化的建议</p>
</blockquote>
<h3 id="3、Peformance"><a href="#3、Peformance" class="headerlink" title="3、Peformance"></a>3、Peformance</h3><p><img src="https://blog.poetries.top/img/static/images/image-20210208102949596.png" alt="image-20210208102949596"></p>
<p>对网站最专业的分析</p>
<h3 id="4、webPageTest"><a href="#4、webPageTest" class="headerlink" title="4、webPageTest"></a>4、webPageTest</h3><blockquote>
<p>可以模拟不同场景下访问的情况，比如模拟不同浏览器、不同国家等等，在线测试地址：<a href="https://www.webpagetest.org/" target="_blank" rel="noopener">webPageTest</a></p>
</blockquote>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208103032419.png" alt="image-20210208103032419"></p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208103054016.png" alt="image-20210208103054016"></p>
<h3 id="5、资源打包分析"><a href="#5、资源打包分析" class="headerlink" title="5、资源打包分析"></a>5、资源打包分析</h3><h4 id="webpack-bundle-analyzer"><a href="#webpack-bundle-analyzer" class="headerlink" title="webpack-bundle-analyzer"></a>webpack-bundle-analyzer</h4><p><img src="https://blog.poetries.top/img/static/images/image-20210208103127992.png" alt="image-20210208103127992"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install --save-dev webpack-bundle-analyzer</span><br><span class="line"><span class="comment">// webpack.config.js 文件</span></span><br><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> BundleAnalyzerPlugin(&#123;</span><br><span class="line">          analyzerMode: <span class="string">'server'</span>,</span><br><span class="line">          analyzerHost: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">          analyzerPort: <span class="number">8889</span>,</span><br><span class="line">          reportFilename: <span class="string">'report.html'</span>,</span><br><span class="line">          defaultSizes: <span class="string">'parsed'</span>,</span><br><span class="line">          openAnalyzer: <span class="literal">true</span>,</span><br><span class="line">          generateStatsFile: <span class="literal">false</span>,</span><br><span class="line">          statsFilename: <span class="string">'stats.json'</span>,</span><br><span class="line">          statsOptions: <span class="literal">null</span>,</span><br><span class="line">          logLevel: <span class="string">'info'</span></span><br><span class="line">        &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">"analyz"</span>: <span class="string">"NODE_ENV=production npm_config_report=true npm run build"</span></span><br></pre></td></tr></table></figure>
<h4 id="开启source-map"><a href="#开启source-map" class="headerlink" title="开启source-map"></a>开启source-map</h4><blockquote>
<p> <code>webpack.config.js</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &apos;production&apos;,</span><br><span class="line">    devtool: &apos;hidden-source-map&apos;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>package.json</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"analyze"</span>: <span class="string">"source-map-explorer 'build/*.js'"</span>,</span><br></pre></td></tr></table></figure>
<p>npm run analyze</p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208103321371.png" alt="image-20210208103321371"></p>
<h2 id="二、WEB-API"><a href="#二、WEB-API" class="headerlink" title="二、WEB API"></a>二、WEB API</h2><p>工欲善其事，必先利其器。浏览器提供的一些分析API<code>至关重要</code></p>
<h3 id="1、监听视窗激活状态"><a href="#1、监听视窗激活状态" class="headerlink" title="1、监听视窗激活状态"></a>1、监听视窗激活状态</h3><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b7ab11fc7b94fcf8c79bd3b28706b2c~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 窗口激活状态监听</span></span><br><span class="line"><span class="keyword">let</span> vEvent = <span class="string">'visibilitychange'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.webkitHidden != <span class="literal">undefined</span>) &#123;</span><br><span class="line">    vEvent = <span class="string">'webkitvisibilitychange'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">visibilityChanged</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.hidden || <span class="built_in">document</span>.webkitHidden) &#123;</span><br><span class="line">        <span class="built_in">document</span>.title = <span class="string">'客官，别走啊~'</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Web page is hidden."</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.title = <span class="string">'客官，你又回来了呢~'</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Web page is visible."</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(vEvent, visibilityChanged, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>其实有很多隐藏的api，这里大家有兴趣的可以去试试看：</p>
<h3 id="2、观察长任务（performance-中Task）"><a href="#2、观察长任务（performance-中Task）" class="headerlink" title="2、观察长任务（performance 中Task）"></a>2、观察长任务（performance 中Task）</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> PerformanceObserver(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> list.getEntries()) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(entry)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">observer.observe(&#123;<span class="attr">entryTypes</span>: [<span class="string">'longtask'</span>]&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3、监听网络变化"><a href="#3、监听网络变化" class="headerlink" title="3、监听网络变化"></a>3、监听网络变化</h3><p>网络变化时给用户反馈网络问题，有时候看直播的时候自己的网络卡顿，直播平台也会提醒你或者自动给你切换清晰度</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;</span><br><span class="line"><span class="keyword">var</span> type = connection.effectiveType;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateConnectionStatus</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Connection type changed from "</span> + type + <span class="string">" to "</span> + connection.effectiveType);</span><br><span class="line">  type = connection.effectiveType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">connection.addEventListener(<span class="string">'change'</span>, updateConnectionStatus);</span><br></pre></td></tr></table></figure>
<h3 id="4、计算DOMContentLoaded时间"><a href="#4、计算DOMContentLoaded时间" class="headerlink" title="4、计算DOMContentLoaded时间"></a>4、计算DOMContentLoaded时间</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, (event) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> timing = performance.getEntriesByType(<span class="string">'navigation'</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">console</span>.log(timing.domInteractive);</span><br><span class="line">    <span class="built_in">console</span>.log(timing.fetchStart);</span><br><span class="line">    <span class="keyword">let</span> diff = timing.domInteractive - timing.fetchStart;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"TTI: "</span> + diff);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="5、更多计算规则"><a href="#5、更多计算规则" class="headerlink" title="5、更多计算规则"></a>5、更多计算规则</h3><ul>
<li><code>DNS</code> 解析耗时: <code>domainLookupEnd - domainLookupStart</code></li>
<li><code>TCP</code> 连接耗时: <code>connectEnd - connectStart</code></li>
<li><code>SSL</code> 安全连接耗时: <code>connectEnd - secureConnectionStart</code></li>
<li>网络请求耗时 (<code>TTFB</code>): <code>responseStart - requestStart</code></li>
<li>数据传输耗时: <code>responseEnd - responseStart</code></li>
<li><code>DOM</code> 解析耗时: <code>domInteractive - responseEnd</code></li>
<li>资源加载耗时:<code>loadEventStart - domContentLoadedEventEnd</code></li>
<li><code>First Byte</code>时间: <code>responseStart - domainLookupStart</code></li>
<li>白屏时间: <code>responseEnd - fetchStart</code></li>
<li>首次可交互时间: <code>domInteractive - fetchStart</code></li>
<li><code>DOM Ready</code> 时间: <code>domContentLoadEventEnd - fetchStart</code></li>
<li>页面完全加载时间: <code>loadEventStart - fetchStart</code></li>
<li><code>http</code> 头部大小： <code>transferSize - encodedBodySize</code></li>
<li>重定向次数：<code>performance.navigation.redirectCount</code></li>
<li>重定向耗时: <code>redirectEnd - redirectStart</code></li>
</ul>
<h2 id="三、雅虎军规"><a href="#三、雅虎军规" class="headerlink" title="三、雅虎军规"></a>三、雅虎军规</h2><p>关于雅虎军规，你知道的有多少条，平时写用到的又有哪些？针对以下规则，我们可以做很多优化工作</p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208103918197.png" alt="image-20210208103918197"></p>
<h3 id="1、减少cookie传输"><a href="#1、减少cookie传输" class="headerlink" title="1、减少cookie传输"></a>1、减少cookie传输</h3><blockquote>
<p> <code>cookie</code>传输会造成带宽浪费，可以：</p>
</blockquote>
<ul>
<li>减少<code>cookie</code>中存储的东西</li>
<li>静态资源不需要<code>cookie</code>，可以采用其他的域名，不会主动带上<code>cookie</code></li>
</ul>
<h3 id="2、避免过多的回流与重绘"><a href="#2、避免过多的回流与重绘" class="headerlink" title="2、避免过多的回流与重绘"></a>2、避免过多的回流与重绘</h3><p>连续触发页面回流操作</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cards = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"MuiPaper-rounded"</span>);</span><br><span class="line"><span class="keyword">const</span> update = <span class="function">(<span class="params">timestamp</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;cards.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> top = cards[i].offsetTop;</span><br><span class="line">    cards[i].style.width = ((<span class="built_in">Math</span>.sin(cards[i].offsetTop + timestamp / <span class="number">100</span> + <span class="number">1</span>) * <span class="number">500</span>) + <span class="string">'px'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">window</span>.requestAnimationFrame(update)</span><br><span class="line">&#125;</span><br><span class="line">update(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>看下效果，很明显的卡顿</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7618dea1a4774c8685e9926b08d67fdd~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<blockquote>
<p><code>performance</code>分析结果，<code>load</code>事件之后存在大量的回流，并且<code>chrome</code>都给标记了红色</p>
</blockquote>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b543d68fab7445da1dedb72bb224f69~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<blockquote>
<p>使用<code>fastDom</code>进行优化，将对dom的<code>读和写</code>分离，合并</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> cards = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"MuiPaper-rounded"</span>);</span><br><span class="line">  <span class="keyword">const</span> update = <span class="function">(<span class="params">timestamp</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cards.length; i++) &#123;</span><br><span class="line">      fastdom.measure(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> top = cards[i].offsetTop;</span><br><span class="line">        fastdom.mutate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          cards[i].style.width =</span><br><span class="line">            <span class="built_in">Math</span>.sin(top + timestamp / <span class="number">100</span> + <span class="number">1</span>) * <span class="number">500</span> + <span class="string">"px"</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">window</span>.requestAnimationFrame(update)</span><br><span class="line">  &#125;</span><br><span class="line">  update(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1df5c32c30494c13b3402305f866b327~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<blockquote>
<p><code>performance</code>分析结果，load事件之后也没有了那么多的红色标记</p>
</blockquote>
<p>感兴趣的可以去了解一下fastDom：<a href="https://github.com/wilsonpage/fastdom" target="_blank" rel="noopener">github fastdom</a> 在线预览：<a href="http://wilsonpage.github.io/fastdom/examples/animation.html" target="_blank" rel="noopener">fastdom demo</a></p>
<p>关于任务拆分与组合的思想，<code>react fiber</code>架构做的很牛逼，有兴趣的可以去了解一下调度算法在fiber中的实践</p>
<h2 id="四、压缩"><a href="#四、压缩" class="headerlink" title="四、压缩"></a>四、压缩</h2><h3 id="1、Gzip"><a href="#1、Gzip" class="headerlink" title="1、Gzip"></a>1、Gzip</h3><p>开启方式可参考：<a href="https://juejin.cn/post/6844903605187641357" target="_blank" rel="noopener">nginx开启gzip</a></p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208104535672.png" alt="image-20210208104535672"></p>
<blockquote>
<p> 还有一种方式：打包的时候生成gz文件，上传到服务器端，这样就不需要nginx来压缩了，可以降低服务器压力。 可参考：<a href="https://segmentfault.com/a/1190000020976930" target="_blank" rel="noopener">gzip压缩文件&amp;webPack配置Compression-webpack-plugin</a></p>
</blockquote>
<h3 id="2、服务端压缩"><a href="#2、服务端压缩" class="headerlink" title="2、服务端压缩"></a>2、服务端压缩</h3><p>server.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> compression = <span class="built_in">require</span>(<span class="string">'compression'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(compression());</span><br><span class="line">app.use(express.static(<span class="string">'build'</span>));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'*'</span>, (req,res) =&gt;&#123;</span><br><span class="line">    res.sendFile(path.join(__dirname+<span class="string">'/build/index.html'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> listener = app.listen(process.env.PORT || <span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Listening on port <span class="subst">$&#123;listener.address().port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>package.json</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;start&quot;: &quot;npm run build &amp;&amp; node server.js&quot;,</span><br></pre></td></tr></table></figure>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208104641677.png" alt="image-20210208104641677"></p>
<h3 id="3、JavaScript、Css、Html压缩"><a href="#3、JavaScript、Css、Html压缩" class="headerlink" title="3、JavaScript、Css、Html压缩"></a>3、JavaScript、Css、Html压缩</h3><p>工程化项目中直接使用对应的插件即可，webpack的主要有下面三个：</p>
<ul>
<li><code>UglifyJS</code></li>
<li><code>webpack-parallel-uglify-plugin</code></li>
<li><code>terser-webpack-plugin</code></li>
</ul>
<blockquote>
<p> 具体优缺点可参考：<a href="https://blog.csdn.net/qq_24147051/article/details/103557728" target="_blank" rel="noopener">webpack常用的三种JS压缩插件</a>。<code>压缩原理</code>简单的讲就是去除一些空格、换行、注释，借助es6模块化的功能，做了一些<code>tree-shaking</code>的优化。同时做了一些代码混淆，一方面是为了更小的体积，另一方面也是为了源码的安全性。</p>
</blockquote>
<p>css压缩主要是<code>mini-css-extract-plugin</code>，当然前面的js压缩插件也会给你做好css压缩。使用姿势</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br><span class="line">const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;);</span><br><span class="line">plugins:[</span><br><span class="line"> new MiniCssExtractPlugin(&#123;</span><br><span class="line">       filename: &quot;[name].css&quot;,</span><br><span class="line">       chunkFilename: &quot;[id].css&quot;</span><br><span class="line">   &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>html压缩可以用<code>HtmlWebpackPlugin</code>，单页项目就一个index.html,性能提升微乎其微~</p>
<h3 id="4、http2首部压缩"><a href="#4、http2首部压缩" class="headerlink" title="4、http2首部压缩"></a>4、http2首部压缩</h3><p><strong>http2的特点</strong></p>
<ul>
<li>二进制分帧</li>
<li>首部压缩</li>
<li>流量控制</li>
<li>多路复用</li>
<li>请求优先级</li>
<li>服务器推送<code>http2_push: &#39;xxx.jpg&#39;</code></li>
</ul>
<p>具体升级方式也很简单，修改一下<code>nginx</code>配置，方法请自行<code>Google</code></p>
<h2 id="五、webpack优化"><a href="#五、webpack优化" class="headerlink" title="五、webpack优化"></a>五、webpack优化</h2><p>上文中也提到了部分webpack插件，下面我再来看看还有哪些~</p>
<h3 id="1、DllPlugin-提升构建速度"><a href="#1、DllPlugin-提升构建速度" class="headerlink" title="1、DllPlugin 提升构建速度"></a>1、DllPlugin 提升构建速度</h3><blockquote>
<p>通过<code>DllPlugin</code>插件，将一些比较大的，基本很少升级的包拆分出来，生成<code>xx.dll.js</code>文件,通过<code>manifest.json</code>引用</p>
</blockquote>
<p>webpack.dll.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        react: [<span class="string">"react"</span>, <span class="string">"react-dom"</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">"[name].dll.js"</span>,</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">"dll"</span>),</span><br><span class="line">        library: <span class="string">"[name]"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">            name: <span class="string">"[name]"</span>,</span><br><span class="line">            path: path.resolve(__dirname, <span class="string">"dll/[name].manifest.json"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>package.json</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dll-build&quot;: &quot;NODE_ENV=production webpack --config webpack.dll.config.js&quot;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<blockquote>
<p>webpack4不需要配置dll了，因为webpack4打包性能已经足够优化，vue-cli3都已经移除<code>dll</code></p>
</blockquote>
<h3 id="2、splitChunks-拆包"><a href="#2、splitChunks-拆包" class="headerlink" title="2、splitChunks 拆包"></a>2、splitChunks 拆包</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            cacheGroups: &#123;</span><br><span class="line">                vendor: &#123;</span><br><span class="line">                    name: <span class="string">'vendor'</span>,</span><br><span class="line">                    test: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    minSize: <span class="number">0</span>,</span><br><span class="line">                    minChunks: <span class="number">1</span>,</span><br><span class="line">                    priority: <span class="number">10</span>,</span><br><span class="line">                    chunks: <span class="string">'initial'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                common: &#123;</span><br><span class="line">                    name: <span class="string">'common'</span>,</span><br><span class="line">                    test: <span class="regexp">/[\\/]src[\\/]/</span>,</span><br><span class="line">                    chunks: <span class="string">'all'</span>,</span><br><span class="line">                    minSize: <span class="number">0</span>,</span><br><span class="line">                    minChunks: <span class="number">2</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h2 id="六、骨架屏"><a href="#六、骨架屏" class="headerlink" title="六、骨架屏"></a>六、骨架屏</h2><blockquote>
<p>用css提前占好位置，当资源加载完成即可填充，减少页面的回流与重绘，同时还能给用户最直接的反馈。 图中使用插件：<a href="https://github.com/buildo/react-placeholder" target="_blank" rel="noopener">react-placeholder</a></p>
</blockquote>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3666ae07b9eb4d839f7a893b89d83f47~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<p>关于实现骨架屏还有很多种方案，用<code>Puppeteer</code>服务端渲染的挺多的</p>
<p>使用css伪类：<a href="https://segmentfault.com/a/1190000020437426" target="_blank" rel="noopener">只要css就能实现的骨架屏方案</a></p>
<h2 id="七、窗口化"><a href="#七、窗口化" class="headerlink" title="七、窗口化"></a>七、窗口化</h2><blockquote>
<p>原理：只加载当前窗口能显示的DOM元素，当视图变化时，删除隐藏的，添加要显示的DOM就可以保证页面上存在的dom元素数量永远不多，页面就不会卡顿</p>
</blockquote>
<p>图中使用的插件：<a href="https://github.com/bvaughn/react-window" target="_blank" rel="noopener">react-window</a></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a459cc811844b7793aff6c9878d19ad~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<p>安装：<code>npm i react-window</code></p>
<p>引入：<code>import { FixedSizeList as List } from &#39;react-window&#39;;</code></p>
<p>使用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Row = (&#123; index, style &#125;) =&gt; (</span><br><span class="line">  &lt;div style=&#123;style&#125;&gt;Row &#123;index&#125;&lt;/div&gt;</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line">const Example = () =&gt; (</span><br><span class="line">  &lt;List</span><br><span class="line">    height=&#123;150&#125;</span><br><span class="line">    itemCount=&#123;1000&#125;</span><br><span class="line">    itemSize=&#123;35&#125;</span><br><span class="line">    width=&#123;300&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;Row&#125;</span><br><span class="line">  &lt;/List&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="八、缓存"><a href="#八、缓存" class="headerlink" title="八、缓存"></a>八、缓存</h2><h3 id="1、http缓存"><a href="#1、http缓存" class="headerlink" title="1、http缓存"></a>1、http缓存</h3><h4 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h4><p>判断是否开启：看<code>response headers</code>中有没有<code>Connection: keep-alive</code> 。开启以后，看<code>network</code>的瀑布流中就没有 <code>Initial connection</code>耗时了</p>
<p><code>nginx</code>设置<code>keep-alive</code>（默认开启）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 0 为关闭</span><br><span class="line">#keepalive_timeout 0;</span><br><span class="line"># 65s无连接 关闭</span><br><span class="line">keepalive_timeout 65;</span><br><span class="line"># 连接数，达到100断开</span><br><span class="line">keepalive_requests 100;</span><br></pre></td></tr></table></figure>
<h4 id="Cache-Control-Expires-Max-Age"><a href="#Cache-Control-Expires-Max-Age" class="headerlink" title="Cache-Control / Expires / Max-Age"></a>Cache-Control / Expires / Max-Age</h4><p>设置资源是否缓存，以及缓存时间</p>
<h4 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag / If-None-Match"></a>Etag / If-None-Match</h4><p>资源唯一标识作对比，如果有变化，从服务器拉取资源。如果没变化则取缓存资源，状态码304，也就是协商缓存</p>
<h4 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified / If-Modified-Since"></a>Last-Modified / If-Modified-Since</h4><p>通过对比时间的差异来觉得要不要从服务器获取资源</p>
<p>更多HTTP缓存参数可参考：<a href="https://harttle.land/2017/04/04/using-http-cache.html" target="_blank" rel="noopener">使用 HTTP 缓存：Etag, Last-Modified 与 Cache-Control</a></p>
<h3 id="2、Service-Worker"><a href="#2、Service-Worker" class="headerlink" title="2、Service Worker"></a>2、Service Worker</h3><blockquote>
<p>借助webpack插件<code>WorkboxWebpackPlugin</code>和<code>ManifestPlugin</code>,加载serviceWorker.js,通过<code>serviceWorker.register()</code>注册</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class="line">    clientsClaim: <span class="literal">true</span>,</span><br><span class="line">    exclude: [<span class="regexp">/\.map$/</span>, /asset-manifest\.json$/],</span><br><span class="line">    importWorkboxFrom: <span class="string">'cdn'</span>,</span><br><span class="line">    navigateFallback: paths.publicUrlOrPath + <span class="string">'index.html'</span>,</span><br><span class="line">    navigateFallbackBlacklist: [</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'^/_'</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'/[^/?]+\\.[^/]+$'</span>),</span><br><span class="line">    ],</span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> ManifestPlugin(&#123;</span><br><span class="line">    fileName: <span class="string">'asset-manifest.json'</span>,</span><br><span class="line">    publicPath: paths.publicUrlOrPath,</span><br><span class="line">    generate: <span class="function">(<span class="params">seed, files, entrypoints</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> manifestFiles = files.reduce(<span class="function">(<span class="params">manifest, file</span>) =&gt;</span> &#123;</span><br><span class="line">            manifest[file.name] = file.path;</span><br><span class="line">            <span class="keyword">return</span> manifest;</span><br><span class="line">        &#125;, seed);</span><br><span class="line">        <span class="keyword">const</span> entrypointFiles = entrypoints.app.filter(</span><br><span class="line">            fileName =&gt; !fileName.endsWith(<span class="string">'.map'</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            files: manifestFiles,</span><br><span class="line">            entrypoints: entrypointFiles,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208105415279.png" alt="image-20210208105415279"></p>
<h2 id="九、预加载-amp-amp-懒加载"><a href="#九、预加载-amp-amp-懒加载" class="headerlink" title="九、预加载 &amp;&amp; 懒加载"></a>九、预加载 &amp;&amp; 懒加载</h2><h3 id="1、preload"><a href="#1、preload" class="headerlink" title="1、preload"></a>1、preload</h3><p>就拿demo中的字体举例，正常情况下的加载顺序是这样的：</p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208105446451.png" alt="image-20210208105446451"></p>
<p>加入preload：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">href</span>=<span class="string">"https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.119.woff2"</span> <span class="attr">as</span>=<span class="string">"font"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">href</span>=<span class="string">"https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.118.woff2"</span> <span class="attr">as</span>=<span class="string">"font"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"preload"</span> <span class="attr">href</span>=<span class="string">"https://fonts.gstatic.com/s/longcang/v5/LYjAdGP8kkgoTec8zkRgqHAtXN-dRp6ohF_hzzTtOcBgYoCKmPpHHEBiM6LIGv3EnKLjtw.116.woff2"</span> <span class="attr">as</span>=<span class="string">"font"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208105522277.png" alt="image-20210208105522277"></p>
<h3 id="2、prefetch"><a href="#2、prefetch" class="headerlink" title="2、prefetch"></a>2、prefetch</h3><blockquote>
<p> 场景：首页不需要这样的字体文件，下个页面需要：首页会以最低优先级<code>Lowest</code>来提前加载</p>
</blockquote>
<p>加入<code>prefetch</code>：</p>
<p>需要的页面，从<code>prefetch cache</code>中取</p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208105625448.png" alt="image-20210208105625448"></p>
<p>webpack也是支持这两个属性的:<a href="https://www.cnblogs.com/skychx/p/webpack-webpackChunkName-webpackPreload-webpackPreload.html" target="_blank" rel="noopener">webpackPrefetch 和 webpackPreload</a></p>
<h3 id="3、懒加载"><a href="#3、懒加载" class="headerlink" title="3、懒加载"></a>3、懒加载</h3><h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><p>机械图片</p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208105717958.png" alt="image-20210208105717958"></p>
<p><code>渐进式图片（类似高斯模糊）</code> 需要UI小姐姐出稿的时候指定这种格式</p>
<p><img src="https://blog.poetries.top/img/static/images/image-20210208105747314.png" alt="image-20210208105747314"></p>
<p><code>响应式图片</code></p>
<p>原生模式：<code>&lt;img src=&quot;./img/index.jpg&quot; sizes=&quot;100vw&quot; srcset=&quot;./img/dog.jpg 800w, ./img/index.jpg 1200w&quot;/&gt;</code></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7427e9243791461b8ffa49f47981cfba~tplv-k3u1fbpfcp-watermark.image?imageslim" alt="img"></p>
<h4 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h4><p>通过<code>函数 + import</code>实现</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Page404 = () =&gt; import(/* webpackChunkName: &quot;error&quot; */&apos;@views/errorPage/404&apos;);</span><br></pre></td></tr></table></figure>
<h2 id="十、ssr-amp-amp-react-snap"><a href="#十、ssr-amp-amp-react-snap" class="headerlink" title="十、ssr &amp;&amp; react-snap"></a>十、ssr &amp;&amp; react-snap</h2><ul>
<li>服务端渲染<code>SSR</code>，vue使用<code>nuxt.js</code>，<code>react</code>使用<code>next.js</code></li>
<li><code>react-snap</code>可以借助<code>Puppeteer</code>实现先渲染单页，然后保留<code>DOM</code>，发送到客户端</li>
</ul>
<h2 id="十一、体验优化"><a href="#十一、体验优化" class="headerlink" title="十一、体验优化"></a>十一、体验优化</h2><h3 id="白屏loading"><a href="#白屏loading" class="headerlink" title="白屏loading"></a>白屏loading</h3><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41557f3a361c4cf899a4eab3bde79154~tplv-k3u1fbpfcp-watermark.image" alt="img"></p>
<p><strong>loading.html</strong> 需要自取哦，还有种方式，使用<code>webpack</code>插件<code>HtmlWebpackPlugin</code>将loading资源插入到页面中</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Loading<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      body &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-id">#loadding</span> &#123;</span></span><br><span class="line">        position: fixed;</span><br><span class="line">        top: 0;</span><br><span class="line">        bottom: 0;</span><br><span class="line">        display: flex;</span><br><span class="line">        width: 100%;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: center;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-id">#loadding</span> &gt; <span class="selector-tag">span</span> &#123;</span></span><br><span class="line">        display: inline-block;</span><br><span class="line">        width: 8px;</span><br><span class="line">        height: 100%;</span><br><span class="line">        margin-right: 5px;</span><br><span class="line">        border-radius: 4px;</span><br><span class="line"><span class="css">        <span class="selector-tag">-webkit-animation</span>: <span class="selector-tag">load</span> 1<span class="selector-class">.04s</span> <span class="selector-tag">ease</span> <span class="selector-tag">infinite</span>;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">animation</span>: <span class="selector-tag">load</span> 1<span class="selector-class">.04s</span> <span class="selector-tag">ease</span> <span class="selector-tag">infinite</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      @<span class="keyword">keyframes</span> load &#123;</span></span><br><span class="line">        0%,</span><br><span class="line">        100% &#123;</span><br><span class="line">          height: 40px;</span><br><span class="line"><span class="css">          <span class="selector-tag">background</span>: <span class="selector-id">#98beff</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">        50% &#123;</span><br><span class="line">          height: 60px;</span><br><span class="line">          margin-top: -20px;</span><br><span class="line"><span class="css">          <span class="selector-tag">background</span>: <span class="selector-id">#3e7fee</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"loadding"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"animation-delay: 0.13s"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"animation-delay: 0.26s"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"animation-delay: 0.39s"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"animation-delay: 0.52s"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> $loadding = <span class="built_in">document</span>.getElementById(<span class="string">"loadding"</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (!$loadding) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      $loadding.style.display = <span class="string">"none"</span>;</span></span><br><span class="line">      $loadding.parentNode.removeChild($loadding);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

      </div>
    
  </div>

</article>

<!-- <button class="assist-btn2 circle" id="assist_btn2" title="点亮屏幕" style="left: 27px; top: 152px;">
  <i class="iconfont" style="display:inline-block;color:red;width:20px;height:20px;">&#xe61d;</i>
</button>
<button class="assist-btn1 circle" id="assist_btn1" title="关闭屏幕亮度" style="left: 27px; top: 152px;">
  <i class="iconfont toc-title" style="display:inline-block;color:red;width:20px;height:20px;">&#xe61d;</i>
</button> -->


<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>	

<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
  function getCookie(key) {
    if (document.cookie.length > 0) {
      var start = document.cookie.indexOf(key + "=");
      if (start !== -1) {
        start = start + key.length + 1;
        var end = document.cookie.indexOf(";", start);
        if (end === -1) end = document.cookie.length;
        return unescape(document.cookie.substring(start, end));
      }
    }
    return "";
  }
  const feToken = getCookie('fe-token');
  const btw = new BTWPlugin();
  console.log('ft', feToken)
  if(!feToken) {
    btw.init({
      id: "container",
      blogId: "22699-1592137983091-414",
      name: "前端进阶之旅",
      qrcode: "https://poetries1.gitee.io/img-repo/2020/06/qrcode.jpg",
      keyword: "3a3b3c",
    });
  }
</script>

<script type="text/javascript">

// white theme
var body = {color: "#555", background: "#000"};
var a_tag = {color: "#222"};
var header = { background: "#222"};
var logo_line_i = {background: "#222"};
// var post_code = {background: "#eee", color: "#222"};

function switch_theme() {
 $("body").css(body);
 $("a:not('.links-of-author-item a, .site-state-item a, .site-state-posts a, .feed-link a, .motion-element a, .post-tags a, .show-commit-cls a, #donate_board a')").css(a_tag);
 $(".header, .footer").css(header);
 $(".logo-line-before i, .logo-line-after i").css(logo_line_i);
 //$(".post code").css(post_code);
 $("#idhyt-surprise-ball #idhyt-surprise-ball-animation .drag").css(a_tag);
 $(".post-title-link, .posts-expand .post-meta, .post-comments-count, .disqus-comment-count, .post-category a, .post-nav-next a, .post-nav-item a").css(a_tag);
 
 // $("code").css({color: '#c5c8c6', background: '#1d1f21'});
 //$("#assist_btn1").hide(1500);
}

$(function () {
$("#assist_btn2").css("display","none");
 $("#assist_btn1").click(function() {
     switch_theme();
$("div#toc.toc-article").css({
 "background":"#eaeaea",
 "opacity":1
});
$(".toc-article ol").show();
$("#toc.toc-article .toc-title").css("color","#a98602");
$("#assist_btn1").css("display","none");
$("#assist_btn2").css("display","block");
 });
$("#assist_btn2").click(function() {
$("#assist_btn2").css("display","none");
$("#assist_btn1").css("display","block");
$("body").css("background","url(http://www.miaov.com/static/ie/images/news/bg.png)")
     $(".header, .footer").css("background","url(http://www.miaov.com/static/ie/images/news/bg.png)")
$(".toc-article ol").toggle(1000);
 });
});


//背景随机

var Y, O, E, L, B, C, T, z, N, S, A, I;
!function() {
var e = function() {
for (O.clearRect(0, 0, L, B), T = [{
x: 0,
y: .7 * B + C
}, {
x: 0,
y: .7 * B - C
}]; T[1].x < L + C;) t(T[0], T[1])
}, t = function(e, t) {
O.beginPath(), O.moveTo(e.x, e.y), O.lineTo(t.x, t.y);
var n = t.x + (2 * I() - .25) * C,
 r = a(t.y);
O.lineTo(n, r), O.closePath(), N -= S / -50, O.fillStyle = "#" + (127 * A(N) + 128 << 16 | 127 * A(N + S / 3) + 128 << 8 | 127 * A(N + S / 3 * 2) + 128).toString(16), O.fill(), T[0] = T[1], T[1] = {
 x: n,
 y: r
}
}, a = function n(e) {
var t = e + (2 * I() - 1.1) * C;
return t > B || t < 0 ? n(e) : t
};
Y = document.getElementById("evanyou"), O = Y.getContext("2d"), E = window.devicePixelRatio || 1, L = window.innerWidth, B = window.innerHeight, C = 90, z = Math, N = 0, S = 2 * z.PI, A = z.cos, I = z.random, Y.width = L * E, Y.height = B * E, O.scale(E, E), O.globalAlpha = .6, document.onclick = e, document.ontouchstart = e, e()
}()

   
$("#toc-eye").click(function(){
$("#toc.toc-article").toggle(1000);
});

</script>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持poetries</div>
        <ul>
        
          <li class="item">
            
              <span>微信扫一扫</span>
            
            <img src="/images/weixin.jpg" alt="">
          </li>
        
          <li class="item">
            
              <span>支付宝扫一扫</span>
            
            <img src="/images/zhifubao.jpg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2021/02/08/nginx-try-files/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2021/02/08/rxjs-summary/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/categories/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

<!-- Gitalk评论插件通用代码 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
const gitalk = new Gitalk({
  clientID: '5567a2c4abb858009d96',
  clientSecret: 'b9039ec056cf5c2346b3cdb63308a28c163f91e5',
  repo: 'poetries.github.io',
  owner: 'poetries',
  // 在这里设置一下截取前50个字符串, 这是因为 github 对 label 的长度有了要求, 如果超过
  // 50个字符串则会报错.
  // id: location.pathname.split('/').pop().substring(0, 49),
  id: location.pathname,
  admin: ['poetries'],
  // facebook-like distraction free mode
  distractionFreeMode: false
})
gitalk.render('gitalk-container')
</script>
<!-- Gitalk代码结束 -->



  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>


  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/clicklove.js"></script>
 
  
</body>
</html>
