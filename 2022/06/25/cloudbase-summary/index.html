<!DOCTYPE html>


  <html class="dark page-post">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>云开发cloudbase实践总结 | 前端进阶之旅</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="部署,云开发,">
  

  <meta name="description" content="一、关于云开发介绍云开发与serverless的区别  Serverless Framework 是无服务器应用框架，提供将云函数SCF、API 网关、对象存储 COS、云数据库 DB 等资源组合的业务框架，开发者可以直接基于框架编写业务逻辑，而无需关注底层资源的配置和管理。 云开发（Tencent CloudBase，TCB）是腾讯云提供的云原生一体化开发环境和工具平台，为开发者提供高可用、自动">
<meta name="keywords" content="部署,云开发">
<meta property="og:type" content="article">
<meta property="og:title" content="云开发cloudbase实践总结">
<meta property="og:url" content="http://blog.poetries.top/2022/06/25/cloudbase-summary/index.html">
<meta property="og:site_name" content="前端进阶之旅">
<meta property="og:description" content="一、关于云开发介绍云开发与serverless的区别  Serverless Framework 是无服务器应用框架，提供将云函数SCF、API 网关、对象存储 COS、云数据库 DB 等资源组合的业务框架，开发者可以直接基于框架编写业务逻辑，而无需关注底层资源的配置和管理。 云开发（Tencent CloudBase，TCB）是腾讯云提供的云原生一体化开发环境和工具平台，为开发者提供高可用、自动">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/97bfb6a300ede8cb.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4a9fa09df00ae121.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/f91fc2a56fd7d19f.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/111082e4a79965b8.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3cae71f70a9723d2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4cccec9f4013b9aa.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/6b018bec4591c9aa.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c9016bdd4a84dac4.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/00b5a9d585e5f5ee.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d83d3bfc9b7d025b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/417413944366f8e2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/efa5ad40c4f22218.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/0f6c3726e168a64b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/0afa72546600b36a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/14072565a7df9cfc.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4c5a0f883f8093dd.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/7f14d68f7629334e.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d3b9aed0b63bb50b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c4dc431bcd542129.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/2437d329c6b5e767.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/88eb3713574d7f1b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/8f3777524f8f6e77.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/705a1f9853edda3a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/840a923b27e4ee59.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/7f14d68f7629334e.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/cd6fa613aa0ba32c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/08f8a4eed05f40c3.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/68112e40d3a20d26.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/015d7200d6f0ed7b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/aafc37032a793f1c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/e95ddf99a0e2939c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3404d8f9e5a8d4cf.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/b34c3d3acc92627a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/501a1e7be7791960.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/f49d51410d41a7e2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d8b255edaee3b012.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/46c9989ef1cea582.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3404d8f9e5a8d4cf.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4bf8025e0f47dce5.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c81cf50a598dd81f.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/bdff32d173347663.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d5760279a4e8d4b9.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/75fe3a786ac2f19b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/8dfd1a122cf97ef9.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/88c3a1a2a39dab05.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3dbf8e6a924809df.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d9590e7139fec14a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c6f20fd79e5cf432.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3404d8f9e5a8d4cf.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/befa9164c6b90b3f.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/0d8163e0ab3193ec.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/bf6484c27c260614.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/6d0258075bf46615.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/acd1fb389d6c9a6d.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/e4eac02d22f679e0.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/40bd0c9ceadc339e.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/7215d3f021c80ef9.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3731b6c2de7002eb.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3e69b0ecfb4b5b1c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/627d5a83ca20f2ae.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/2f3e27804bd7105b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c2500d4d92e0da5e.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/e287aea2c9821cc4.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/966fc0e7f631cba5.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/50d7e5c2d8654dff.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/ad02ca3fac62bdec.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4af41bcbd091b686.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c34f69c797a05e2b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/569a41e7e44d4911.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/fb0f146a969d6506.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/f09f236c850cdbc6.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/8a0f9b7b169f862a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/2e99b96c91ea6bf4.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/bc8ba28de42ff604.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/fd5954cd15c3e0e9.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/45dad89cf73176e3.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/8cab74708230b661.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/b09bcd56a8afaba5.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/79fedf80af936261.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d64d37ed50ab8a11.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/8398b4d1b46da096.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/6e62d9caf3ead536.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c0077a6f7d345269.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/2fe16d3cb23b86fe.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c274c86297e0037e.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d0ea2cb4f67df0a8.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/7841d0aab3b6def2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/7164c1d025fed2f2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/f6436c7624819c45.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/27161771a757fa8c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/fd07b75bb7e5dfb9.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/715c72c283832c56.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/b474aafabd470e8e.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/5fda60ae03e5f96c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/eb1db5b08062b46c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/f475b1efc04f182a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/fa0e23cb97283134.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/0078ed499a50ee78.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/ae2ae82d69b699f2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/eb3ef08b8ab0bc95.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/b00248881e212a34.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/1ff5d829ce888659.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/a4850b81e9666030.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/5f57eee40dfb7381.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/f298c715b04eaf35.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/87fbb479196de69b.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/d937a67646160b02.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/39a38172b39daa80.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4f48480646204dd2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/6742f2c96f05ad0e.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/ac2eddfa13237bd9.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/107b9e3f346af8a5.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/eaad8e647a753095.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4b866be7e0bf7cfe.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c9c7dc7c0ebba705.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/c15711674e3c175d.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/17ff255d213e43ac.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/065be64fc55c529a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/ea112b0d249492c2.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/8c672f52136b621a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/710cbc17f21b8d93.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/534042fe753270f5.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/44a89633db979007.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/48a0980a8ea7075a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/359d527fd134c1a3.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/a066957524d06f9d.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/19a698c8050fa3eb.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/3fefbba31221042c.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/26f7c1f886045461.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/33b9b9370a87a245.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/e083278e128641d0.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/2baff45a779d611a.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/4ba6ed3a0a6541da.png">
<meta property="og:image" content="https://s.poetries.work/uploads/2022/06/81875bb480c85e7d.png">
<meta property="og:updated_time" content="2025-03-30T13:54:29.456Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="云开发cloudbase实践总结">
<meta name="twitter:description" content="一、关于云开发介绍云开发与serverless的区别  Serverless Framework 是无服务器应用框架，提供将云函数SCF、API 网关、对象存储 COS、云数据库 DB 等资源组合的业务框架，开发者可以直接基于框架编写业务逻辑，而无需关注底层资源的配置和管理。 云开发（Tencent CloudBase，TCB）是腾讯云提供的云原生一体化开发环境和工具平台，为开发者提供高可用、自动">
<meta name="twitter:image" content="https://s.poetries.work/uploads/2022/06/97bfb6a300ede8cb.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">
<link href="/css/other.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?5081f3afc8d94338e79d319c8b632b31";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  <!-- 聊天系统 -->
  
    
   <link type="text/css" rel="stylesheet" href="/renxi/default.css">
   <style>
      #modal {
        position: static !important;
      }
      .filter {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background: #fe5757;
        animation: colorChange 30s ease-in-out infinite;
        animation-fill-mode: both;
        mix-blend-mode: overlay;
      }
  
      @keyframes colorChange {
        0%, 100% {
            opacity: 0;
        }
        50% {
            opacity: .9;
        }
      }
   </style>
</head>
</html>
<body>
  
  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/categories/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录<i class="iconfont toc-title" style="display:inline-block;color:#87998d;width:20px;height:20px;">&#xf004b;</i></strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、关于云开发介绍"><span class="toc-text">一、关于云开发介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、使用云开发创建一个nestjs项目"><span class="toc-text">二、使用云开发创建一个nestjs项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、使用脚手架的方式创建"><span class="toc-text">三、使用脚手架的方式创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-安装"><span class="toc-text">3.1 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-登录"><span class="toc-text">3.2 登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-创建项目"><span class="toc-text">3.3 创建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-环境"><span class="toc-text">3.4 环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#动态变量"><span class="toc-text">动态变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#环境变量"><span class="toc-text">环境变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-云函数操作"><span class="toc-text">3.5 云函数操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#函数配置cloudbaserc-json"><span class="toc-text">函数配置cloudbaserc.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署"><span class="toc-text">部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#管理云函数"><span class="toc-text">管理云函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#触发器"><span class="toc-text">触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码更新"><span class="toc-text">代码更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数版本"><span class="toc-text">函数版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#函数日志"><span class="toc-text">函数日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署示例"><span class="toc-text">部署示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-静态网站托管"><span class="toc-text">3.6 静态网站托管</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、云开发登录鉴权"><span class="toc-text">四、云开发登录鉴权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-登录鉴权"><span class="toc-text">4.1 登录鉴权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#管理用户"><span class="toc-text">管理用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#账户关联"><span class="toc-text">账户关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#最佳实践"><span class="toc-text">最佳实践</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-登录方式"><span class="toc-text">4.2 登录方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#匿名登录"><span class="toc-text">匿名登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#未登录"><span class="toc-text">未登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#邮箱登录"><span class="toc-text">邮箱登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#微信授权登录"><span class="toc-text">微信授权登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义登录"><span class="toc-text">自定义登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用户名密码登录"><span class="toc-text">用户名密码登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#短信验证码登录"><span class="toc-text">短信验证码登录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、CloudBase-Framework一体化部署（推荐方式）"><span class="toc-text">五、CloudBase Framework一体化部署（推荐方式）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-云开发应用介绍"><span class="toc-text">5.1 云开发应用介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-cloudbase-framework配置文件"><span class="toc-text">5.2 cloudbase framework配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-插件"><span class="toc-text">5.3 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#静态网站插件"><span class="toc-text">静态网站插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#云函数插件"><span class="toc-text">云函数插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#登录鉴权插件"><span class="toc-text">登录鉴权插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#云数据库插件"><span class="toc-text">云数据库插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#微信小程序插件"><span class="toc-text">微信小程序插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Node-插件"><span class="toc-text">Node 插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#云托管容器插件"><span class="toc-text">云托管容器插件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-一键部署按钮制作"><span class="toc-text">5.4 一键部署按钮制作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-云开发部署应用演示"><span class="toc-text">5.5 云开发部署应用演示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#云开发部署Egg"><span class="toc-text">云开发部署Egg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#云开发部署Koa"><span class="toc-text">云开发部署Koa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#云开发部署React"><span class="toc-text">云开发部署React</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#云开发部署Vue"><span class="toc-text">云开发部署Vue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署hexo"><span class="toc-text">部署hexo</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、使用云开发部署web应用"><span class="toc-text">六、使用云开发部署web应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-部署hexo"><span class="toc-text">6.1 部署hexo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-部署Vue"><span class="toc-text">6.2 部署Vue</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、在云开发中使用NoSQL数据库"><span class="toc-text">七、在云开发中使用NoSQL数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八、在VS-Code中使用Toolkit管理云开发项目"><span class="toc-text">八、在VS Code中使用Toolkit管理云开发项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-基本使用介绍"><span class="toc-text">8.1 基本使用介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-云函数操作"><span class="toc-text">8.2 云函数操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-静态网站"><span class="toc-text">8.3 静态网站</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九、cloudBase之CMS内容管理系统"><span class="toc-text">九、cloudBase之CMS内容管理系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-控制台部署CMS"><span class="toc-text">9.1 控制台部署CMS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-如有二次修改，我们可以使用源码方式部署"><span class="toc-text">9.2 如有二次修改，我们可以使用源码方式部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#项目结构"><span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装依赖"><span class="toc-text">安装依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装失败"><span class="toc-text">安装失败</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#本地开发"><span class="toc-text">本地开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#微应用开发"><span class="toc-text">微应用开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Resful-API-形式访问"><span class="toc-text">Resful API 形式访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-微信开发者工具部署"><span class="toc-text">9.3 微信开发者工具部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十、云开发部署腾讯微搭低代码"><span class="toc-text">十、云开发部署腾讯微搭低代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十一、参考文档"><span class="toc-text">十一、参考文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参考文档"><span class="toc-text">参考文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#社区提问"><span class="toc-text">社区提问</span></a></li></ol></li></ol>
  </div>
  




<div class="content content-post CENTER">
   <!-- canvas 彩带 -->
<canvas id="evanyou" width="1302" height="678" style="position: fixed;width: 100%;height: 100%;top: 0;left:0;z-index:-1;"></canvas>

<div class="qrcode_container">
  <div class="tencent_code">
    <h4>关注作者公众号</h4> 
    <p>和万千小伙伴一起学习</p> 
    <img src="https://interview.poetries.top/qrcode.jpg" alt="公众号：前端进价之旅">
  </div> 
</div>

<article id="post-cloudbase-summary" class="article article-type-post" itemprop="blogPost">
  <header class="article-header" style="position:relative;">
    <h1 class="post-title">云开发cloudbase实践总结</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2022.06.25</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Poetry</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Front-End/">Front-End</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
       
          <span class="post-count">
            <i class="fa fa-file-word-o"></i>&nbsp
            <span>字数统计 19.3k字</span>
          </span>

          <span class="post-count">
            <i class="fa fa-columns"></i>&nbsp
            <span>阅读时长 77分</span>
          </span>
      
      
    </div>

    <i class="iconfont" id="toc-eye" style="display:inline-block;color:#b36619;position:absolute;top:20px;right:-11px;cursor:pointer;
    font-size: 24px;">&#xe61c;</i>

  </header>

  <div class="article-content">
    
      <div id="container">
        <h2 id="一、关于云开发介绍"><a href="#一、关于云开发介绍" class="headerlink" title="一、关于云开发介绍"></a>一、关于云开发介绍</h2><p><strong>云开发与serverless的区别</strong></p>
<ul>
<li><code>Serverless Framework</code> 是无服务器应用框架，提供将云函数<code>SCF</code>、<code>API</code> 网关、对象存储 <code>COS</code>、云数据库 <code>DB</code> 等资源组合的业务框架，开发者可以直接基于框架编写业务逻辑，而无需关注底层资源的配置和管理。</li>
<li>云开发（<code>Tencent CloudBase，TCB</code>）是腾讯云提供的云原生一体化开发环境和工具平台，为开发者提供高可用、自动弹性扩缩的后端云服务，包含计算、存储、托管等 <code>serverless</code> 化能力，可用于云端一体化开发多种端应用（小程序、公众号、<code>Web</code> 应用、<code>Flutter</code> 客户端等），帮助开发者统一构建和管理后端服务和云资源，避免了应用开发过程中繁琐的服务器搭建及运维，开发者可以专注于业务逻辑的实现，开发门槛更低，效率更高。</li>
<li><strong>二者最大的区别是</strong>：给开发者使用的平台支持不一样，云开发支持web端、QQ、微信小程序级静态网站托管等这些平台服务。</li>
</ul>
<h2 id="二、使用云开发创建一个nestjs项目"><a href="#二、使用云开发创建一个nestjs项目" class="headerlink" title="二、使用云开发创建一个nestjs项目"></a>二、使用云开发创建一个nestjs项目</h2><p>在产品中选择云开发产品</p>
<p><img src="https://s.poetries.work/uploads/2022/06/97bfb6a300ede8cb.png" alt></p>
<blockquote>
<p>创建一个项目, 这里要选择好区域，下次创建了项目，区域不一样，可能项目就看不到</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/4a9fa09df00ae121.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/f91fc2a56fd7d19f.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/111082e4a79965b8.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/3cae71f70a9723d2.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/4cccec9f4013b9aa.png" alt></p>
<h2 id="三、使用脚手架的方式创建"><a href="#三、使用脚手架的方式创建" class="headerlink" title="三、使用脚手架的方式创建"></a>三、使用脚手架的方式创建</h2><h3 id="3-1-安装"><a href="#3-1-安装" class="headerlink" title="3.1 安装"></a>3.1 安装</h3><p>全局安装脚手架包<a href="https://docs.cloudbase.net/cli-v1/quick-start" target="_blank" rel="noopener">官方地址</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i -g @cloudbase/cli</span><br></pre></td></tr></table></figure>
<blockquote>
<p>为了简化输入，cloudbase 命令可以简写成 tcb</p>
</blockquote>
<p>测试安装是否成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb -v</span><br></pre></td></tr></table></figure>
<p>查看命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb -h</span><br></pre></td></tr></table></figure>
<h3 id="3-2-登录"><a href="#3-2-登录" class="headerlink" title="3.2 登录"></a>3.2 登录</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># CloudBase CLI 会自动打开云开发控制台获取授权，您需要点击同意授权按钮允许 CloudBase CLI 获取授权。如您没有登录，您需要登录后才能进行此操作。</span><br><span class="line"></span><br><span class="line">tcb login</span><br></pre></td></tr></table></figure>
<p>也可以使用下面的方式通过 API 秘钥直接登录，避免交互式输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb login --apiKeyId xxx --apiKey xxx</span><br></pre></td></tr></table></figure>
<h3 id="3-3-创建项目"><a href="#3-3-创建项目" class="headerlink" title="3.3 创建项目"></a>3.3 创建项目</h3><p>本地创建项目</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcb new [options] [appName] [templateUri]</span><br><span class="line"><span class="comment"># 比如</span></span><br><span class="line">tcb new nest-cloundbase nest-starter</span><br></pre></td></tr></table></figure>
<blockquote>
<p>云开发项目是和云开发环境资源关联的实体，云开发项目聚合了云函数、数据库、文件存储等服务，您可以在云开发项目中编写函数，存储文件，并通过 CloudBase 快速的操作您的云函数、文件存储、数据库等资源。</p>
</blockquote>
<p><strong>云开发项目文件结构：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── .gitignore</span><br><span class="line">├── functions // 云函数目录</span><br><span class="line">│   └── node-app</span><br><span class="line">│       └── index.js</span><br><span class="line">└── cloudbaserc.json // 项目配置文件</span><br></pre></td></tr></table></figure>
<p>选择自己已经创建的环境,如果没有就 创建新环境,这时候会打开浏览器</p>
<p><img src="https://s.poetries.work/uploads/2022/06/6b018bec4591c9aa.png" alt></p>
<p>本地打开项目并且安装依赖包</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
<p>部署到线上</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 调用 tcb framework deploy</span></span><br><span class="line">npm run deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/c9016bdd4a84dac4.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/00b5a9d585e5f5ee.png" alt></p>
<p>部署完成后可以使用 <code>tcb fn list</code> 命令查看已经部署完成的函数列表</p>
<p><img src="https://s.poetries.work/uploads/2022/06/d83d3bfc9b7d025b.png" alt></p>
<h3 id="3-4-环境"><a href="#3-4-环境" class="headerlink" title="3.4 环境"></a>3.4 环境</h3><p><strong>查看所有环境</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb env list</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/417413944366f8e2.png" alt></p>
<p><strong>安全域名</strong></p>
<blockquote>
<p>当您需要在网页应用中使用云开发的身份验证服务时，您需要将您的网站的域名（发起请求的页面的域名）加入安全域名名单中。安全域名是云开发服务认可的用户请求来源域名，所有来自非安全域名名单中的请求都不会被响应。</p>
</blockquote>
<p>使用下面的命令查看所有配置的安全域名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb env domain list</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/efa5ad40c4f22218.png" alt></p>
<p>新增安全域名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 添加一个域名</span><br><span class="line">tcb env domain create www.xxx.com</span><br><span class="line"></span><br><span class="line"># 添加多个域名</span><br><span class="line">tcb env domain create www.domain1.com/www.domain2.com/www.domain3.com</span><br></pre></td></tr></table></figure>
<p>删除安全域名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb env domain delete</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/0f6c3726e168a64b.png" alt></p>
<p><strong>登录方式</strong></p>
<blockquote>
<p>当您需要使用云开发的身份验证服务时，您需要配置您想使用的登录方式。目前云开发支持自定义登录、微信公众平台、微信开放平台登录等多种登录方式。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 您可以使用下面的命令列出环境配置的登录方式列表，查看环境配置的登录方式，以及相关的状态。</span><br><span class="line"></span><br><span class="line">tcb env login list</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/0afa72546600b36a.png" alt></p>
<p>您可以使用下面的命令新建登录方式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb env login create</span><br></pre></td></tr></table></figure>
<blockquote>
<p>您需要选择配置的平台，登录方式状态，以及对应的 AppId 和 AppSecret，登录方式请选择启用。在添加方式时不会校验 AppId 和 AppSecret 的有效性，只有在请求时，AppId 和 AppSecret 才会被校验，所以请确保您添加的 AppId 和 AppSecret 是有效的。</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/14072565a7df9cfc.png" alt></p>
<p>修改登录方式</p>
<blockquote>
<p>您也可以使用 <code>tcb env login update</code> 修改已经配置的登录方式，如切换启用状态，修改 AppId 和 AppSecret。</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/4c5a0f883f8093dd.png" alt></p>
<h4 id="动态变量"><a href="#动态变量" class="headerlink" title="动态变量"></a>动态变量</h4><blockquote>
<p>在 <code>cloudbaserc.json</code> 中声明 <code>&quot;version&quot;: &quot;2.0&quot;</code> 即可启用新的特性，新版配置文件只支持 JSON 格式</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 动态变量特性允许在 `cloudbaserc.json` 配置文件中使用动态变量，从环境变量或其他数据源获取动态的数据。使用 `&#123;&#123;&#125;&#125;` 包围的值定义为动态变量，可以引用数据源中的值。如下所示</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"envId"</span>,</span><br><span class="line">  <span class="string">"functionRoot"</span>: <span class="string">"./functions"</span>,</span><br><span class="line">  <span class="string">"functions"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"&#123;&#123;variable&#125;&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>CloudBase 支持使用 <code>.env</code> 类型文件作为主要数据源，使用不同的后缀区分不同的阶段、场景，如 <code>.env.development</code> 可以表示开发阶段的配置，<code>.env.production</code> 可以表示生产环境的配置</p>
<blockquote>
<p>当指定 <code>--mode [mode]</code> 时，会再加载 <code>.env.[mode]</code> 文件，并按照如下的顺序合并覆盖同名变量：<code>.env.[mode] &gt; .env.local &gt; .env</code> 即 <code>.env.[mode]</code> 中的同名变量会覆盖 <code>.env.local</code> 和 <code>.env</code> 文件中的同名变量</p>
</blockquote>
<blockquote>
<p>当使用 <code>tcb framework deploy --mode test</code> 命令时，会自动加载 <code>.env</code>，<code>.env.local</code> 以及 <code>.env.test</code> 等三个文件中的环境变量合并使用。</p>
</blockquote>
<p>我们建议你将秘钥等私密配置放在 <code>.env.local</code> 文件中，并将 <code>.env.local</code> 加入 <code>.gitignore</code> 配置中</p>
<p>如 <code>.env.local</code> 文件中存在以下变量</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DB_HOST = localhost</span><br><span class="line">DB_USER = root</span><br><span class="line">DB_PASSWORD = s1mpl3</span><br></pre></td></tr></table></figure>
<p>则可以在配置文件中使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">  <span class="string">"functionRoot"</span>: <span class="string">"./functions"</span>,</span><br><span class="line">  <span class="string">"functions"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"test"</span>,</span><br><span class="line">      <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">        <span class="string">"PASSWORD"</span>: <span class="string">"&#123;&#123;env.DB_PASSWORD&#125;&#125;"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-5-云函数操作"><a href="#3-5-云函数操作" class="headerlink" title="3.5 云函数操作"></a>3.5 云函数操作</h3><h4 id="函数配置cloudbaserc-json"><a href="#函数配置cloudbaserc-json" class="headerlink" title="函数配置cloudbaserc.json"></a>函数配置cloudbaserc.json</h4><p>参考配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/cli/functions/configs</span></span><br><span class="line"><span class="comment">// https://docs.cloudbase.net/cli-v1/functions/configs</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// version 表示当前配置文件的版本，目前支持的版本号有："2.0"。当 version 字段不存在时，默认当前配置文件为 "1.0" 版本。</span></span><br><span class="line">  <span class="string">"version"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="comment">// 关联环境 ID</span></span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"dev-xxxx"</span>,</span><br><span class="line">  <span class="string">"functionRoot"</span>: <span class="string">"./functions"</span>, <span class="comment">// 云函数函数代码存放的文件夹路径，相对于根目录的路径。</span></span><br><span class="line">  <span class="comment">// region 指定了当前环境的地域信息，上海地域的环境可以不填，其他地域的环境则必须填写。</span></span><br><span class="line">  <span class="string">"region"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="comment">// 函数配置项组成的数组</span></span><br><span class="line">  <span class="string">"functions"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// functions 文件夹下函数文件夹的名称，即函数名</span></span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"app"</span>,</span><br><span class="line">      <span class="comment">// 超时时间，单位：秒 S</span></span><br><span class="line">      <span class="string">"timeout"</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="comment">// 环境变量</span></span><br><span class="line">      <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">        <span class="string">"key"</span>: <span class="string">"value"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 私有网络配置，如果不使用私有网络，可不配置</span></span><br><span class="line">      <span class="string">"vpc"</span>: &#123;</span><br><span class="line">        <span class="comment">// vpc id</span></span><br><span class="line">        <span class="string">"vpcId"</span>: <span class="string">"vpc-xxx"</span>,</span><br><span class="line">        <span class="comment">// 子网 id</span></span><br><span class="line">        <span class="string">"subnetId"</span>: <span class="string">"subnet-xxx"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 运行时，目前可选运行包含：Nodejs8.9, Nodejs10.15, Php7, Java8</span></span><br><span class="line">      <span class="comment">// 此参数可以省略，默认为 Nodejs10.15</span></span><br><span class="line">      <span class="string">"runtime"</span>: <span class="string">"Nodejs10.15"</span>,</span><br><span class="line">      <span class="comment">// 是否云端安装依赖，仅支持 Node.js 项目</span></span><br><span class="line">      <span class="string">"installDependency"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 函数触发器，说明见文档: https://cloud.tencent.com/document/product/876/32314</span></span><br><span class="line">      <span class="string">"triggers"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// name: 触发器的名字</span></span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"myTrigger"</span>,</span><br><span class="line">          <span class="comment">// type: 触发器类型，目前仅支持 timer （即定时触发器）</span></span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"timer"</span>,</span><br><span class="line">          <span class="comment">// config: 触发器配置，在定时触发器下，config 格式为 cron 表达式</span></span><br><span class="line">          <span class="string">"config"</span>: <span class="string">"0 0 2 1 * * *"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 函数处理入口，Node.js 和 PHP 项目可以省略，默认值为 index.main</span></span><br><span class="line">      <span class="comment">// 因 Java 的 handler 配置较为特殊，所以当运行时为 Java 时，handler 不能省略</span></span><br><span class="line">      <span class="comment">// 如：package.Class::mainHandler</span></span><br><span class="line">      <span class="string">"handler"</span>: <span class="string">"index.main"</span>,</span><br><span class="line">      <span class="comment">// functions:invoke 本地触发云函数时的调用参数</span></span><br><span class="line">      <span class="string">"params"</span>: &#123;&#125;,</span><br><span class="line">      <span class="comment">// 部署/更新云函数时忽略的文件</span></span><br><span class="line">      <span class="string">"ignore"</span>: [</span><br><span class="line">        <span class="comment">// 忽略 markdown 文件</span></span><br><span class="line">        <span class="string">"*.md"</span>,</span><br><span class="line">        <span class="comment">// 忽略 node_modules 文件夹</span></span><br><span class="line">        <span class="string">"node_modules"</span>,</span><br><span class="line">        <span class="string">"node_modules/**/*"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面为目前所有支持的配置项</p>
<table>
<thead>
<tr>
<th>配置项</th>
<th>是否必填</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>是</td>
<td>String</td>
<td>云函数名称，即为函数部署后的名称</td>
</tr>
<tr>
<td>params</td>
<td>否</td>
<td>Object/JSONObject</td>
<td>CIL 调用云函数时的函数入参</td>
</tr>
<tr>
<td>triggers</td>
<td>否</td>
<td><a href="https://docs.cloudbase.net/cli-v1/functions/configs#cloudfunctiontrigger" target="_blank" rel="noopener"><code>Array</code></a></td>
<td>触发器配置</td>
</tr>
<tr>
<td>handler</td>
<td>否</td>
<td>String</td>
<td>函数处理方法名称，名称格式支持“文件名称.函数名称”形式</td>
</tr>
<tr>
<td>ignore</td>
<td>否</td>
<td><code>String/Array&lt;String&gt;</code></td>
<td>部署/更新云函数代码时的忽略文件，支持 glob 匹配规则</td>
</tr>
<tr>
<td>timeout</td>
<td>否</td>
<td>Number</td>
<td>函数超时时间（1 - 60S）</td>
</tr>
<tr>
<td>envVariables</td>
<td>否</td>
<td>Object</td>
<td>包含环境变量的键值对对象</td>
</tr>
<tr>
<td>vpc</td>
<td>否</td>
<td><a href="https://docs.cloudbase.net/cli-v1/functions/configs#vpc" target="_blank" rel="noopener">VPC</a></td>
<td>私有网络配置</td>
</tr>
<tr>
<td>runtime</td>
<td>否</td>
<td>String</td>
<td>运行时环境配置，可选值： <code>Nodejs8.9, Nodejs10.15 Php7, Java8</code></td>
</tr>
<tr>
<td>memorySize</td>
<td>否</td>
<td>Number</td>
<td>函数内存，默认值为 256，可选 128、256、512、1024、2048</td>
</tr>
<tr>
<td>installDependency</td>
<td>否</td>
<td>Boolean</td>
<td>是否云端安装依赖，目前仅支持 Node.js</td>
</tr>
<tr>
<td>codeSecret</td>
<td>否</td>
<td>String</td>
<td>代码加密秘钥，格式为 36 位大小写字母、数字</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>注：<code>runtime</code> 默认为 <code>Nodejs10.15</code>，使用 Node.js 运行时可不填，使用 Php 和 Java 则必填。</strong></li>
<li><strong>启用代码加密后，将无法在小程序 IDE、腾讯云控制台中查看云函数的代码和信息</strong></li>
</ul>
<p><strong>CloudFunctionTrigger</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>是否必填</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>是</td>
<td>String</td>
<td>触发器名称</td>
</tr>
<tr>
<td>type</td>
<td>是</td>
<td>String</td>
<td>触发器类型，可选值：timer</td>
</tr>
<tr>
<td>config</td>
<td>是</td>
<td>String</td>
<td>触发器配置，在定时触发器下，config 格式为 cron 表达式</td>
</tr>
</tbody>
</table>
<p><strong>VPC</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>是否必填</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>vpcId</td>
<td>是</td>
<td>String</td>
<td>VPC Id</td>
</tr>
<tr>
<td>subnetId</td>
<td>是</td>
<td>String</td>
<td>VPC 子网 Id</td>
</tr>
</tbody>
</table>
<p><strong>更新函数运行时配置</strong></p>
<blockquote>
<p>创建函数式，Cloudbase CLI 会为函数提供一些默认的配置，所以您不需要添加配置信息也可以直接部署函数。您也可以通过下面的命令修改函数的运行时配置</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 更新 app 函数的配置</span><br><span class="line">tcb fn config update app</span><br><span class="line"></span><br><span class="line"># 更新配置文件中所有函数的配置信息</span><br><span class="line">tcb fn config update</span><br></pre></td></tr></table></figure>
<p>目前支持修改的函数配置包含超时时间 <code>timeout</code>、环境变量 <code>envVariables</code>、运行时 <code>runtime</code>，vpc网络以及 <code>installDependency</code> 等选项。</p>
<p>CloudBase CLI 会从配置文件中读取函数的配置信息并更新，CloudBase CLI 会更新配置文件中存在的函数的所有配置，暂不支持指定更新单个配置选项。</p>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><blockquote>
<p><code>fn deploy</code> 命令部署函数的文件大小总计不能超过 <code>50 M</code>，否则可能会部署失败。</p>
</blockquote>
<p>在一个包含 <code>cloudbaserc.json</code> 配置文件的项目下，您可以直接使用下面的命令部署云函数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb fn deploy &lt;functionName&gt;</span><br></pre></td></tr></table></figure>
<p>使用 <code>fn deploy</code> 时，<code>functionName</code> 选项是可以省略的，当 <code>functionName</code> 省略时，Cloudbase CLI 会部署配置文件中的全部函数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 部署配置文件中的全部函数</span></span><br><span class="line">tcb fn deploy</span><br></pre></td></tr></table></figure>
<p>全部参数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Usage: tcb fn deploy [options] [name]</span><br><span class="line"></span><br><span class="line">部署云函数</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -e, --envId &lt;envId&gt;         环境 Id</span><br><span class="line">  --code-secret &lt;codeSecret&gt;  传入此参数将保护代码，格式为 36 位大小写字母和数字</span><br><span class="line">  --force                     如果存在同名函数，上传后覆盖同名函数</span><br><span class="line">  --path &lt;path&gt;               自动创建HTTP 访问服务访问路径</span><br><span class="line">  --all                       部署配置文件中的包含的全部云函数</span><br><span class="line">  --dir &lt;dir&gt;                 指定云函数的文件夹路径</span><br><span class="line">  -h, --help                  查看命令帮助信息</span><br></pre></td></tr></table></figure>
<p><strong>默认选项</strong></p>
<p>Cloudbase CLI 为 Node.js 云函数提供了默认选项，您在部署 Node.js 云函数时可以不用指定云函数的配置，使用默认配置即可部署云函数。</p>
<p>云函数默认配置：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  // 超时时间 5S</span><br><span class="line">  "timeout": 5,</span><br><span class="line">  // 运行时</span><br><span class="line">  "runtime": "Nodejs10.15",</span><br><span class="line">  // 自动安装依赖</span><br><span class="line">  "installDependency": true,</span><br><span class="line">  // 处理入口</span><br><span class="line">  "handler": "index.main",</span><br><span class="line">  // 忽略 node_modules 目录</span><br><span class="line">  "ignore": ["node_modules", "node_modules/**/*", ".git"]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>deploy 命令做了啥</strong></p>
<p><code>fn deploy</code> 会读取 <code>cloudbaserc.json</code> 文件中指定函数的配置，并完成以下几项工作</p>
<ul>
<li>将函数打包成压缩文件，并上传函数代码。</li>
<li>部署函数配置，包括超时时间、网络配置等。</li>
<li>部署函数触发器。</li>
</ul>
<h4 id="管理云函数"><a href="#管理云函数" class="headerlink" title="管理云函数"></a>管理云函数</h4><ul>
<li>您可以使用下面的命令列出所有云函数，查看函数的基本信息：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb fn list</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/7f14d68f7629334e.png" alt></p>
<ul>
<li>指定返回条数和偏移量</li>
</ul>
<blockquote>
<p>默认情况下，<code>fn list</code> 命令只会列出前 <code>20</code> 个函数，如果您的函数较多，需要列出其他的函数，您可以通过下面的选项指定命令返回的数据长度以及数据的偏移量：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-l, --limit &lt;limit&gt;    返回数据长度，默认值为 20</span><br><span class="line">-o, --offset &lt;offset&gt;  数据偏移量，默认值为 0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 返回前 10 个函数的信息</span><br><span class="line">tcb fn list -l 10</span><br><span class="line"># 返回第 3 - 22 个函数的信息（包含 3 和 22）</span><br><span class="line">tcb fn list -l 20 -o 2</span><br></pre></td></tr></table></figure>
<ul>
<li>下载云函数代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb fn code download &lt;functionName&gt; [destPath]</span><br></pre></td></tr></table></figure>
<p>默认情况下，函数代码会下载到 <code>functionRoot</code> 下，以函数名称作为存储文件夹，您可以指定函数存放的文件夹地址，函数的所有代码文件会直接下载到指定的文件夹中。</p>
<p><img src="https://s.poetries.work/uploads/2022/06/d3b9aed0b63bb50b.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/c4dc431bcd542129.png" alt></p>
<ul>
<li>查看函数详情</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 查看 vue-echo 函数的详情</span><br><span class="line">tcb fn detail vue-echo</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/2437d329c6b5e767.png" alt></p>
<ul>
<li>删除函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 删除 app 函数</span><br><span class="line">tcb fn delete app</span><br><span class="line"></span><br><span class="line"># 删除配置文件中的所有的函数</span><br><span class="line">tcb fn delete</span><br></pre></td></tr></table></figure>
<ul>
<li>复制函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 复制 app 函数为 app2 函数</span><br><span class="line">tcb fn copy app app2</span><br></pre></td></tr></table></figure>
<h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><p>触发器是按照一定规则触发函数的模块的抽象，CloudBase 云函数目前仅支持定时触发器。</p>
<blockquote>
<p>如果云函数需要定时/定期执行，即定时触发，您可以使用云函数定时触发器。已配置定时触发器的云函数，会在相应时间点被自动触发，函数的返回结果不会返回给调用方。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">  <span class="string">"functions"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// triggers 字段是触发器数组，目前仅支持一个触发器，即数组只能填写一个，不可添加多个</span></span><br><span class="line">      <span class="string">"triggers"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// name: 触发器的名字，规则见下方说明</span></span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"myTrigger"</span>,</span><br><span class="line">          <span class="comment">// type: 触发器类型，目前仅支持 timer （即定时触发器）</span></span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"timer"</span>,</span><br><span class="line">          <span class="comment">// config: 触发器配置，在定时触发器下，config 格式为 cron 表达式，规则见下方说明</span></span><br><span class="line">          <span class="string">"config"</span>: <span class="string">"0 0 2 1 * * *"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>创建函数触发器</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 创建 app 函数配置的触发器</span><br><span class="line">tcb fn trigger create app</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Cloudbase CLI 会自动读取 <code>cloudbaserc.json</code> 文件中指定函数配置的定时触发器，并创建云函数触发器。如果配置文件中没有包含触发器配置，则会创建失败。</p>
</blockquote>
<p>一个函数可以包含多个触发器，一个触发器包含了以下 3 个主要信息：<code>name</code>, <code>type</code>, <code>config</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// name: 触发器的名字，规则见下方说明</span></span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"myTrigger"</span>,</span><br><span class="line">  <span class="comment">// type: 触发器类型，目前仅支持 timer （即定时触发器）</span></span><br><span class="line">  <span class="string">"type"</span>: <span class="string">"timer"</span>,</span><br><span class="line">  <span class="comment">// config: 触发器配置，在定时触发器下，config 格式为 cron 表达式</span></span><br><span class="line">  <span class="string">"config"</span>: <span class="string">"0 0 2 1 * * *"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当没有指定函数名时，Cloudbase CLI 会创建 <code>cloudbaserc.json</code> 文件包含的所有函数的所有触发器</p>
<p><strong>删除函数触发器</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 删除 app 函数的名为 trigger 的触发器</span><br><span class="line">tcb fn trigger delete app trigger</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当没有指定函数名时，Cloudbase CLI 会删除 <code>cloudbaserc.json</code> 文件包含的所有函数的所有触发器。当只指定了函数名时，Cloudbase CLI 会删除指定函数的所有触发器，当同时指定了函数名称和触发器名称时，Cloudbase CLI 只会删除指定的触发器。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 删除 cloudbaserc.json 文件中所有函数的所有触发器</span></span><br><span class="line">tcb fn trigger delete</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除函数 app 的所有触发器</span></span><br><span class="line">tcb fn trigger delete app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除函数 app 的触发器 trigger</span></span><br><span class="line">tcb fn trigger delete app trigger</span><br></pre></td></tr></table></figure>
<p><strong>触发器规则</strong></p>
<ul>
<li>定时触发器名称（name） ：最大支持 <code>60</code> 个字符，支持 <code>a-z</code>, <code>A-Z</code>, <code>0-9</code>, <code>-</code> 和 <code>_</code>。必须以字母开头，且一个函数下不支持同名的多个定时触发器。</li>
<li>定时触发器触发周期（config）：指定的函数触发时间。填写自定义标准的 Cron 表达式来决定何时触发函数。有关 Cron 表达式的更多信息，请参考以下内容。</li>
</ul>
<p>Cron 表达式有七个必需字段，按空格分隔。其中，每个字段都有相应的取值范围：</p>
<table>
<thead>
<tr>
<th>排序</th>
<th>字段</th>
<th>值</th>
<th>通配符</th>
</tr>
</thead>
<tbody>
<tr>
<td>第一位</td>
<td>秒</td>
<td>0 - 59 的整数</td>
<td><code>, - * /</code></td>
</tr>
<tr>
<td>第二位</td>
<td>分钟</td>
<td>0 - 59 的整数</td>
<td><code>, - * /</code></td>
</tr>
<tr>
<td>第三位</td>
<td>小时</td>
<td>0 - 23 的整数</td>
<td><code>, - * /</code></td>
</tr>
<tr>
<td>第四位</td>
<td>日</td>
<td>1 - 31 的整数（需要考虑月的天数）</td>
<td><code>, - * /</code></td>
</tr>
<tr>
<td>第五位</td>
<td>月</td>
<td>1 - 12 的整数或 JAN、FEB、MAR、APR、MAY、JUN、JUL、AUG、SEP、OCT、NOV 和 DEC</td>
<td><code>, - * /</code></td>
</tr>
<tr>
<td>第六位</td>
<td>星期</td>
<td>0 - 6 的整数或 MON、TUE、WED、THU、FRI、SAT 和 SUN，其中 0 指周日，1 指星期一，以此类推</td>
<td><code>, - * /</code></td>
</tr>
<tr>
<td>第七位</td>
<td>年</td>
<td>1970 - 2099 的整数</td>
<td><code>, - * /</code></td>
</tr>
</tbody>
</table>
<p><strong>通配符</strong></p>
<table>
<thead>
<tr>
<th>通配符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>，</code>（逗号）</td>
<td>代表取用逗号隔开的字符的并集。例如：在“小时”字段中 1，2，3 表示 1 点、2 点和 3 点</td>
</tr>
<tr>
<td><code>-</code>（短横线）</td>
<td>包含指定范围的所有值。例如：在“日”字段中，1 - 15 包含指定月份的 1 号到 15 号</td>
</tr>
<tr>
<td><code>*</code>（星号）</td>
<td>表示所有值。在“小时”字段中，<code>*</code> 表示每个小时</td>
</tr>
<tr>
<td><code>/</code>（正斜杠）</td>
<td>指定增量。在“分钟”字段中，输入 1/10 以指定从第一分钟开始的每隔十分钟重复。例如，第 11 分钟、第 21 分钟和第 31 分钟，以此类推</td>
</tr>
</tbody>
</table>
<blockquote>
<p>!在 Cron 表达式中的“日”和“星期”字段同时指定值时，两者为“或”关系，即两者的条件均生效。</p>
</blockquote>
<p><strong>下面列举一些 <code>Cron</code> 表达式和相关含义：</strong></p>
<ul>
<li><code>*/5 * * * * * *</code> 表示每 5 秒触发一次</li>
<li><code>0 0 2 1 * * *</code> 表示在每月的 1 日的凌晨 2 点触发</li>
<li><code>0 15 10 * * MON-FRI *</code> 表示在周一到周五每天上午 10:15 触发</li>
<li><code>0 0 10,14,16 * * * *</code> 表示在每天上午 10 点，下午 2 点，下午 4 点触发</li>
<li><code>0 */30 9-17 * * * *</code> 表示在每天上午 9 点到下午 5 点内每半小时触发</li>
<li><code>0 0 12 * * WED *</code> 表示在每个星期三中午 12 点触发</li>
</ul>
<h4 id="代码更新"><a href="#代码更新" class="headerlink" title="代码更新"></a>代码更新</h4><p>当您的函数代码发生改变时，您可以使用下面的命令更新您的云函数的代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 更新 app 函数的代码</span></span><br><span class="line">tcb fn code update app</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>fn code update</code> 命令和 <code>fn deploy</code> 命令的主要区别是：<code>fn code update</code> 命令只会更新函数的代码以及执行入口，不会修改函数的其他配置，而 <code>fn deploy</code> 命令则会修改函数的代码、配置以及触发器等。</p>
</blockquote>
<h4 id="函数版本"><a href="#函数版本" class="headerlink" title="函数版本"></a>函数版本</h4><p>您可以通过下面的命令查看函数版本：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb fn list-function-versions &lt;name&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/88eb3713574d7f1b.png" alt></p>
<h4 id="函数日志"><a href="#函数日志" class="headerlink" title="函数日志"></a>函数日志</h4><p>您可以通过下面的命令打印云函数的运行日志，使用此命令时必须指定函数的名称：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 查看 vue-echo 函数的调用日志</span><br><span class="line">tcb fn log vue-echo</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/8f3777524f8f6e77.png" alt></p>
<p>默认情况下，Cloudbase CLI 会打印最近的 20 条日志，您可以通过在命令后附加下面的可用选项指定返回日志的筛选条件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-i, --reqId &lt;reqId&gt;  函数请求 Id</span><br><span class="line">-o, --offset &lt;offset&gt;                        数据的偏移量，Offset + Limit不能大于10000</span><br><span class="line">-l, --limit &lt;limit&gt;                          返回数据的长度，Offset + Limit不能大于10000</span><br><span class="line">--order &lt;order&gt;                              以升序还是降序的方式对日志进行排序，可选值 desc 和 asc</span><br><span class="line">--orderBy &lt;orderBy&gt;                          根据某个字段排序日志,支持以下字段：function_name,duration, mem_usage, start_time</span><br><span class="line">--startTime &lt;startTime&gt;                      查询的具体日期，例如：2019-05-16 20:00:00，只能与endtime 相差一天之内</span><br><span class="line">--endTime &lt;endTime&gt;                          查询的具体日期，例如：2019-05-16 20:59:59，只能与startTime 相差一天之内</span><br><span class="line">-e, --error                                  只返回错误类型的日志</span><br><span class="line">-s, --success                                只返回正确类型的日志</span><br></pre></td></tr></table></figure>
<p>如：<code>tcb fn log app -l 2</code> 打印 <code>app</code> 函数的最新 2 条日志信息</p>
<h4 id="部署示例"><a href="#部署示例" class="headerlink" title="部署示例"></a>部署示例</h4><ul>
<li>编写<code>cloudbaserc.json文件</code></li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/705a1f9853edda3a.png" alt></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="attr">"envId"</span>: <span class="string">"poetry-prod-xx"</span>,</span><br><span class="line">  <span class="attr">"functionRoot"</span>: <span class="string">"./cloudfunctions"</span>,</span><br><span class="line">  <span class="attr">"functions"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"vue-echo"</span>,</span><br><span class="line">      <span class="attr">"timeout"</span>: <span class="number">5</span>,</span><br><span class="line">      <span class="attr">"runtime"</span>: <span class="string">"Nodejs10.15"</span>,</span><br><span class="line">      <span class="attr">"installDependency"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>部署，执行以下命令，部署指定函数名称</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb fn deploy vue-echo</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/840a923b27e4ee59.png" alt></p>
<ul>
<li>查看已部署的函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb fn list</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/7f14d68f7629334e.png" alt></p>
<h3 id="3-6-静态网站托管"><a href="#3-6-静态网站托管" class="headerlink" title="3.6 静态网站托管"></a>3.6 静态网站托管</h3><blockquote>
<p>云开发为开发者提供静态网页托管的能力，静态资源（HTML、CSS、JavaScript、字体等）的分发由对象存储 COS 和拥有多个边缘网点的 CDN 提供支持。您可在腾讯云控制台进行静态网站的部署，提供给您的用户访问。目前云开发静态网页托管能力仅在腾讯云云开发控制台支持，小程序 IDE 侧控制台暂不支持。</p>
</blockquote>
<p>仅有付费方式为按量付费的环境可开通静态网页托管能力，预付费方式环境不可开通。</p>
<p>使用 CLI 操作静态网站服务前请先到<a href="https://console.cloud.tencent.com/tcb" target="_blank" rel="noopener">云开发控制台开通静态网站服务</a>。</p>
<p><strong>全量部署</strong></p>
<blockquote>
<p>云开发 CLI 提供了直接部署网站文件的命令，在您需要部署的文件夹目录下，直接运行 <code>tcb hosting deploy</code> 命令即可将当前目前下所有的文件部署静态网站中。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># dist 构建目录</span></span><br><span class="line"><span class="built_in">cd</span> dist</span><br><span class="line"><span class="comment"># 部署全部文件</span></span><br><span class="line">tcb hosting deploy -e envId</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/cd6fa613aa0ba32c.png" alt></p>
<p><strong>您可以使用下面的命令展示静态网站的状态，访问域名等信息</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/08f8a4eed05f40c3.png" alt></p>
<p><strong>删除文件</strong></p>
<p>您可以使用下面的命令删除静态网站的存储空间中的文件或文件夹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cloudPath 为文件或文件夹的相对根目录的路径，为 目录/文件名 的形式，如 index.js、static/css/index.js 等</span><br><span class="line"></span><br><span class="line">tcb hosting delete cloudPath -e envId</span><br></pre></td></tr></table></figure>
<p><strong>删除全部文件</strong></p>
<p>云端路径为空时，表示删除全部文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb hosting delete -e envId</span><br></pre></td></tr></table></figure>
<p><strong>查看文件列表</strong></p>
<p>您可以使用下面的命令部署展示静态网站存储空间中文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb hosting list -e envId</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/68112e40d3a20d26.png" alt></p>
<h2 id="四、云开发登录鉴权"><a href="#四、云开发登录鉴权" class="headerlink" title="四、云开发登录鉴权"></a>四、云开发登录鉴权</h2><blockquote>
<p>CloudBase 提供跨平台的登录鉴权功能，您可以基于此为自己的应用构建用户体系，包括但不限于：</p>
</blockquote>
<ul>
<li>为用户分配全局唯一的身份标识 uid；</li>
<li>储存和管理用户个人信息；</li>
<li>关联多种登录方式；</li>
<li>管理用户对数据、资源的访问权限；</li>
<li>用户行为的收集和分析。</li>
</ul>
<blockquote>
<p>同时，CloudBase 登录鉴权还是保护您的服务资源的重要手段，CloudBase 对用户端发来的每一个请求，都会进行身份和权限的检查，避免您的资源被恶意攻击者消耗或者盗用。</p>
</blockquote>
<h3 id="4-1-登录鉴权"><a href="#4-1-登录鉴权" class="headerlink" title="4.1 登录鉴权"></a>4.1 登录鉴权</h3><p><img src="https://s.poetries.work/uploads/2022/06/015d7200d6f0ed7b.png" alt></p>
<blockquote>
<p>每个登录 CloudBase 的用户，都有一个对应的 CloudBase 账号，用户通过此账号访问调用 CloudBase 的数据与资源。</p>
</blockquote>
<ul>
<li>每个账号都有全局唯一的 UID，即账号 ID，作为用户的唯一身份标识</li>
<li>每个账号可以添加、修改用户信息</li>
<li>每个账号除了最初的登录方式之外，还可以关联其它登录方式</li>
</ul>
<p><strong>登录状态的持久化</strong></p>
<p>您可以指定登录状态如何持久保留。默认为 <code>local</code>，相关选项包括</p>
<p><img src="https://s.poetries.work/uploads/2022/06/aafc37032a793f1c.png" alt></p>
<p>例如，对于网页应用，最佳选择是 <code>local</code>，即在用户关闭浏览器之后仍保留该用户的会话。这样，用户不需要每次访问该网页时重复登录，避免给用户带来诸多不便体验。</p>
<p><strong>访问令牌与刷新令牌</strong></p>
<p>用户登录 CloudBase 之后，会获得访问令牌（<code>Access Token</code>） 作为访问 <code>CloudBase</code> 的凭证，访问令牌默认具有两小时有效期。</p>
<p>登录时还会获得刷新令牌（Refresh Token），默认有效期 30 天，用于访问令牌过期后，获取新的访问令牌。</p>
<p>CloudBase 用户端 SDK 会自动维护令牌的刷新和有效期，开发者无需特别关注此流程。</p>
<blockquote>
<p>匿名登录 的刷新令牌（<code>Refresh Token</code>）会在到期后自动续期，以实现长期的匿名登录状态。</p>
</blockquote>
<h4 id="管理用户"><a href="#管理用户" class="headerlink" title="管理用户"></a>管理用户</h4><p><strong>获取当前登录的用户</strong></p>
<ul>
<li>订阅登录状态变化的回调函数</li>
</ul>
<blockquote>
<p>获取当前用户，推荐在 <code>Auth</code> 对象上设置一个回调函数，每当用户登录状态转变时，会触发这个回调函数，并且获得当前的 <code>LoginState</code>：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">"@cloudbase/js-sdk"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">"your-env-id"</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个观察者</span></span><br><span class="line">auth.onLoginStateChanged(<span class="function">(<span class="params">loginState</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (loginState) &#123;</span><br><span class="line">    <span class="comment">// 此时用户已经登录</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有登录</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>直接获取当前用户</li>
</ul>
<blockquote>
<p>您还可以使用 <code>Auth.currentUser</code> 属性来获取当前登录的用户。如果用户未登录，则 <code>currentUser</code> 为 null</p>
</blockquote>
<p>您还可以使用 <code>Auth.currentUser</code> 属性来获取当前登录的用户。如果用户未登录，则 <code>currentUser</code> 为 <code>null</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = auth.currentUser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (user) &#123;</span><br><span class="line">  <span class="comment">// 此时用户已经登录</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 没有登录</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>获取用户个人资料</strong></p>
<blockquote>
<p>您可以通过 <code>User</code> 对象的各个属性来获取用户的个人资料信息：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = auth.currentUser;</span><br><span class="line"><span class="keyword">let</span> uid, nickName, gender, avatarUrl, location;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (user) &#123;</span><br><span class="line">  <span class="comment">// 云开发唯一用户 id</span></span><br><span class="line">  uid = user.uid;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 昵称</span></span><br><span class="line">  nickName = user.nickName;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 性别</span></span><br><span class="line">  gender = user.gender;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 头像URL</span></span><br><span class="line">  avatarUrl = user.avatarUrl;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用户地理位置</span></span><br><span class="line">  location = user.location;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>更新用户个人资料</strong></p>
<p>您可以使用 <code>User.update</code> 方法来更新用户的个人资料信息。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = auth.currentUser;</span><br><span class="line"></span><br><span class="line">user</span><br><span class="line">  .update(&#123;</span><br><span class="line">    nickName: <span class="string">"Tony Stark"</span>,</span><br><span class="line">    gender: <span class="string">"MALE"</span>,</span><br><span class="line">    avatarUrl: <span class="string">"https://..."</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 更新用户资料成功</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p><strong>刷新用户资料信息</strong></p>
<p>对于一个多端应用，用户可能在其中某个端上更新过自己的个人资料信息，此时其它端上可能需要刷新信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = auth.currentUser;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 刷新用户信息</span></span><br><span class="line">user.refresh().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 刷新后，获取到的用户信息即为最新的信息</span></span><br><span class="line">  <span class="keyword">const</span> &#123; nickName, gender, avatarUrl &#125; = user;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="账户关联"><a href="#账户关联" class="headerlink" title="账户关联"></a>账户关联</h4><p><strong>关联微信登录</strong></p>
<ul>
<li>用户以任意一种登录方式（除微信登录）登录云开发</li>
<li>获取 Provider：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"><span class="keyword">const</span> provider = auth.weixinAuthProvider(&#123;</span><br><span class="line">  appid: <span class="string">"...."</span>,</span><br><span class="line">  scope: <span class="string">"snsapi_base"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>重定向到提供方的页面进行登录：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">auth.currentUser.linkWithRedirect(provider);</span><br></pre></td></tr></table></figure>
<p>用户在微信的页面登录之后，会被重定向回您的页面。然后，可以在页面加载时通过调用 <code>Provider.getLinkRedirectResult()</code> 来获取关联结果：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> provider = auth.weixinAuthProvider();</span><br><span class="line"></span><br><span class="line">provider.getLinkRedirectResult().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 关联成功</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>关联自定义登录</strong></p>
<ul>
<li>用户以任意一种登录方式（除自定义登录）登录云开发；</li>
<li>使用 <code>User.linkWithTicket</code>，获取自定义登录 <code>Ticket</code> 后，关联自定义用户：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"><span class="keyword">const</span> ticket = <span class="string">"......"</span>; <span class="comment">// 自定义登录 Ticket</span></span><br><span class="line">auth.currentUser.linkWithTicket(ticket).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 关联成功</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>关联邮箱密码登录</strong></p>
<ul>
<li>用户以任意一种登录方式登录云开发</li>
<li>更新用户的密码：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line">auth.currentUser.updatePassword(password).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置密码成功</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>更新用户的邮箱，用户点击验证邮件之后，便关联成功：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">auth.currentUser.updateEmail(email).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 发送验证邮件成功</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>关联用户名密码登录</strong></p>
<ul>
<li>用户以任意一种登录方式（除匿名登录）登录云开发：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 以邮箱登录为例</span></span><br><span class="line"><span class="keyword">await</span> app.auth().signInWithEmailAndPassword(email, password);</span><br></pre></td></tr></table></figure>
<ul>
<li>绑定登录的用户名：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">await</span> app.auth().currentUser.updateUsername(username); <span class="comment">// 绑定用户名</span></span><br></pre></td></tr></table></figure>
<ul>
<li>绑定成功后，便可以使用用户名密码登录：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> loginState = <span class="keyword">await</span> app.auth().signInWithUsernameAndPassword(username, password); <span class="comment">// 用户名密码登录</span></span><br></pre></td></tr></table></figure>
<h4 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h4><p><strong>避免重复登录</strong></p>
<blockquote>
<p>执行登录流程之前，我们非常建议您先判断用户端是否已经登录 CloudBase，如已经登录，那么不需要执行登录流程，以避免无意义的重复登录。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用初始化时</span></span><br><span class="line"><span class="keyword">if</span> (auth.hasLoginState()) &#123;</span><br><span class="line">  <span class="comment">// 此时已经登录</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 此时未登录，执行您的登录流程</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>登录状态的持久保留</strong></p>
<blockquote>
<p>对于网页应用，最佳选择是 <code>local</code>，即在用户关闭浏览器之后仍保留该用户的会话。这样，用户不需要每次访问该网页时重复登录，避免给用户带来诸多不便体验</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth(&#123;</span><br><span class="line">  persistence: <span class="string">"local"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-2-登录方式"><a href="#4-2-登录方式" class="headerlink" title="4.2 登录方式"></a>4.2 登录方式</h3><h4 id="匿名登录"><a href="#匿名登录" class="headerlink" title="匿名登录"></a>匿名登录</h4><blockquote>
<p>登录 腾讯云 CloudBase 控制台，在 <a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noopener">登录授权页面中</a>，将匿名登录一栏打开或关闭。</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/e95ddf99a0e2939c.png" alt></p>
<p><strong>添加安全域名（可选）</strong></p>
<p>Web 应用需要将域名添加到 CloudBase 控制台的<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noopener">Web 安全域名</a>列表中，否则将被识别为非法来源：</p>
<p><img src="https://s.poetries.work/uploads/2022/06/3404d8f9e5a8d4cf.png" alt></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">'@cloudbase/js-sdk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">'xxxx-yyy'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">await</span> auth.anonymousAuthProvider().signIn();</span><br><span class="line">  <span class="comment">// 匿名登录成功检测登录状态isAnonymous字段为true</span></span><br><span class="line">  <span class="keyword">const</span> loginState = <span class="keyword">await</span> auth.getLoginState();</span><br><span class="line">  <span class="built_in">console</span>.log(loginState.isAnonymousAuth); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">login();</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/b34c3d3acc92627a.png" alt></p>
<p>可以看到token缓存到了本地</p>
<p><img src="https://s.poetries.work/uploads/2022/06/501a1e7be7791960.png" alt></p>
<blockquote>
<p>每个 <code>CloudBase</code> 环境的匿名用户数量不超过 <code>1000</code> 万个</p>
</blockquote>
<p>匿名用户在安全规则中的<code>auth.loginType</code>值为<code>ANONYMOUS</code>，配合安全规则可以限制匿名用户的 云数据库 和 云存储 的访问权限。比如下述代码展示的安全规则为：</p>
<ul>
<li>云数据库匿名用户不可读写；</li>
<li>云存储所有用户可读，匿名用户不可写。</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/f49d51410d41a7e2.png" alt></p>
<p><strong>转化为正式用户</strong></p>
<ul>
<li>如果用户在匿名状态下产生了一些私有数据（例如游戏中获取了个人成就和装备），想将此匿名账号转化为正式账号长久持有。</li>
<li>针对这种需求，您可以 将匿名账号与任意一种登录方式关联，关联后，便可以永久使用该种登录方式登录 CloudBase，达成”匿名账号转正“的效果。详情请参考：账户关联。</li>
</ul>
<p><strong>问题</strong></p>
<ul>
<li>匿名登录与未登录有什么区别？</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/d8b255edaee3b012.png" alt></p>
<ul>
<li>匿名登录的用户达到上限后怎么办？</li>
</ul>
<blockquote>
<p>CloudBase 限制每个环境的匿名用户数量不超过 1000 万个，如果达到上限可以在 CloudBase 控制台 的“用户管理”页面查看匿名用户的活跃情况，针对长期不登录的匿名用户可以考虑将其删除以释放空间。</p>
</blockquote>
<ul>
<li>匿名用户是否会过期？</li>
</ul>
<blockquote>
<p>CloudBase 对匿名用户的有效期限策略是：每个设备同时只存在一个匿名用户，并且此用户永不过期。当然，如果用户手动清除了设备或浏览器的本地数据，那么匿名用户的数据便会被同步清除，再次调用 CloudBase 匿名登录 API 会产生一个新的匿名用户。</p>
</blockquote>
<h4 id="未登录"><a href="#未登录" class="headerlink" title="未登录"></a>未登录</h4><blockquote>
<p>CloudBase 允许客户端在未登录的情况下调用 CloudBase 的资源，开发者可以配合安全规则限制未登录对资源的访问权限。</p>
</blockquote>
<p>登录 云开发 CloudBase 控制台，在 <a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noopener">登录授权</a> 中，将未登录一栏打开或关闭。</p>
<p><img src="https://s.poetries.work/uploads/2022/06/46c9989ef1cea582.png" alt></p>
<p><strong>添加安全域名（可选）</strong></p>
<p>Web 应用需要将域名添加到 CloudBase 控制台的<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noopener">Web 安全域名</a>列表中，否则将被识别为非法来源：</p>
<p><img src="https://s.poetries.work/uploads/2022/06/3404d8f9e5a8d4cf.png" alt></p>
<p><strong>使用流程</strong></p>
<ol>
<li>设置自定义安全规则，放通未登录访问</li>
</ol>
<p>您需要使用自定义安全规则，来放通未登录模式下的资源访问。</p>
<blockquote>
<p>基于安全性的考虑，基础的四种权限设置下，均不允许未登录进行访问。</p>
</blockquote>
<p>如，您可以这样设置云数据库的权限：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;read&quot;: &quot;doc._openid==auth.openid || auth == null&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在原始私有读 <code>doc._openid==auth.openid</code> 的基础上，允许了所有未登录用户进行读资源。详细可查看 <a href="https://docs.cloudbase.net/rule/rule-example" target="_blank" rel="noopener">编写安全规则</a>。</p>
<p><img src="https://s.poetries.work/uploads/2022/06/4bf8025e0f47dce5.png" alt></p>
<ol start="2">
<li>初始化 SDK 发起调用</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">'@cloudbase/js-sdk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">'xxxx-yyy'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>SDK 初始化完成后可以正常发起云开发资源的调用。</p>
<p><img src="https://s.poetries.work/uploads/2022/06/c81cf50a598dd81f.png" alt></p>
<h4 id="邮箱登录"><a href="#邮箱登录" class="headerlink" title="邮箱登录"></a>邮箱登录</h4><blockquote>
<p>使用邮箱登录，您可以让您的用户使用自己的邮箱和密码注册、登录 CloudBase，并且还可以更新登录使用的邮箱和密码。</p>
</blockquote>
<p><strong>开通邮箱登录</strong></p>
<ol>
<li>开启邮箱登录</li>
</ol>
<p>进入 云开发 CloudBase 控制台，在 登录授权 设置页面中，开启邮箱登录:</p>
<p><img src="https://s.poetries.work/uploads/2022/06/bdff32d173347663.png" alt></p>
<ol start="2">
<li>配置发件邮箱</li>
</ol>
<blockquote>
<p>填入您邮箱的 SMTP 账号信息</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/d5760279a4e8d4b9.png" alt></p>
<ol start="3">
<li>设置应用名称及自动跳转链接</li>
</ol>
<p>打开右侧「应用配置」页面，设置您的应用名称和自动跳转链接。</p>
<ul>
<li>您设置的应用名称将会出现在验证邮件的内容中；</li>
<li>CloudBase 发送的邮件中会包含一个 URL，用户打开邮件中的 URL 后，会自动跳转到您设置的自动跳转链接。</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/75fe3a786ac2f19b.png" alt></p>
<p><strong>登录流程</strong></p>
<ol>
<li>初始化 SDK</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">"@cloudbase/js-sdk"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">"your-env-id"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用邮箱注册账号</li>
</ol>
<p>首先需要用户填入自己的邮箱和密码，然后调用 SDK 的注册接口：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">  .auth()</span><br><span class="line">  .signUpWithEmailAndPassword(email, password)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 发送验证邮件成功</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>调用注册接口之后，<code>CloudBase</code> 会使用您预先设置的邮箱，发送一封验证邮件到用户的邮箱。邮件中包含一个激活链接，用户在点击激活链接后，账号才会正式注册成功。</p>
<blockquote>
<p>密码强度要求:密码长度不小于 8 位，不大于 32 位，需要包含字母和数字。</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/8dfd1a122cf97ef9.png" alt></p>
<p>可以看到注册成功的账户</p>
<p><img src="https://s.poetries.work/uploads/2022/06/88c3a1a2a39dab05.png" alt></p>
<ol start="3">
<li>使用邮箱+密码登录 CloudBase</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">  .auth()</span><br><span class="line">  .signInWithEmailAndPassword(email, password)</span><br><span class="line">  .then(<span class="function">(<span class="params">loginState</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 登录成功</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/3dbf8e6a924809df.png" alt></p>
<h4 id="微信授权登录"><a href="#微信授权登录" class="headerlink" title="微信授权登录"></a>微信授权登录</h4><p>经微信授权的网页应用可以直接使用微信登录 CloudBase，包括两种授权类型：</p>
<ul>
<li>微信公众平台（公众号网页）；</li>
<li>微信开放平台（普通网站应用及移动应用等）</li>
</ul>
<p><strong>开通流程</strong></p>
<ol>
<li>开通平台账号</li>
</ol>
<p>首先需要一个微信公众平台 / 开放平台的注册账号，如果没有，请前往 <a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener">微信公众平台</a> 或 <a href="https://open.weixin.qq.com/" target="_blank" rel="noopener">微信开放平台申请</a></p>
<p>然后在微信公众平台/开放平台的管理后台中，查看开发者 ID（AppId）和开发者密码（AppSecret）。</p>
<p>以微信公众平台为例，在“开发 - 基本配置”中有以下内容：</p>
<p><img src="https://s.poetries.work/uploads/2022/06/d9590e7139fec14a.png" alt></p>
<blockquote>
<p>开发者密码（AppSecret）是非常私密的信息，每次点击上图中的「重置」按钮都会获取一个新的 AppSecret。</p>
</blockquote>
<ol start="2">
<li>开启微信登录</li>
</ol>
<p><img src="https://s.poetries.work/uploads/2022/06/c6f20fd79e5cf432.png" alt></p>
<p>点击启用按钮后在弹窗的对应位置填入 AppId 和 AppSecret。</p>
<ol start="3">
<li>添加安全域名（可选）</li>
</ol>
<p>Web 应用需要将域名添加到 CloudBase 控制台的<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noopener">Web 安全域名</a>列表中，否则将被识别为非法来源：</p>
<p><img src="https://s.poetries.work/uploads/2022/06/3404d8f9e5a8d4cf.png" alt></p>
<p><strong>微信登录流程</strong></p>
<p>在使用微信登录 CloudBase 前，请先在控制台中 <a href="https://docs.cloudbase.net/authentication/method/wechat-login#%E5%BC%80%E9%80%9A%E6%B5%81%E7%A8%8B" target="_blank" rel="noopener">启用微信登录</a>。</p>
<ol>
<li>初始化 SDK</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">"@cloudbase/js-sdk"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">"your-env-id"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用 SDK 处理登录流程</li>
</ol>
<p>创建 Provider：首先我们创建一个 Provider 实例，并且填入参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> provider = auth.weixinAuthProvider(&#123;</span><br><span class="line">  appid: <span class="string">"..."</span>,</span><br><span class="line">  scope: <span class="string">"xxxx"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/befa9164c6b90b3f.png" alt></p>
<ul>
<li>如果用户使用 <code>snsapi_userinfo</code> 或 <code>snsapi_login</code> 登录，并且是首次登录，那么 CloudBase 将会自动拉取、同步微信的用户基本信息。</li>
<li>如果用户不是首次登录，将不会有此行为。</li>
</ul>
<p>使用 Provider 进行登录</p>
<blockquote>
<p>首先调用 <code>Provider.signInWithRedirect()</code>，用户将会跳转到微信 OAuth 授权页面：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">provider.signInWithRedirect();</span><br></pre></td></tr></table></figure>
<p>在授权页面内，需要用户对登录行为进行授权，成功后，会返回至当前页面。</p>
<p>然后调用 <code>Provider.getRedirectResult()</code>，获取登录结果：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">provider.getRedirectResult().then(<span class="function">(<span class="params">loginState</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (loginState) &#123;</span><br><span class="line">    <span class="comment">// 登录成功！</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="自定义登录"><a href="#自定义登录" class="headerlink" title="自定义登录"></a>自定义登录</h4><blockquote>
<p>开发者可以使用自定义登录，在自己的服务器或者云函数内，为用户签发带有自定义身份 ID 的自定义登录凭证 Ticket，随后用户端 SDK 便可以使用 Ticket 登录 CloudBase。</p>
</blockquote>
<p>自定义登录一般用于下面几种场景：</p>
<ul>
<li>开发者希望将自有的账号体系与云开发 CloudBase 账号进行一对一关联；</li>
<li>开发者希望自行接管鉴权流程。</li>
</ul>
<p>自定义登录需要以下几个步骤：</p>
<ul>
<li>获取 CloudBase 自定义登录私钥；</li>
<li>使用 CloudBase 服务端 SDK，通过私钥签发出 Ticket，并返回至用户端；</li>
<li>用户端 SDK 使用 Ticket 登录 CloudBase。</li>
</ul>
<ol>
<li>获取自定义登录私钥</li>
</ol>
<blockquote>
<p>登录 CloudBase 控制台，在 <a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noopener">环境 -&gt; 登录授权</a>下的自定义登录栏中，点击「私钥下载」或者「私钥复制」：</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/0d8163e0ab3193ec.png" alt></p>
<blockquote>
<p>私钥是一份携带有 JSON 数据的文件，请将下载或复制的私钥文件保存到您的服务器或者云函数中，假设路径为<code>/path/to/your/tcb_custom_login.json</code>。</p>
</blockquote>
<ul>
<li>私钥文件是证明管理员身份的重要凭证，请务必妥善保存，避免泄漏；</li>
<li>每次生成私钥文件都会使之前生成的私钥文件在 2 小时后失效。</li>
</ul>
<ol start="2">
<li>签发 Ticket</li>
</ol>
<p>调用 CloudBase 服务端 SDK，在初始化时传入自定义登录私钥，随后便可以签发出 Ticket，并返回至用户端</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cloudbase = <span class="built_in">require</span>(<span class="string">"@cloudbase/node-sdk"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 初始化 SDK</span></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">"your-env-id"</span>,</span><br><span class="line">  <span class="comment">// 传入自定义登录私钥</span></span><br><span class="line">  credentials: <span class="built_in">require</span>(<span class="string">"/path/to/your/tcb_custom_login.json"</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 开发者自定义的用户唯一身份标识</span></span><br><span class="line"><span class="keyword">const</span> customUserId = <span class="string">"your-customUserId"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建ticket</span></span><br><span class="line"><span class="keyword">const</span> ticket = app.auth().createTicket(customUserId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 将ticket返回至客户端</span></span><br><span class="line"><span class="keyword">return</span> ticket;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>开发者也可以编写一个云函数用于生成 Ticket，并为其设置 HTTP 访问服务，随后用户端便可以通过 HTTP 请求的形式获取 Ticket，详细的方案请参阅 <a href="https://docs.cloudbase.net/service/access-cloud-function" target="_blank" rel="noopener">使用 HTTP 访问云函数</a>。</p>
</blockquote>
<p>customUserId 必须满足以下需求：</p>
<ul>
<li>4-32 位字符；</li>
<li>字符只能是大小写英文字母、数字、以及 <code>_-#@(){}[]:.,&lt;&gt;+#~</code> 中的字符。</li>
</ul>
<ol start="3">
<li>使用 Ticket 登录 CloudBase</li>
</ol>
<blockquote>
<p>用户端应用获取到 Ticket 之后，便可以调用客户端 SDK 提供的 <code>auth.signInWithTicket()</code> 登录 CloudBase：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">'@cloudbase/js-sdk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">'your-env-id'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> loginState = <span class="keyword">await</span> auth.getLoginState();</span><br><span class="line">  <span class="comment">// 1. 建议登录前检查当前是否已经登录</span></span><br><span class="line">  <span class="keyword">if</span>(!loginState)&#123;</span><br><span class="line">    <span class="comment">// 2. 请求开发者自有服务接口获取ticket</span></span><br><span class="line">    <span class="keyword">const</span> ticket = <span class="keyword">await</span> fetch(<span class="string">'...'</span>)；</span><br><span class="line">    <span class="comment">// 3. 登录 CloudBase</span></span><br><span class="line">    <span class="keyword">await</span> auth.customAuthProvider().signIn(ticket);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">login();</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/bf6484c27c260614.png" alt></p>
<p><strong>自定义登录一定需要自己假设用于创建 Ticket 的服务器吗？</strong></p>
<ul>
<li>自定义登录必须有一个创建 Ticket 的服务，但是开发者并非一定要自己搭建服务器。</li>
<li>开发者还可以编写一个云函数来创建 Ticket，然后客户端使用 HTTP 请求调用这个云函数获取 Ticket，详细请参阅 <a href="https://docs.cloudbase.net/service/access-cloud-function" target="_blank" rel="noopener">使用 HTTP 访问云函数</a></li>
</ul>
<h4 id="用户名密码登录"><a href="#用户名密码登录" class="headerlink" title="用户名密码登录"></a>用户名密码登录</h4><ul>
<li>使用用户名密码登录，您可以让您的用户绑定用户名，并使用用户名密码登录 CloudBase。您可以更改用户名和密码，还可以查询用户名是否绑定过。</li>
<li>如果用户名未被绑定过，需要先使用其他登录方式完成登录后，才可以绑定用户名。绑定成功后，可以使用用户名和密码完成登录。</li>
</ul>
<p>进入 云开发 CloudBase 控制台，在 登录授权 设置页面中，开启用户名密码登录:</p>
<p><img src="https://s.poetries.work/uploads/2022/06/6d0258075bf46615.png" alt></p>
<p><strong>绑定用户名流程</strong></p>
<ol>
<li>初始化 SDK</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">"@cloudbase/js-sdk"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">"your-env-id"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用其他方式进行登录</li>
</ol>
<p>绑定用户名之前，用户需要先使用其他方式进行登录，例如邮箱登录、微信公众号登录等，但不包括匿名登录</p>
<p>下面以邮箱登录为例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"><span class="keyword">await</span> auth.signInWithEmailAndPassword(email, password); <span class="comment">// 邮箱登录</span></span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/acd1fb389d6c9a6d.png" alt></p>
<ol start="3">
<li>绑定用户名</li>
</ol>
<p>绑定用户名时，可以检查在当前云开发环境下，此用户名是否存在。然后再调用绑定用户名的接口</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"><span class="keyword">if</span> (!(<span class="keyword">await</span> auth.isUsernameRegistered(username))) &#123;</span><br><span class="line">  <span class="comment">// 检查用户名是否绑定过</span></span><br><span class="line">  <span class="keyword">await</span> auth.currentUser.updateUsername(username); <span class="comment">// 绑定用户名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>使用用户名+密码登录 CloudBase</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> auth = app.auth();</span><br><span class="line"><span class="keyword">const</span> loginState = <span class="keyword">await</span> auth.signInWithUsernameAndPassword(username, password); <span class="comment">// 用户名密码登录</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：用户名登录和邮箱登录的密码是相同的</p>
</blockquote>
<h4 id="短信验证码登录"><a href="#短信验证码登录" class="headerlink" title="短信验证码登录"></a>短信验证码登录</h4><blockquote>
<p>使用短信验证码登录，您可以让用户使用自己的手机号，结合短信验证码或密码注册、登录 CloudBase，并且还可以更新或者解绑登录使用的手机号。</p>
</blockquote>
<p><strong>开通短信验证码登录</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/e4eac02d22f679e0.png" alt></p>
<p><strong>登录流程</strong></p>
<ol>
<li>初始化 SDK</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">"@cloudbase/js-sdk"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">  env: <span class="string">"your-env-id"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用手机号注册账号</li>
</ol>
<blockquote>
<p>首先需要用户填入自己的手机号，然后调用 SDK 的发送短信验证码接口：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">  .auth()</span><br><span class="line">  .sendPhoneCode(phoneNumber)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 发送短信验证码</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>调用发送短信接口后，手机将会收到云开发的短信验证码。用户填入短信验证码，以及自定义密码后，调用注册账号接口</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">  .auth()</span><br><span class="line">  .signUpWithPhoneCode(phoneNumber, phoneCode, password)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 手机短信注册账号</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>使用手机号 + 密码 or 手机号 + 短信验证码登录 CloudBase</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app</span><br><span class="line">  .auth()</span><br><span class="line">  .signInWithPhoneCodeOrPassword(&#123;</span><br><span class="line">    phoneNumber,</span><br><span class="line">    phoneCode, <span class="comment">// 非必填，验证码和密码至少二选一</span></span><br><span class="line">    password <span class="comment">// 非必填，验证码和密码至少二选一</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">loginState</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 登录成功</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="五、CloudBase-Framework一体化部署（推荐方式）"><a href="#五、CloudBase-Framework一体化部署（推荐方式）" class="headerlink" title="五、CloudBase Framework一体化部署（推荐方式）"></a>五、CloudBase Framework一体化部署（推荐方式）</h2><blockquote>
<p>文档地址 <a href="https://docs.cloudbase.net/framework/index" target="_blank" rel="noopener">https://docs.cloudbase.net/framework/index</a></p>
</blockquote>
<blockquote>
<p>CloudBase Framework 是云开发官方出品的云原生一体化部署工具，可以帮助开发者将静态网站、后端服务和小程序等应用，一键部署到云开发 Serverless 架构的云平台上，自动伸缩且无需关心运维，聚焦应用本身，无需关心底层配置和资源。</p>
</blockquote>
<h3 id="5-1-云开发应用介绍"><a href="#5-1-云开发应用介绍" class="headerlink" title="5.1 云开发应用介绍"></a>5.1 云开发应用介绍</h3><blockquote>
<p>云开发应用可以理解为运行在云开发环境的应用，例如一个包含前后端、数据库等能力等服务，可以通过一键部署，直接部署在云开发环境中，使用云开发底层的各项 Serverless 资源，享受弹性免运维的优势。</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/40bd0c9ceadc339e.png" alt></p>
<p>一个云开发应用可以拆解为三个部分，包括代码、声明式配置和环境变量信息。</p>
<p><img src="https://s.poetries.work/uploads/2022/06/7215d3f021c80ef9.png" alt></p>
<p><strong>如何开发一个云开发应用</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/3731b6c2de7002eb.png" alt></p>
<h3 id="5-2-cloudbase-framework配置文件"><a href="#5-2-cloudbase-framework配置文件" class="headerlink" title="5.2 cloudbase framework配置文件"></a>5.2 cloudbase framework配置文件</h3><blockquote>
<p>在使用 CloudBase Framework 之前，您需要需要创建一个 <code>cloudbaserc.json</code> 配置文件，<code>cloudbaserc.json</code> 文件是 CloudBase CLI 、CloudBase VSCode 插件和 CloudBase 应用的配置文件，配置文件会关系到云开发如何构建和部署您的应用。</p>
</blockquote>
<p>默认情况下，使用 <code>cloudbase init</code> 初始化项目时，会生成 <code>cloudbaserc.json</code> 文件作为配置文件，您也可以使用 <code>--config-file</code> 指定其他文件作为配置文件，文件必须满足格式要求。</p>
<p><strong>CloudBase Framework 配置文件包含以下几类配置信息：</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/3e69b0ecfb4b5b1c.png" alt></p>
<ol>
<li>plugins：描述您的应用依赖哪些 CloudBase Framework 插件，以便根据配置来构建和部署您的应用，应用可以使用多个插件，具体插件配置方式参考下文。</li>
</ol>
<blockquote>
<p>目前支持的插件名称请参阅 <a href="https://github.com/Tencent/cloudbase-framework#目前支持的插件列表" target="_blank" rel="noopener">https://github.com/Tencent/cloudbase-framework#目前支持的插件列表</a></p>
</blockquote>
<p>示例</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"client"</span>: &#123;</span><br><span class="line">        <span class="comment">// 使用的插件 npm 包名，例如 @cloudbase/framework-plugin-website支持指定插件版本，例如@cloudbase/framework-plugin-website@1.3.5</span></span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-website"</span>,</span><br><span class="line">        <span class="comment">// 插件入参配置，不同的插件，支持的入参不同，请查阅对应插件的 README 或者文档</span></span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"buildCommand"</span>: <span class="string">"npm run build"</span>,</span><br><span class="line">          <span class="string">"outputPath"</span>: <span class="string">"dist"</span>,</span><br><span class="line">          <span class="string">"cloudPath"</span>: <span class="string">"/vue"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"server"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-function"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"functionRootPath"</span>: <span class="string">"cloudfunctions"</span>,</span><br><span class="line">          <span class="string">"functions"</span>: [&#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"vue-echo"</span></span><br><span class="line">          &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>生命周期</li>
</ol>
<blockquote>
<p>配置在构建部署生命周期前后，需要执行的自定义动作</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"hooks"</span>: &#123;</span><br><span class="line">       <span class="comment">// 前置钩子，在执行 Framework 完整的构建部署动作之前执行的钩子，可以执行一些命令行命令</span></span><br><span class="line">      <span class="string">"preDeploy"</span>: &#123;</span><br><span class="line">        <span class="comment">// 前置钩子的类型，目前仅支持 execCommand，表示执行命令行命令</span></span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"execCommand"</span>,</span><br><span class="line">        <span class="string">"commands"</span>: [<span class="comment">// 要执行的 command 命令列表</span></span><br><span class="line">          <span class="string">"sudo npm install -g lerna"</span>,</span><br><span class="line">          <span class="string">"lerna bootstrap"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//后置钩子，在执行 Framework 部署之后，在云端调用的钩子，可以调用一些云函数</span></span><br><span class="line">      <span class="string">"postDeploy"</span>: &#123;</span><br><span class="line">        <span class="comment">// 后置钩子钩子的类型，目前仅支持 callFunction 代表在云端执行云函数</span></span><br><span class="line">        <span class="string">"type"</span>: <span class="string">"callFunction"</span>,</span><br><span class="line">        <span class="string">"functions"</span>:[ <span class="comment">// 要调用的云函数列表，支持数组，例如</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"functionName"</span>: <span class="string">"echo"</span>, <span class="comment">// 调用的云函数的函数名</span></span><br><span class="line">            <span class="string">"params"</span>: &#123; <span class="comment">// 调用云函数的参数信息</span></span><br><span class="line">              <span class="string">"foo"</span>: <span class="string">"bar"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>应用依赖</li>
</ol>
<blockquote>
<p>在云端一键部署场景下，您需要完善应用依赖配置来声明应用依赖的扩展资源和环境变量参数</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="comment">// 描述项目通过控制台一键安装部署时依赖的其他资源信息、环境变量等业务参数。</span></span><br><span class="line">    <span class="string">"requirement"</span>: &#123;</span><br><span class="line">        <span class="comment">// 应用部署过程中用到的外部云上资源，包括 cfs、cynosdb、redis 等</span></span><br><span class="line">      <span class="string">"addons"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"CynosDB"</span>,<span class="comment">// 资源类型，目前支持 CFS 和 CynosDB</span></span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"wordpress"</span>,<span class="comment">// 资源名称，只支持 a-z 0-9 和 -</span></span><br><span class="line">          <span class="string">"envMap"</span>: &#123;<span class="comment">// 环境变量映射文件，会将云资源产生的 IP 、PORT 通过右侧定义的名称来映射为对应的环境变量名称，并注入环境变</span></span><br><span class="line">            <span class="string">"IP"</span>: <span class="string">"WORDPRESS-IP"</span>,</span><br><span class="line">            <span class="string">"PORT"</span>: <span class="string">"WORDPRESS-PORT"</span>,</span><br><span class="line">            <span class="string">"USERNAME"</span>: <span class="string">"WORDPRESS-USERNAME"</span>,</span><br><span class="line">            <span class="string">"PASSWORD"</span>: <span class="string">"WORDPRESS-PASSWORD"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 应用在构建时和运行时的环境变量配置声明，默认注入计算环境中(云函数、云应用)，也会在云端构建时作为构建部署的环境变量，可以在 cloudbaserc.json 中通过 &#123;&#123;env.ENV_NAME&#125;&#125;引用</span></span><br><span class="line">      <span class="string">"environment"</span>: &#123;</span><br><span class="line">        <span class="string">"SECRET_TOKEN"</span>: &#123;</span><br><span class="line">            <span class="comment">// 环境变量描述，会在输入时进行提示</span></span><br><span class="line">          <span class="string">"description"</span>: <span class="string">"A secret key for verifying the integrity of signed cookies."</span>,</span><br><span class="line">          <span class="string">"required"</span>: <span class="literal">true</span>, <span class="comment">//是否必填</span></span><br><span class="line">          <span class="string">"default"</span>: <span class="string">"default_value"</span>,</span><br><span class="line">          <span class="string">"validation"</span>: &#123;<span class="comment">// 校验规则配置</span></span><br><span class="line">            <span class="string">"rule"</span>: &#123;<span class="comment">//校验规则信息</span></span><br><span class="line">              <span class="string">"type"</span>: <span class="string">"RegExp"</span>,<span class="comment">//校验规则类型，目前支持"RegExp" 代表正则类型</span></span><br><span class="line">              <span class="string">"pattern"</span>: <span class="string">"[3-9]"</span>,<span class="comment">//正则的 Pattern</span></span><br><span class="line">              <span class="string">"flag"</span>: <span class="string">"g"</span><span class="comment">//正则的 Flag</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"errorMessage"</span>: <span class="string">"数值范围3-9"</span><span class="comment">//校验失败时的错误信息</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>模板变量</li>
</ol>
<p>配置文件支持动态变量的特性。在 <code>cloudbaserc.json</code> 中声明 <code>&quot;version&quot;: &quot;2.0&quot;</code> 即可启用。</p>
<blockquote>
<p>动态变量特性允许<code>cloudbaserc.json</code> 配置文件中使用动态变量，从环境变量中获取动态的数据。使用<code>{}</code>包围的值定义为动态变量，可以引用数据源中的值。例如`{env.ENV_ID}:</p>
</blockquote>
<ul>
<li>第一步：在项目根目录下创建 <code>cloudbaserc.json</code> 和 <code>.env</code> 文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├─cloudbaserc.json</span><br><span class="line">├─.env</span><br></pre></td></tr></table></figure>
<ul>
<li>第二步：在 .env 文件内添加变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ENV_ID=pro-123</span><br><span class="line">DB_NAME=pro_user</span><br></pre></td></tr></table></figure>
<ul>
<li>第三步：在 <code>cloudbaserc.json</code> 文件内通过 <code>env</code> 注入模板变量</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;env.ENV_ID&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"node-capp"</span>,</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"node"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-node"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"node-capp"</span>,</span><br><span class="line">          <span class="string">"path"</span>: <span class="string">"/node-capp"</span>,</span><br><span class="line">          <span class="string">"platform"</span>: <span class="string">"container"</span>,</span><br><span class="line">          <span class="string">"containerOptions"</span>: &#123;</span><br><span class="line">            <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">              <span class="string">"env"</span>: <span class="string">"&#123;&#123;env.ENV_ID&#125;&#125;"</span>,</span><br><span class="line">              <span class="string">"db"</span>: <span class="string">"&#123;&#123;env.DB_NAME&#125;&#125;"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>第四步：一键部署应用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb framework deploy</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>模式切换</li>
</ol>
<p>假设你已经完成了以上模板变量的配置</p>
<ul>
<li>第一步：在项目根目录额外添加 <code>.env.dev</code> 文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├─cloudbaserc.json</span><br><span class="line">├─.env</span><br><span class="line">├─.env.dev</span><br></pre></td></tr></table></figure>
<ul>
<li>第二步：在 <code>.env.dev</code> 文件添加变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ENV_ID=dev-123</span><br><span class="line">DB_NAME=dev_user</span><br></pre></td></tr></table></figure>
<ul>
<li>第三步：部署应用时使用 –mode 指定模式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cloudbase framework deploy --mode dev</span><br></pre></td></tr></table></figure>
<p><strong>完整示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/framework/config</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;env.ENV_ID&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"$schema"</span>: <span class="string">"https://framework-1258016615.tcloudbaseapp.com/schema/latest.json"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"admin"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-website"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"outputPath"</span>: <span class="string">"./packages/admin/dist"</span>,</span><br><span class="line">          <span class="string">"installCommand"</span>: <span class="string">"echo \"Skip Install\""</span>,</span><br><span class="line">          <span class="string">"buildCommand"</span>: <span class="string">"npm run build"</span>,</span><br><span class="line">          <span class="string">"cloudPath"</span>: <span class="string">"&#123;&#123;env.deployPath&#125;&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"init"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-function"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"functionRootPath"</span>: <span class="string">"./packages"</span>,</span><br><span class="line">          <span class="string">"functions"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"name"</span>: <span class="string">"cms-init"</span>,</span><br><span class="line">              <span class="string">"timeout"</span>: <span class="number">60</span>,</span><br><span class="line">              <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">                <span class="string">"CMS_ADMIN_USER_NAME"</span>: <span class="string">"&#123;&#123;env.administratorName&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_ADMIN_PASS_WORD"</span>: <span class="string">"&#123;&#123;env.administratorPassword&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_OPERATOR_USER_NAME"</span>: <span class="string">"&#123;&#123;env.operatorName&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_OPERATOR_PASS_WORD"</span>: <span class="string">"&#123;&#123;env.operatorPassword&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_DEPLOY_PATH"</span>: <span class="string">"&#123;&#123;env.deployPath&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"ACCESS_DOMAIN"</span>: <span class="string">"&#123;&#123;env.accessDomain&#125;&#125;"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"installDependency"</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="string">"handler"</span>: <span class="string">"index.main"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"service"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-node"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"tcb-ext-cms-service"</span>,</span><br><span class="line">          <span class="string">"entry"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">          <span class="string">"projectPath"</span>: <span class="string">"./packages/service"</span>,</span><br><span class="line">          <span class="string">"path"</span>: <span class="string">"/tcb-ext-cms-service"</span>,</span><br><span class="line">          <span class="string">"functionOptions"</span>: &#123;</span><br><span class="line">            <span class="string">"timeout"</span>: <span class="number">15</span>,</span><br><span class="line">            <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">              <span class="string">"NODE_ENV"</span>: <span class="string">"production"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"db"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-database"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"collections"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-projects"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统项目数据（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-schemas"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统内容模型数据（请不需要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-users"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统用户数据，存储 CMS 的用户信息，包括管理员账号信息，角色信息等（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-webhooks"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统 webhook 集合，存储 CMS 系统的回调接口配置，CMS 系统数据的变更可以通过回调来进行同步 （请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-settings"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统配置集合，存储 CMS 系统的设置（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-user-roles"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统用户角色配置集合，存储 CMS 系统的自定义用户角色信息（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"requirement"</span>: &#123;</span><br><span class="line">      <span class="string">"addons"</span>: [],</span><br><span class="line">      <span class="string">"environment"</span>: &#123;</span><br><span class="line">        <span class="string">"administratorName"</span>: &#123;</span><br><span class="line">          <span class="string">"description"</span>: <span class="string">"管理员账户名，账号名长度需要大于 4 位，支持字母和数字"</span>,</span><br><span class="line">          <span class="string">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">"default"</span>: <span class="string">"admin"</span>,</span><br><span class="line">          <span class="string">"validation"</span>: &#123;</span><br><span class="line">            <span class="string">"rule"</span>: &#123;</span><br><span class="line">              <span class="string">"type"</span>: <span class="string">"RegExp"</span>,</span><br><span class="line">              <span class="string">"pattern"</span>: <span class="string">"[^[a-zA-Z0-9]+[a-zA-Z0-9_-]?[a-zA-Z0-9]+$]"</span>,</span><br><span class="line">              <span class="string">"flag"</span>: <span class="string">"g"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"errorMessage"</span>: <span class="string">"字母和数字的组合，不能为纯数字，长度范围是 1 ~ 32"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>其他项目配置文件示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/framework/config</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;env.ENV_ID&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"$schema"</span>: <span class="string">"https://framework-1258016615.tcloudbaseapp.com/schema/latest.json"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"admin"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-website"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"outputPath"</span>: <span class="string">"./packages/admin/dist"</span>,</span><br><span class="line">          <span class="string">"installCommand"</span>: <span class="string">"echo \"Skip Install\""</span>,</span><br><span class="line">          <span class="string">"buildCommand"</span>: <span class="string">"npm run build"</span>,</span><br><span class="line">          <span class="string">"cloudPath"</span>: <span class="string">"&#123;&#123;env.deployPath&#125;&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"init"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-function"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"functionRootPath"</span>: <span class="string">"./packages"</span>,</span><br><span class="line">          <span class="string">"functions"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"name"</span>: <span class="string">"cms-init"</span>,</span><br><span class="line">              <span class="string">"timeout"</span>: <span class="number">60</span>,</span><br><span class="line">              <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">                <span class="string">"CMS_ADMIN_USER_NAME"</span>: <span class="string">"&#123;&#123;env.administratorName&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_ADMIN_PASS_WORD"</span>: <span class="string">"&#123;&#123;env.administratorPassword&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_OPERATOR_USER_NAME"</span>: <span class="string">"&#123;&#123;env.operatorName&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_OPERATOR_PASS_WORD"</span>: <span class="string">"&#123;&#123;env.operatorPassword&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"CMS_DEPLOY_PATH"</span>: <span class="string">"&#123;&#123;env.deployPath&#125;&#125;"</span>,</span><br><span class="line">                <span class="string">"ACCESS_DOMAIN"</span>: <span class="string">"&#123;&#123;env.accessDomain&#125;&#125;"</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"installDependency"</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="string">"handler"</span>: <span class="string">"index.main"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"service"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-node"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"tcb-ext-cms-service"</span>,</span><br><span class="line">          <span class="string">"entry"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">          <span class="string">"projectPath"</span>: <span class="string">"./packages/service"</span>,</span><br><span class="line">          <span class="string">"path"</span>: <span class="string">"/tcb-ext-cms-service"</span>,</span><br><span class="line">          <span class="string">"functionOptions"</span>: &#123;</span><br><span class="line">            <span class="string">"timeout"</span>: <span class="number">15</span>,</span><br><span class="line">            <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">              <span class="string">"NODE_ENV"</span>: <span class="string">"production"</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"db"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-database"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"collections"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-projects"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统项目数据（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-schemas"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统内容模型数据（请不需要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-users"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统用户数据，存储 CMS 的用户信息，包括管理员账号信息，角色信息等（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-webhooks"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统 webhook 集合，存储 CMS 系统的回调接口配置，CMS 系统数据的变更可以通过回调来进行同步 （请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-settings"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统配置集合，存储 CMS 系统的设置（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"tcb-ext-cms-user-roles"</span>,</span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"CMS 系统系统用户角色配置集合，存储 CMS 系统的自定义用户角色信息（请不要手动修改）"</span>,</span><br><span class="line">              <span class="string">"aclTag"</span>: <span class="string">"ADMINONLY"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"requirement"</span>: &#123;</span><br><span class="line">      <span class="string">"addons"</span>: [],</span><br><span class="line">      <span class="string">"environment"</span>: &#123;</span><br><span class="line">        <span class="string">"administratorName"</span>: &#123;</span><br><span class="line">          <span class="string">"description"</span>: <span class="string">"管理员账户名，账号名长度需要大于 4 位，支持字母和数字"</span>,</span><br><span class="line">          <span class="string">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">"default"</span>: <span class="string">"admin"</span>,</span><br><span class="line">          <span class="string">"validation"</span>: &#123;</span><br><span class="line">            <span class="string">"rule"</span>: &#123;</span><br><span class="line">              <span class="string">"type"</span>: <span class="string">"RegExp"</span>,</span><br><span class="line">              <span class="string">"pattern"</span>: <span class="string">"[^[a-zA-Z0-9]+[a-zA-Z0-9_-]?[a-zA-Z0-9]+$]"</span>,</span><br><span class="line">              <span class="string">"flag"</span>: <span class="string">"g"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"errorMessage"</span>: <span class="string">"字母和数字的组合，不能为纯数字，长度范围是 1 ~ 32"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-3-插件"><a href="#5-3-插件" class="headerlink" title="5.3 插件"></a>5.3 插件</h3><p>插件可以处理应用中的一些独立单元的构建、部署、开发、调试等流程。例如 website 插件可以处理静态网站等单元，node 插件可以处理 koa 、express 等 node 应用。</p>
<p>插件的配置写在 cloudbaserc.json 文件中，具体请参考配置说明中的 插件配置可以手动填写，也可以自动生成。</p>
<p><strong>自动检测生成插件配置</strong></p>
<p>可以在项目目录下直接运行 <code>cloudbase</code> 命令进行自动检测生成插件配置文件并部署</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cloudbase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">✔ 是否使用云开发部署当前项目 &lt;Projects/test/test-vue&gt; ？ (Y/n) · true</span><br><span class="line">✔ 选择关联环境 · webpage - [webpage:按量计费]</span><br><span class="line">   ______ __                   __ ____</span><br><span class="line">  / ____// /____   __  __ ____/ // __ ) ____ _ _____ ___</span><br><span class="line"> / /    / // __ \ / / / // __  // __  |/ __ `// ___// _ \</span><br><span class="line">/ /___ / // /_/ // /_/ // /_/ // /_/ // /_/ /(__  )/  __/</span><br><span class="line">\_________\____/ \__,_/ \__,_//_____/ \__,_//____/ \___/       __</span><br><span class="line">   / ____/_____ ____ _ ____ ___   ___  _      __ ____   _____ / /__</span><br><span class="line">  / /_   / ___// __ `// __ `__ \ / _ \| | /| / // __ \ / ___// //_/</span><br><span class="line"> / __/  / /   / /_/ // / / / / //  __/| |/ |/ // /_/ // /   / ,&lt;</span><br><span class="line">/_/    /_/    \__,_//_/ /_/ /_/ \___/ |__/|__/ \____//_/   /_/|_|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> CloudBase Framework  info     Version v1.2.10</span><br><span class="line"> CloudBase Framework  info     Github: https://github.com/Tencent/cloudbase-framework</span><br><span class="line"></span><br><span class="line"> CloudBase Framework  info     EnvId webpage</span><br><span class="line">? 检测到当前项目包含 Vue.js 项目</span><br><span class="line"></span><br><span class="line">  🔨 构建脚本 `npm run build`</span><br><span class="line">  📦 本地静态文件目录 `dist`</span><br><span class="line"></span><br><span class="line">  是否需要修改默认配置 No</span><br><span class="line">? 请输入应用唯一标识(支持大小写字母数字及连字符, 同一账号下不能相同) test-vue</span><br><span class="line">? 是否需要保存当前项目配置，保存配置之后下次不会再次询问 Yes</span><br><span class="line"> CloudBase Framework  info     📦 install plugins</span><br></pre></td></tr></table></figure>
<p><strong>手动填写插件配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;framework&quot;: &#123;</span><br><span class="line">    &quot;plugins&quot;: &#123;</span><br><span class="line">      &quot;client&quot;: &#123;</span><br><span class="line">        &quot;use&quot;: &quot;@cloudbase/framework-plugin-website&quot;,</span><br><span class="line">        &quot;inputs&quot;: &#123;</span><br><span class="line">          &quot;buildCommand&quot;: &quot;npm run build&quot;,</span><br><span class="line">          &quot;outputPath&quot;: &quot;dist&quot;,</span><br><span class="line">          &quot;cloudPath&quot;: &quot;/vue&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;server&quot;: &#123;</span><br><span class="line">        &quot;use&quot;: &quot;@cloudbase/framework-plugin-function&quot;,</span><br><span class="line">        &quot;inputs&quot;: &#123;</span><br><span class="line">          &quot;functionRootPath&quot;: &quot;cloudfunctions&quot;,</span><br><span class="line">          &quot;functions&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;name&quot;: &quot;vue-echo&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>官方插件列表</strong></p>
<ul>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-website" target="_blank" rel="noopener">@cloudbase/framework-plugin-website 一键部署网站应用</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-node" target="_blank" rel="noopener">@cloudbase/framework-plugin-node 一键部署 Node 应用（支持底层部署为函数或者 云托管）</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-nuxt" target="_blank" rel="noopener">@cloudbase/framework-plugin-nuxt 一键部署 Nuxt SSR 应用</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-function" target="_blank" rel="noopener">@cloudbase/framework-plugin-function 一键部署函数资源</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-container" target="_blank" rel="noopener">@cloudbase/framework-plugin-container 一键部署云托管容器服务</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-database" target="_blank" rel="noopener">@cloudbase/framework-plugin-database 一键声明式部署云开发 NoSQL 云数据库</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-deno" target="_blank" rel="noopener">@cloudbase/framework-plugin-deno 一键部署 Deno 应用</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-next" target="_blank" rel="noopener">@cloudbase/framework-plugin-next 一键部署 Next SSR 应用</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-mp" target="_blank" rel="noopener">@cloudbase/framework-plugin-mp 一键部署微信小程序应用</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-auth" target="_blank" rel="noopener">    @cloudbase/framework-plugin-auth 一键设置登录配置</a></li>
</ul>
<blockquote>
<p>常用插件介绍</p>
</blockquote>
<h4 id="静态网站插件"><a href="#静态网站插件" class="headerlink" title="静态网站插件"></a>静态网站插件</h4><blockquote>
<p>云开发 CloudBase Framework 框架「Function」插件： 通过云开发 CloudBase Framework 框架将静态网站一键部署云开发环境，提供生产环境可用的 CDN 加速、自动弹性伸缩的高性能网站服务。可以搭配其他插件如 Node 插件、函数插件实现云端一体开发。</p>
</blockquote>
<ul>
<li>节约成本: 资源伸缩，弹性扩缩容，灵活计费，极大节约资源成本</li>
<li>极简配置：自动检测框架，无须配置，同时支持没有使用框架的纯静态项目</li>
<li>框架支持: 无缝支持原生和前端框架构建的项目<ul>
<li>Vue</li>
<li>React</li>
<li>Next SPA</li>
<li>Nuxt SPA</li>
<li>VuePress</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果想全新开始一个项目，可以直接执行 init 来从模板开始一个网站项目</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 部署</span><br><span class="line">cloudbase framework deploy</span><br></pre></td></tr></table></figure>
<blockquote>
<p>cloudbase init 之后会创建云开发的配置文件 cloudbaserc.json，可在配置文件的 plugins 里修改和写入插件配置</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;envId&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"client"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-website"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"installCommand"</span>: <span class="string">"npm install --prefer-offline --no-audit --progress=false"</span>,</span><br><span class="line">          <span class="string">"buildCommand"</span>: <span class="string">"npm run build"</span>, <span class="comment">// 构建命令，如npm run build，没有可不传</span></span><br><span class="line">          <span class="string">"outputPath"</span>: <span class="string">"dist"</span>, <span class="comment">// 网站静态文件的路径。</span></span><br><span class="line">          <span class="string">"cloudPath"</span>: <span class="string">"/path"</span>, <span class="comment">// 静态资源部署到云开发环境的路径，默认为根目录。</span></span><br><span class="line">          <span class="string">"ignore"</span>: [<span class="string">".git"</span>, <span class="string">".github"</span>, <span class="string">"node_modules"</span>, <span class="string">"cloudbaserc.js"</span>] <span class="comment">// 静态资源部署时忽略的文件路径，支持通配符</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="云函数插件"><a href="#云函数插件" class="headerlink" title="云函数插件"></a>云函数插件</h4><p><strong>功能特性</strong></p>
<ul>
<li>节约成本: 资源伸缩，弹性扩缩容，灵活计费，极大节约资源成本</li>
<li>极简配置：自动检测框架，无须配置</li>
<li>语言支持:<ul>
<li>Node.JS</li>
<li>PHP</li>
<li>Java</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;envId&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"function"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-function"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">            <span class="comment">// 函数根目录</span></span><br><span class="line">          <span class="string">"functionRootPath"</span>: <span class="string">"./cloudfunctions"</span>,</span><br><span class="line">          <span class="string">"publishIncludeList"</span>: <span class="string">"&#123;&#123;env.publishIncludeList&#125;&#125;"</span>,</span><br><span class="line">          <span class="comment">// 云函数默认配置, 配置格式和单个函数配置格式相同</span></span><br><span class="line">          <span class="string">"functionDefaultConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"timeout"</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">              <span class="string">"FOO"</span>: <span class="string">"bar"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"runtime"</span>: <span class="string">"Nodejs10.15"</span>,</span><br><span class="line">            <span class="string">"memorySize"</span>: <span class="number">128</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 函数配置数组，每个函数的配置格式要求如下：</span></span><br><span class="line">          <span class="string">"functions"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 云函数名称，即为函数部署后的名称</span></span><br><span class="line">              <span class="string">"name"</span>: <span class="string">"helloworld"</span>,</span><br><span class="line">              <span class="string">"envVariables"</span>: &#123;<span class="comment">// 包含环境变量的键值对对象</span></span><br><span class="line">                <span class="string">"ABC"</span>: <span class="string">"xyz"</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="comment">// 服务路径配置</span></span><br><span class="line">          <span class="string">"servicePaths"</span>: &#123;</span><br><span class="line">            <span class="string">"helloworld"</span>: <span class="string">"/helloworld"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="登录鉴权插件"><a href="#登录鉴权插件" class="headerlink" title="登录鉴权插件"></a>登录鉴权插件</h4><blockquote>
<p>云开发 CloudBase Framework 框架「登录配置」插件： 通过云开发 CloudBase Framework 框架一键设置环境下的登录配置。</p>
</blockquote>
<ul>
<li>支持未登录、匿名登录登录设置</li>
<li>后续会支持开放平台、公众号、账号密码等其他登录方式配置</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/framework/plugins/framework-plugin-auth</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"YOU_ENV_ID"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"auth"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-auth"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"configs"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"platform"</span>: <span class="string">"NONLOGIN"</span>,</span><br><span class="line">              <span class="string">"status"</span>: <span class="string">"ENABLE"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="云数据库插件"><a href="#云数据库插件" class="headerlink" title="云数据库插件"></a>云数据库插件</h4><blockquote>
<p>云开发 CloudBase Framework 框架「Database」插件： 通过云开发 CloudBase Framework 框架一键配置云开发数据库集合、索引，使用高性能的 Serverless 化的 NoSQL 数据库服务。可以搭配其他插件如 Website 插件、Node 插件实现云端一体开发。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/framework/plugins/framework-plugin-database</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;envId&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"client"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-database"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"collections"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"collectionName"</span>: <span class="string">"test-collection"</span>, <span class="comment">//集合名称</span></span><br><span class="line">              <span class="string">"description"</span>: <span class="string">"test"</span>, <span class="comment">// 描述信息</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="微信小程序插件"><a href="#微信小程序插件" class="headerlink" title="微信小程序插件"></a>微信小程序插件</h4><blockquote>
<p>云开发 CloudBase Framework 框架「小程序」插件： 通过云开发 CloudBase Framework 框架一键部署微信小程序应用。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/framework/plugins/framework-plugin-mp</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;envId&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"client"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-mp"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"appid"</span>: <span class="string">""</span>,<span class="comment">//必填，小程序应用的 appid</span></span><br><span class="line">          <span class="comment">//选填，小程序应用的部署私钥内容，需要经过 base64 编码 可以使用 小程序部署密钥转换小工具 来转换为 Base64</span></span><br><span class="line">          <span class="comment">// https://framework-1258016615.tcloudbaseapp.com/mp-key-tool/</span></span><br><span class="line">          <span class="string">"privateKeyPath"</span>: <span class="string">""</span>,</span><br><span class="line">          <span class="string">"localPath"</span>: <span class="string">"./"</span>,</span><br><span class="line">          <span class="string">"ignores"</span>: [<span class="string">"node_modules/**/*"</span>],</span><br><span class="line">          <span class="string">"deployMode"</span>: <span class="string">"preview"</span>,</span><br><span class="line">          <span class="string">"previewOptions"</span>: &#123;</span><br><span class="line">            <span class="string">"desc"</span>: <span class="string">"CloudBase Framework 一键预览"</span>,</span><br><span class="line">            <span class="string">"setting"</span>: &#123;</span><br><span class="line">              <span class="string">"es6"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"qrcodeOutputPath"</span>: <span class="string">"./qrcode.jpg"</span>,</span><br><span class="line">            <span class="string">"pagePath"</span>: <span class="string">"pages/index/index"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认模板的 appid 和 privateKeyPath 为空，需要开发者填入</p>
</blockquote>
<h4 id="Node-插件"><a href="#Node-插件" class="headerlink" title="Node 插件"></a>Node 插件</h4><blockquote>
<p>云开发 CloudBase Framework 框架「Node.js App」插件： 通过云开发 CloudBase Framework 框架将 Node 应用一键部署云开发环境，提供自动弹性伸缩的高性能 Node 应用服务，支持底层部署为函数或者 云托管，可以搭配其他插件如 Website 插件、函数插件实现云端一体开发。</p>
</blockquote>
<p><strong>功能特性</strong></p>
<ul>
<li>无须关心底层架构: 只需要开发业务服务，不用适配函数或者容器</li>
<li>节约成本: 资源伸缩，弹性扩缩容，灵活计费，极大节约资源成本</li>
<li>框架支持: 无缝支持原生和前端框架构建的项目<ul>
<li>原生 Node.js</li>
<li>Express</li>
<li>Koa</li>
</ul>
</li>
</ul>
<p>如果目前已有 Node 应用项目</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cloudbase</span><br></pre></td></tr></table></figure>
<p>如果想全新开始一个项目，可以直接执行 init 来从模板开始一个项目</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cloudbase init</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/framework/plugins/framework-plugin-node</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;envId&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"server"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-node"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">        <span class="comment">// 默认app.js</span></span><br><span class="line">        <span class="comment">// Node 服务入口文件，相对于projectPath,需要导出 app 或者 server 的实例，同时也支持导出异步获取 app 的 tcbGetApp 方法，方法的返回值为 app 或者 server 的实例。</span></span><br><span class="line">          <span class="string">"entry"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">          <span class="string">"path"</span>: <span class="string">"/nodeapp"</span>, <span class="comment">// 必填，访问子路径，如 /node-app</span></span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"nodeapp"</span>, <span class="comment">// 必填，服务名，如node-app</span></span><br><span class="line">          <span class="string">"projectPath"</span>: <span class="string">""</span>, <span class="comment">// 选填，指定 Node 服务所在目录，相对于当前项目根目录</span></span><br><span class="line">          <span class="string">"buildCommand"</span>: <span class="string">""</span>, <span class="comment">// 选填，指定构建命令，比如npm run build</span></span><br><span class="line">          <span class="string">"platform"</span>: <span class="string">""</span>, <span class="comment">// 选填，底层使用平台，支持 container（ 云托管） 和 function （云函数）, 默认是 function</span></span><br><span class="line">          <span class="string">"containerOptions"</span>: &#123;<span class="comment">// 选填，当 platform 选择 container 时，可以支持自定义更多高级设置，例如 CPU 内存等</span></span><br><span class="line">            <span class="string">"cpu"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="string">"mem"</span>: <span class="number">2</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"functionOptions"</span>: &#123;</span><br><span class="line">                <span class="string">"timeout"</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">                    <span class="string">"TEST_ENV"</span>: <span class="number">1</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"vpc"</span>: &#123;</span><br><span class="line">                    <span class="string">"vpcId"</span>: <span class="string">"xxx"</span>,</span><br><span class="line">                    <span class="string">"subnetId"</span>: <span class="string">"xxx"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>entry</code></li>
</ul>
<p>默认 <code>app.js</code></p>
<blockquote>
<p>Node 服务入口文件，相对于projectPath,需要导出 app 或者 server 的实例，同时也支持导出异步获取 app 的 tcbGetApp 方法，方法的返回值为 app 或者 server 的实例。</p>
</blockquote>
<p>如 koa 服务的 <code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; router &#125; = <span class="built_in">require</span>(<span class="string">'./routes/'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(router.routes());</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = app;</span><br></pre></td></tr></table></figure>
<p>nest 服务的 <code>app.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; NestFactory &#125; = <span class="built_in">require</span>(<span class="string">'@nestjs/core'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; ExpressAdapter &#125; = <span class="built_in">require</span>(<span class="string">'@nestjs/platform-express'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; AppModule &#125; = <span class="built_in">require</span>(<span class="string">'./dist/app.module'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> expressApp = express();</span><br><span class="line"><span class="keyword">const</span> adapter = <span class="keyword">new</span> ExpressAdapter(expressApp);</span><br><span class="line"></span><br><span class="line">exports.tcbGetApp = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create(AppModule, adapter);</span><br><span class="line">  <span class="keyword">await</span> app.init();</span><br><span class="line">  <span class="keyword">return</span> expressApp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="云托管容器插件"><a href="#云托管容器插件" class="headerlink" title="云托管容器插件"></a>云托管容器插件</h4><p><strong>功能特性</strong></p>
<ul>
<li>节约成本: 资源伸缩，弹性扩缩容，灵活计费，极大节约资源成本</li>
<li>极简配置：自动检测框架，无须配置</li>
<li>语言支持和框架支持广泛<ul>
<li>Node.JS</li>
<li>PHP</li>
<li>Java</li>
<li>Go</li>
<li>Dart</li>
<li>Deno</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://docs.cloudbase.net/framework/plugins/framework-plugin-container</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"&#123;&#123;envId&#125;&#125;"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"client"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-container"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"serviceName"</span>: <span class="string">"node-api"</span>, <span class="comment">// 必填，服务名，字符串格式，如 node-api</span></span><br><span class="line">          <span class="string">"servicePath"</span>: <span class="string">"/node-api"</span>,<span class="comment">// 必填，服务路径配置, 字符串格式, 如 /node-api</span></span><br><span class="line">          <span class="string">"localPath"</span>: <span class="string">"./"</span> <span class="comment">// 选填，本地代码文件夹相对于项目根目录的路径，默认值 ./</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-4-一键部署按钮制作"><a href="#5-4-一键部署按钮制作" class="headerlink" title="5.4 一键部署按钮制作"></a>5.4 一键部署按钮制作</h3><blockquote>
<p>参考 <a href="https://docs.cloudbase.net/framework/deploy-button" target="_blank" rel="noopener">https://docs.cloudbase.net/framework/deploy-button</a></p>
</blockquote>
<h3 id="5-5-云开发部署应用演示"><a href="#5-5-云开发部署应用演示" class="headerlink" title="5.5 云开发部署应用演示"></a>5.5 云开发部署应用演示</h3><blockquote>
<p>云开发部署模板参考：<a href="https://github.com/TencentCloudBase/cloudbase-templates" target="_blank" rel="noopener">https://github.com/TencentCloudBase/cloudbase-templates</a></p>
</blockquote>
<h4 id="云开发部署Egg"><a href="#云开发部署Egg" class="headerlink" title="云开发部署Egg"></a>云开发部署Egg</h4><blockquote>
<p>node插件文档 <a href="https://docs.cloudbase.net/framework/plugins/framework-plugin-node" target="_blank" rel="noopener">https://docs.cloudbase.net/framework/plugins/framework-plugin-node</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 初始化egg项目</span><br><span class="line">tcb new egg-demo</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/627d5a83ca20f2ae.png" alt></p>
<p><strong>编写cloudbaserc.json</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"test-xx"</span>,</span><br><span class="line">  <span class="string">"$schema"</span>: <span class="string">"https://framework-1258016615.tcloudbaseapp.com/schema/latest.json"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"egg-starter"</span>,</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"node"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-node"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"entry"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"egg-starter"</span>,</span><br><span class="line">          <span class="string">"path"</span>: <span class="string">"/egg-starter"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"functionRoot"</span>: <span class="string">"./functions"</span>,</span><br><span class="line">  <span class="string">"functions"</span>: [],</span><br><span class="line">  <span class="string">"region"</span>: <span class="string">"ap-guangzhou"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加启动入口文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Application &#125; = <span class="built_in">require</span>(<span class="string">'egg'</span>);</span><br><span class="line"></span><br><span class="line">exports.tcbGetApp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Application(&#123;</span><br><span class="line">    env: <span class="string">'prod'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>部署</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb framework deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/2f3e27804bd7105b.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/c2500d4d92e0da5e.png" alt></p>
<h4 id="云开发部署Koa"><a href="#云开发部署Koa" class="headerlink" title="云开发部署Koa"></a>云开发部署Koa</h4><blockquote>
<p>node插件文档 <a href="https://docs.cloudbase.net/framework/plugins/framework-plugin-node" target="_blank" rel="noopener">https://docs.cloudbase.net/framework/plugins/framework-plugin-node</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 初始化koa项目</span><br><span class="line">tcb new koa-demo</span><br></pre></td></tr></table></figure>
<p><strong>编写cloudbaserc.json</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"test-xxx"</span>,</span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"koa-starter"</span>,</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"node"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-node"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"name"</span>: <span class="string">"koa-starter"</span>,</span><br><span class="line">          <span class="string">"path"</span>: <span class="string">"/koa-starter"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"functionRoot"</span>: <span class="string">"./functions"</span>,</span><br><span class="line">  <span class="string">"functions"</span>: [],</span><br><span class="line">  <span class="string">"region"</span>: <span class="string">"ap-guangzhou"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>修改<code>app.js</code>，导出 <code>module.exports = app</code></p>
</blockquote>
<p>部署</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb framework deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/e287aea2c9821cc4.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/966fc0e7f631cba5.png" alt></p>
<h4 id="云开发部署React"><a href="#云开发部署React" class="headerlink" title="云开发部署React"></a>云开发部署React</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 初始化react项目</span><br><span class="line">tcb new react-demo</span><br></pre></td></tr></table></figure>
<p><strong>编写cloudbaserc.json</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">  <span class="string">"envId"</span>: <span class="string">"test-xx"</span>,</span><br><span class="line">  <span class="string">"$schema"</span>: <span class="string">"https://framework-1258016615.tcloudbaseapp.com/schema/latest.json"</span>,</span><br><span class="line">  <span class="string">"functionRoot"</span>: <span class="string">"cloudfunctions"</span>, <span class="comment">// 云函数目录</span></span><br><span class="line">  <span class="string">"framework"</span>: &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"react-starter"</span>,</span><br><span class="line">    <span class="string">"plugins"</span>: &#123;</span><br><span class="line">      <span class="string">"client"</span>: &#123;</span><br><span class="line">        <span class="comment">// 插件文档 https://docs.cloudbase.net/framework/plugins/framework-plugin-website</span></span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-website"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"buildCommand"</span>: <span class="string">"npm run build"</span>,</span><br><span class="line">          <span class="string">"outputPath"</span>: <span class="string">"build"</span>,</span><br><span class="line">          <span class="string">"cloudPath"</span>: <span class="string">"/react-starter"</span>, <span class="comment">// 当前静态托管的 /react-starter 目录下</span></span><br><span class="line">          <span class="string">"envVariables"</span>: &#123;</span><br><span class="line">            <span class="string">"REACT_APP_ENV_ID"</span>: <span class="string">"&#123;&#123;env.ENV_ID&#125;&#125;"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"server"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-function"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"functionRootPath"</span>: <span class="string">"cloudfunctions"</span>,</span><br><span class="line">          <span class="string">"functions"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"name"</span>: <span class="string">"helloworld"</span>,</span><br><span class="line">              <span class="string">"timeout"</span>: <span class="number">5</span>,</span><br><span class="line">              <span class="string">"envVariables"</span>: &#123;&#125;,</span><br><span class="line">              <span class="string">"runtime"</span>: <span class="string">"Nodejs10.15"</span>,</span><br><span class="line">              <span class="string">"memory"</span>: <span class="number">256</span>,</span><br><span class="line">              <span class="string">"aclRule"</span>: &#123;</span><br><span class="line">                <span class="string">"invoke"</span>: <span class="literal">true</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">"auth"</span>: &#123;</span><br><span class="line">        <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-auth"</span>,</span><br><span class="line">        <span class="string">"inputs"</span>: &#123;</span><br><span class="line">          <span class="string">"configs"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"platform"</span>: <span class="string">"NONLOGIN"</span>,</span><br><span class="line">              <span class="string">"status"</span>: <span class="string">"ENABLE"</span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"functions"</span>: [],</span><br><span class="line">  <span class="string">"region"</span>: <span class="string">"ap-guangzhou"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>部署</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb framework deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/50d7e5c2d8654dff.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/ad02ca3fac62bdec.png" alt></p>
<h4 id="云开发部署Vue"><a href="#云开发部署Vue" class="headerlink" title="云开发部署Vue"></a>云开发部署Vue</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 初始化vue项目</span><br><span class="line">tcb new vue-demo</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/4af41bcbd091b686.png" alt></p>
<p><strong>编写cloudbaserc.json</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"envId"</span>: <span class="string">"test-xx"</span>,</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">    <span class="string">"$schema"</span>: <span class="string">"https://framework-1258016615.tcloudbaseapp.com/schema/latest.json"</span>,</span><br><span class="line">    <span class="string">"functionRoot"</span>: <span class="string">"./functions"</span>,</span><br><span class="line">    <span class="string">"functions"</span>: [],</span><br><span class="line">    <span class="string">"region"</span>: <span class="string">"ap-guangzhou"</span>, <span class="comment">// 默认是ap-shanghai</span></span><br><span class="line">    <span class="string">"framework"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"vue-hello-world"</span>,</span><br><span class="line">        <span class="string">"plugins"</span>: &#123;</span><br><span class="line">            <span class="string">"vue"</span>: &#123;</span><br><span class="line">                <span class="comment">// 插件文档 https://docs.cloudbase.net/framework/plugins/framework-plugin-website</span></span><br><span class="line">                <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-website"</span>,</span><br><span class="line">                <span class="string">"inputs"</span>: &#123;</span><br><span class="line">                    <span class="string">"buildCommand"</span>: <span class="string">"npm run build"</span>,</span><br><span class="line">                    <span class="string">"outputPath"</span>: <span class="string">"dist"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>部署</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb framework deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/c34f69c797a05e2b.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/569a41e7e44d4911.png" alt></p>
<h4 id="部署hexo"><a href="#部署hexo" class="headerlink" title="部署hexo"></a>部署hexo</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 初始化hexo项目</span><br><span class="line">tcb new hexo-demo</span><br></pre></td></tr></table></figure>
<p><strong>编写cloudbaserc.json</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"envId"</span>: <span class="string">"poetry-xx"</span>,</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">    <span class="string">"$schema"</span>: <span class="string">"https://framework-1258016615.tcloudbaseapp.com/schema/latest.json"</span>,</span><br><span class="line">    <span class="string">"functionRoot"</span>: <span class="string">"./functions"</span>,</span><br><span class="line">    <span class="string">"functions"</span>: [],</span><br><span class="line">    <span class="string">"region"</span>: <span class="string">"ap-guangzhou"</span>, <span class="comment">// 默认是ap-shanghai</span></span><br><span class="line">    <span class="string">"framework"</span>: &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"hexo-hello-world"</span>,</span><br><span class="line">        <span class="string">"plugins"</span>: &#123;</span><br><span class="line">            <span class="string">"hexo"</span>: &#123;</span><br><span class="line">                <span class="comment">// 插件文档 https://docs.cloudbase.net/framework/plugins/framework-plugin-website</span></span><br><span class="line">                <span class="string">"use"</span>: <span class="string">"@cloudbase/framework-plugin-website"</span>,</span><br><span class="line">                <span class="string">"inputs"</span>: &#123;</span><br><span class="line">                    <span class="string">"buildCommand"</span>: <span class="string">"npx hexo generate"</span>,</span><br><span class="line">                    <span class="string">"outputPath"</span>: <span class="string">"./public"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>部署</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tcb framework deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/fb0f146a969d6506.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/f09f236c850cdbc6.png" alt></p>
<h2 id="六、使用云开发部署web应用"><a href="#六、使用云开发部署web应用" class="headerlink" title="六、使用云开发部署web应用"></a>六、使用云开发部署web应用</h2><h3 id="6-1-部署hexo"><a href="#6-1-部署hexo" class="headerlink" title="6.1 部署hexo"></a>6.1 部署hexo</h3><p><strong>使用 hexo 命令行初始化一个项目</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npx hexo init hexo-hello-world</span><br></pre></td></tr></table></figure>
<p><strong>部署项目</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tcb env list 查看环境列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署</span></span><br><span class="line">cloudbase framework deploy -e &lt;your-env-id&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/8a0f9b7b169f862a.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/2e99b96c91ea6bf4.png" alt></p>
<h3 id="6-2-部署Vue"><a href="#6-2-部署Vue" class="headerlink" title="6.2 部署Vue"></a>6.2 部署Vue</h3><p><strong>初始化项目</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npx vue create vue-hello-world</span><br></pre></td></tr></table></figure>
<p><strong>发布项目</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># tcb env list 查看环境列表</span><br><span class="line"></span><br><span class="line"># 部署</span><br><span class="line">tcb framework deploy -e &lt;your-env-id&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/bc8ba28de42ff604.png" alt></p>
<h2 id="七、在云开发中使用NoSQL数据库"><a href="#七、在云开发中使用NoSQL数据库" class="headerlink" title="七、在云开发中使用NoSQL数据库"></a>七、在云开发中使用NoSQL数据库</h2><blockquote>
<p>在面板上创建一个<code>NoSQL</code>的数据库，<a href="https://docs.cloudbase.net/database/introduce" target="_blank" rel="noopener">参考地址</a></p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/fd5954cd15c3e0e9.png" alt></p>
<blockquote>
<p>在项目中安装连接数据库的<code>SDK</code><a href="https://docs.cloudbase.net/api-reference/server/node-sdk/introduction" target="_blank" rel="noopener">参考文档</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install @cloudbase/node-sdk</span><br></pre></td></tr></table></figure>
<blockquote>
<p>初始化数据库连接<a href="https://docs.cloudbase.net/api-reference/server/node-sdk/initialization" target="_blank" rel="noopener">参考地址</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cloudbase <span class="keyword">from</span> <span class="string">'@cloudbase/node-sdk'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意以下几个参数是必填的,文档上说的是非必填</span></span><br><span class="line"><span class="keyword">const</span> app = cloudbase.init(&#123;</span><br><span class="line">    secretId: <span class="string">'xx'</span>,</span><br><span class="line">    secretKey: <span class="string">'yy'</span>,</span><br><span class="line">    env: <span class="string">'xx'</span>,</span><br><span class="line">    <span class="comment">// 根据你创建的区域来写,目前只有上海(ap-shanghai)、广州(ap-guangzhou)</span></span><br><span class="line">    region: <span class="string">'ap-shanghai'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 获取数据库引用</span></span><br><span class="line"><span class="keyword">const</span> db = app.database();</span><br></pre></td></tr></table></figure>
<p><code>env</code>的获取地址</p>
<p><img src="https://s.poetries.work/uploads/2022/06/45dad89cf73176e3.png" alt></p>
<p><code>secretId</code> 和<code>secretKey</code>获取：<a href="https://console.cloud.tencent.com/cam/capi" target="_blank" rel="noopener">https://console.cloud.tencent.com/cam/capi</a></p>
<p><img src="https://s.poetries.work/uploads/2022/06/8cab74708230b661.png" alt></p>
<h2 id="八、在VS-Code中使用Toolkit管理云开发项目"><a href="#八、在VS-Code中使用Toolkit管理云开发项目" class="headerlink" title="八、在VS Code中使用Toolkit管理云开发项目"></a>八、在VS Code中使用Toolkit管理云开发项目</h2><h3 id="8-1-基本使用介绍"><a href="#8-1-基本使用介绍" class="headerlink" title="8.1 基本使用介绍"></a>8.1 基本使用介绍</h3><blockquote>
<p>Tencent CloudBase Toolkit 是腾讯云 - 云开发发布的 VS Code（Visual Studio Code）插件。该插件可以让您更好地在本地进行云开发项目开发和代码调试，并且轻松将项目部署到云端。</p>
</blockquote>
<p><strong>通过 Tencent CloudBase Toolkit 插件，您可以：</strong></p>
<ul>
<li>在本地快速创建云开发项目</li>
<li>从多种模板快速创建云函数</li>
<li>同步云端的云函数列表，并下载函数代码到本地</li>
<li>部署云函数到云端，并进行云端安装依赖</li>
<li>对云函数进行管理，如删除云函数、查看云函数详细信息</li>
<li>增量更新云函数文件</li>
<li>删除云端的云函数文件</li>
<li>部署静态托管文件到云端</li>
</ul>
<p>同时，VS Code 插件也支持了云函数本地调试与云端调试，帮助你快速定位代码问题</p>
<p><img src="https://s.poetries.work/uploads/2022/06/b09bcd56a8afaba5.png" alt></p>
<p><strong>登录</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/79fedf80af936261.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/d64d37ed50ab8a11.png" alt></p>
<p><strong>创建新项目</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/8398b4d1b46da096.png" alt></p>
<blockquote>
<p><strong>注意</strong>：<code>CloudBase Toolkit</code> 插件依赖于 <code>cloudbaserc.json</code> 配置文件，<code>只有当前项目的根目录下存在 cloudbaserc.json 配置文件时</code>，才能使用 <code>CloudBase Toolkit</code> 插件进行相关操作。</p>
</blockquote>
<p>如果您还没有云开发项目，可以使用初始化操作创建一个全新的云开发项目，CloudBase Toolkit 提供了部分模板项目供选择。</p>
<blockquote>
<p><code>打开一个空的文件夹作为根目录</code>，点击侧边栏的云开发图标，点击下图示例中的条目</p>
</blockquote>
<ul>
<li>选择地区</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/6e62d9caf3ead536.png" alt></p>
<ul>
<li>选择地区关联的环境ID</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/c0077a6f7d345269.png" alt></p>
<ul>
<li>选择对应的模板</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/2fe16d3cb23b86fe.png" alt></p>
<ul>
<li>项目创建成功</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/c274c86297e0037e.png" alt></p>
<ul>
<li>项目目录结构</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/d0ea2cb4f67df0a8.png" alt></p>
<blockquote>
<p>VS Code 插件会默认使用当前窗口打开文件夹的根目录下的 <code>cloudbaserc.json</code> 配置文件，如果你使用了 VS Code 工作区，则会使用工作区中的第一个项目文件夹根目录下的配置文件</p>
</blockquote>
<p>关于 <code>cloudbaserc.json</code> <a href="https://docs.cloudbase.net/cli-v1/config" target="_blank" rel="noopener">配置文件的详情可以参考这里 🔗</a></p>
<ul>
<li>以上操作可以使用<code>tcb framework deploy</code>一键部署</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 函数和静态网站一起部署</span><br><span class="line">tcb framework deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/7841d0aab3b6def2.png" alt></p>
<h3 id="8-2-云函数操作"><a href="#8-2-云函数操作" class="headerlink" title="8.2 云函数操作"></a>8.2 云函数操作</h3><blockquote>
<p>对云函数进行<code>部署/删除/下载</code>代码等操作时，<code>必须选中云函数文件夹</code>，否则会因为无法解析到准确的函数名称，而导致操作失败。</p>
</blockquote>
<p>右键选中函数文件夹，点击部署云函数即可。CloudBase Toolkit 支持同时选择多个云函数进行部署。</p>
<p><strong>CloudBase Toolkit 支持两种部署云函数的方式：</strong></p>
<ul>
<li>部署云函数（上传全部文件）：即将函数目录下的所有文件上传，也包含 <code>node_modules</code> 目录</li>
<li>部署云函数（云端安装依赖）：只部署代码文件，会忽略 <code>node_modules</code> 目录，云函数会自动在线安装依赖</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/7164c1d025fed2f2.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/f6436c7624819c45.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/27161771a757fa8c.png" alt></p>
<ul>
<li>查看函数配置信息</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/fd07b75bb7e5dfb9.png" alt></p>
<p><strong>下载函数代码</strong></p>
<p>使用下载函数代码功能，可以将云端函数代码下载到本地，进行操作时，需要选择云函数名称对应的目录。CloudBase Toolkit 支持同时选择多个云函数，下载云函数代码。</p>
<p><img src="https://s.poetries.work/uploads/2022/06/715c72c283832c56.png" alt></p>
<p><strong>增量更新</strong></p>
<p>CloudBase Toolkit 支持上传单个文件或文件夹到云函数中，而无需重新上传整个云函数</p>
<p><img src="https://s.poetries.work/uploads/2022/06/b474aafabd470e8e.png" alt></p>
<h3 id="8-3-静态网站"><a href="#8-3-静态网站" class="headerlink" title="8.3 静态网站"></a>8.3 静态网站</h3><blockquote>
<p>CloudBase Toolkit 支持上传文件/文件夹到静态网站存储中，同时支持文件多选，既可以同时选择多个文件上传。</p>
</blockquote>
<p>CloudBase Toolkit 提供了两种上传方法：</p>
<ul>
<li>上传到静态托管：需要输入云端存放文件（夹）的文件夹路径，选中的文件（夹）将被上传到此路径下。</li>
<li>上传到静态托管（根目录）：选中的文件（夹）将被直接上传到根目录下</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/5fda60ae03e5f96c.png" alt></p>
<h2 id="九、cloudBase之CMS内容管理系统"><a href="#九、cloudBase之CMS内容管理系统" class="headerlink" title="九、cloudBase之CMS内容管理系统"></a>九、cloudBase之CMS内容管理系统</h2><blockquote>
<ul>
<li>文档：<a href="https://docs.cloudbase.net/cms/intro" target="_blank" rel="noopener">https://docs.cloudbase.net/cms/intro</a></li>
<li>Github：<a href="https://github.com/TencentCloudBase/cloudbase-extension-cms" target="_blank" rel="noopener">https://github.com/TencentCloudBase/cloudbase-extension-cms</a></li>
</ul>
</blockquote>
<ul>
<li>CloudBase CMS 是云开发推出的，基于 Node.js 的 Headless 内容管理平台，提供了丰富的内容管理功能。CloudBase CMS 基于模型配置，动态生成内容管理界面，无须编写代码即可使用，快速管理云开发中的业务数据。支持字符串、数字、多媒体、图片、文件、富文本、Markdown、关联类型等数十种内容类型的可视化编辑。</li>
<li>CloudBase CMS 已在腾讯云扩展应用、小程序开发者工具中上线，支持一键安装到已有的环境中，管理小程序 / Web 等多端产生的内容数据。</li>
<li>同时，CloudBase CMS 已经在 GitHub 开源，可以直接在 CloudBase CMS 上进行二次开发，满足业务的多样化需求。</li>
</ul>
<blockquote>
<p>使用 CMS 扩展时将在当前环境创建云函数、云数据库等资源</p>
</blockquote>
<p>工作原理</p>
<p><img src="https://s.poetries.work/uploads/2022/06/eb1db5b08062b46c.png" alt></p>
<h3 id="9-1-控制台部署CMS"><a href="#9-1-控制台部署CMS" class="headerlink" title="9.1 控制台部署CMS"></a>9.1 控制台部署CMS</h3><blockquote>
<p>环境需要使用按量付费</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/f475b1efc04f182a.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/fa0e23cb97283134.png" alt></p>
<p>安装完成可以看到已经部署好的云函数、静态资源、云数据库</p>
<p><img src="https://s.poetries.work/uploads/2022/06/0078ed499a50ee78.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/ae2ae82d69b699f2.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/eb3ef08b8ab0bc95.png" alt></p>
<p>登录部署的CMS界面操作演示</p>
<p><img src="https://s.poetries.work/uploads/2022/06/b00248881e212a34.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/1ff5d829ce888659.png" alt></p>
<p><img src="https://s.poetries.work/uploads/2022/06/a4850b81e9666030.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/5f57eee40dfb7381.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/f298c715b04eaf35.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/87fbb479196de69b.png" alt></p>
<h3 id="9-2-如有二次修改，我们可以使用源码方式部署"><a href="#9-2-如有二次修改，我们可以使用源码方式部署" class="headerlink" title="9.2 如有二次修改，我们可以使用源码方式部署"></a>9.2 如有二次修改，我们可以使用源码方式部署</h3><blockquote>
<ul>
<li>源码部署方式 <a href="https://docs.cloudbase.net/cms/install/source" target="_blank" rel="noopener">https://docs.cloudbase.net/cms/install/source</a></li>
<li>二次开发 <a href="https://docs.cloudbase.net/cms/reference/dev" target="_blank" rel="noopener">https://docs.cloudbase.net/cms/reference/dev</a></li>
</ul>
</blockquote>
<ul>
<li>安装 <code>npm install -g @cloudbase/cli@latest</code></li>
<li><a href="https://console.cloud.tencent.com/tcb/env/index?from=cli&amp;source=cloudbase-cms&amp;action=CreateEnv" target="_blank" rel="noopener">开通云开发服务，并创建按量计费环境</a></li>
</ul>
<h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><blockquote>
<p>下面是基本的目录结构，采用了 Monorepo 的组织规范，并使用 lerna 进行管理</p>
</blockquote>
<ul>
<li><code>admin</code>： 前端管理界面</li>
<li><code>cms-api</code>：<code>RESTful API</code> 服务</li>
<li><code>cms-init</code>：CMS 部署初始化相关脚本</li>
<li><code>service</code>：后端服务，提供系统管理相关的服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">├── community</span><br><span class="line">├── packages</span><br><span class="line">│   ├── admin</span><br><span class="line">│   │   ├── config</span><br><span class="line">│   │   ├── dist</span><br><span class="line">│   │   ├── public</span><br><span class="line">│   │   ├── src</span><br><span class="line">│   │   │   ├── assets</span><br><span class="line">│   │   │   ├── common</span><br><span class="line">│   │   │   ├── components</span><br><span class="line">│   │   │   ├── layout</span><br><span class="line">│   │   │   ├── locales</span><br><span class="line">│   │   │   ├── models</span><br><span class="line">│   │   │   ├── pages</span><br><span class="line">│   │   │   ├── services</span><br><span class="line">│   │   │   └── utils</span><br><span class="line">│   │   └── typings</span><br><span class="line">│   ├── cms-api</span><br><span class="line">│   │   ├── dist</span><br><span class="line">│   │   ├── src</span><br><span class="line">│   │   │   ├── api</span><br><span class="line">│   │   │   ├── common</span><br><span class="line">│   │   │   ├── guards</span><br><span class="line">│   │   │   ├── interceptors</span><br><span class="line">│   │   │   ├── middlewares</span><br><span class="line">│   │   │   ├── services</span><br><span class="line">│   │   │   └── utils</span><br><span class="line">│   │   └── typings</span><br><span class="line">│   ├── cms-init</span><br><span class="line">│   └── service</span><br><span class="line">│       ├── dist</span><br><span class="line">│       ├── src</span><br><span class="line">│       │   ├── common</span><br><span class="line">│       │   ├── config</span><br><span class="line">│       │   ├── decorators</span><br><span class="line">│       │   ├── guards</span><br><span class="line">│       │   ├── interceptors</span><br><span class="line">│       │   ├── middlewares</span><br><span class="line">│       │   ├── modules</span><br><span class="line">│       │   │   ├── auth</span><br><span class="line">│       │   │   ├── file</span><br><span class="line">│       │   │   ├── projects</span><br><span class="line">│       │   │   ├── role</span><br><span class="line">│       │   │   ├── setting</span><br><span class="line">│       │   │   └── user</span><br><span class="line">│       │   ├── services</span><br><span class="line">│       │   └── utils</span><br><span class="line">│       └── typings</span><br><span class="line">└── scripts</span><br></pre></td></tr></table></figure>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote>
<p>复制项目根目录下的 <code>.env.example</code> 为 <code>.env.local</code>，并填写相关的配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 您的云开发环境 Id</span></span><br><span class="line">TCB_ENVID=envId</span><br><span class="line"><span class="comment"># 管理员账户名，账号名长度需要大于 4 位，支持字母和数字</span></span><br><span class="line">administratorName=admin</span><br><span class="line"><span class="comment"># 管理员账号密码，8~32位，密码支持字母、数字、字符、不能由纯字母或存数字组成</span></span><br><span class="line">administratorPassword=123456</span><br><span class="line"><span class="comment"># CMS 控制台路径，如 /tcb-cms/，建议使用根路径 /</span></span><br><span class="line">deployPath=/</span><br><span class="line"><span class="comment"># 云接入自定义域名（选填），如 tencent.com</span></span><br><span class="line">accessDomain=</span><br><span class="line">TENCENTCLOUD_REGION=ap-guangzhou <span class="comment"># 环境ID所在的地区</span></span><br></pre></td></tr></table></figure>
<h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>在项目根目录下运行下面的命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install &amp;&amp; npm run setup</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果你使用 <code>npm run setup</code> 命令出现异常，你可以分别到 <code>packages</code> 目录下的文件内，手动执行 <code>npm install</code> 命令。</p>
</blockquote>
<p>在项目根目录下运行下面的命令，会将 <code>CloudBase CMS</code> 的管理控制台部署到静态网站，Node 服务部署到云函数中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run deploy</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/d937a67646160b02.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/39a38172b39daa80.png" alt></p>
<p><strong>控制台管理</strong></p>
<ul>
<li>我的应用</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/4f48480646204dd2.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/6742f2c96f05ad0e.png" alt></p>
<ul>
<li>云托管服务</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/ac2eddfa13237bd9.png" alt></p>
<blockquote>
<p><code>tcb-ext-cms-servic</code>：该服务提供登录鉴权功能，用户在 CMS 管理界面通过通过用户名和密码来进行登录时，会通过 HTTP 来请求该函数；提供 API 接口功能，所有对内容的操作和管理都会经过此函数调用，内容操作会根据用户权限来进行数据库操作。</p>
</blockquote>
<ul>
<li>管理云函数</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/107b9e3f346af8a5.png" alt></p>
<blockquote>
<ul>
<li><code>tcb-ext-cms-init</code>：提供初始化应用功能，安装扩展后，会通过该函数来进行静态资源的部署和密码的生成和设置，修改账号密码或者部署路径等扩展参数都会再次执行该函数来进行更新</li>
<li><code>tcb-ext-cms-api</code>：提供 <code>CMS RESTful API</code> 访问能力，所有 <code>RESTful API</code> 请求都会经过此函数调用</li>
</ul>
</blockquote>
<ul>
<li>云存储，存放静态网站</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/eaad8e647a753095.png" alt></p>
<blockquote>
<p>存储图片、文件等 CMS 系统上传的文件。</p>
</blockquote>
<ul>
<li>云数据库</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/4b866be7e0bf7cfe.png" alt></p>
<ul>
<li><code>tcb-ext-cms-projects</code> 集合：CMS 系统项目数据</li>
<li><code>tcb-ext-cms-schemas</code> 集合：CMS 系统内容配置数据，CMS 所有的系统内容类型配置、字段配置等信息都存储在该集合内</li>
<li><code>tcb-ext-cms-users</code> 集合：CMS 系统用户数据，存储 CMS 的用户信息，包括管理员和运营者的账号信息，包括角色信息等</li>
<li><code>tcb-ext-cms-webhooks</code> 集合： CMS 系统 webhook 集合，存储 CMS 系统的回调接口配置，CMS 系统数据的变更可以通过回调来进行同步。</li>
<li><code>tcb-ext-cms-user-roles</code> 集合：CMS 系统用户角色配置集合，存储 CMS 系统的自定义用户角色信息</li>
<li><code>tcb-ext-cms-settings</code> 集合：CMS 系统配置集合，存储 CMS 系统的设置</li>
</ul>
<h4 id="安装失败"><a href="#安装失败" class="headerlink" title="安装失败"></a>安装失败</h4><blockquote>
<p>请查看环境下云函数 <code>tcb-ext-cms-init</code> 的执行日志，获取失败原因。CloudBase CMS 安装时需要使用 <code>tcb-ext-cms-init</code> 函数执行初始化的工作，当出现异常时，会导致安装失败。</p>
</blockquote>
<h4 id="本地开发"><a href="#本地开发" class="headerlink" title="本地开发"></a>本地开发</h4><ol>
<li>复制根目录下的 <code>.env.example</code> 为 <code>.env.local</code>，并根据文件中的内容进行配置</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 您的云开发环境 Id</span></span><br><span class="line">ENV_ID=envId</span><br><span class="line"><span class="comment"># 管理员账户名，账号名长度需要大于 4 位，支持字母和数字</span></span><br><span class="line">administratorName=admin</span><br><span class="line"><span class="comment"># 管理员账号密码，8~32位，密码支持字母、数字、字符、不能由纯字母或存数字组成</span></span><br><span class="line">administratorPassword=123456</span><br><span class="line"><span class="comment"># CMS 控制台路径，如 /tcb-cms/，建议使用根路径 /</span></span><br><span class="line">deployPath=/</span><br><span class="line"><span class="comment"># 云接入自定义域名（选填），如 tencent.com</span></span><br><span class="line">accessDomain=</span><br><span class="line">TENCENTCLOUD_REGION=ap-guangzhou <span class="comment"># 环境ID所在的地区</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>复制 <code>packages/service/.env.example</code> 为 <code>packages/service/.env.local</code>，并根据文件中的内容进行配置</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">TCB_ENVID=<span class="built_in">test</span>-xx <span class="comment"># 环境ID</span></span><br><span class="line">SECRETID=密钥ID <span class="comment"># 密钥ID</span></span><br><span class="line">SECRETKEY=密钥KEY <span class="comment"># 密钥KEY</span></span><br><span class="line">TENCENTCLOUD_REGION=ap-guangzhou <span class="comment"># 环境ID所在的地区</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>复制 <code>packages/admin/public/config.example.js</code> 为 <code>packages/admin/public/config.js</code>，并根据文件中的内容进行配置</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.TcbCmsConfig = &#123;</span><br><span class="line">  <span class="comment">// 可用区，默认上海，可选：ap-shanghai 或 ap-guangzhou</span></span><br><span class="line">  region: <span class="string">"ap-guangzhou"</span>,</span><br><span class="line">  <span class="comment">// 路由方式：hash 或 browser</span></span><br><span class="line">  history: <span class="string">"hash"</span>,</span><br><span class="line">  <span class="comment">// 环境 Id</span></span><br><span class="line">  envId: <span class="string">"test-9g9512mccb349a321275b"</span>,</span><br><span class="line">  <span class="comment">// 禁用通知</span></span><br><span class="line">  disableNotice: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 禁用帮助按钮</span></span><br><span class="line">  disableHelpButton: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 云接入默认域名/自定义域名 + 云接入路径，不带 https 协议符</span></span><br><span class="line">  <span class="comment">// https://console.cloud.tencent.com/tcb/env/access</span></span><br><span class="line">  <span class="comment">// 环境id+API密钥中的appid（https://console.cloud.tencent.com/cam/capi）</span></span><br><span class="line">  <span class="comment">// API密钥中的appid：1258157827</span></span><br><span class="line">  cloudAccessPath: <span class="string">'test-9g9512mccb349a321275b-1258157827.service.tcloudbase.com/tcb-ext-cms-service'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>添加安全域名，否则本地开发会报跨域错误</li>
</ol>
<p><img src="https://s.poetries.work/uploads/2022/06/c9c7dc7c0ebba705.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/c15711674e3c175d.png" alt></p>
<p><strong>安装依赖</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 安装 lerna 依赖</span><br><span class="line">npm install</span><br><span class="line"># 安装 package 依赖</span><br><span class="line">npm run setup</span><br></pre></td></tr></table></figure>
<p><strong>初始部署</strong></p>
<p>通过部署动作，触发初始化操作</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm run deploy</span><br></pre></td></tr></table></figure>
<p><strong>启动开发</strong></p>
<p>运行下面的命令，成功后，可以访问 <code>http://localhost:8000/</code> 打开 CMS 管理界面</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd packages/admin &amp;&amp; npm run dev</span><br><span class="line">cd packages/service &amp;&amp; npm run dev</span><br></pre></td></tr></table></figure>
<p><img src="https://s.poetries.work/uploads/2022/06/17ff255d213e43ac.png" alt></p>
<h4 id="微应用开发"><a href="#微应用开发" class="headerlink" title="微应用开发"></a>微应用开发</h4><p><strong>1. vue微应用接入</strong></p>
<blockquote>
<p>接入文档 <a href="https://docs.cloudbase.net/cms/microapp/dev" target="_blank" rel="noopener">https://docs.cloudbase.net/cms/microapp/dev</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 新建 Vue 微应用项目</span></span><br><span class="line">tcb new vue-app cms-microapp-vue</span><br></pre></td></tr></table></figure>
<ul>
<li>打包vue应用<code>npm run build</code></li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/065be64fc55c529a.png" alt></p>
<ul>
<li>上传微应用</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/ea112b0d249492c2.png" alt></p>
<p>新建</p>
<p><img src="https://s.poetries.work/uploads/2022/06/8c672f52136b621a.png" alt></p>
<p><img src="https://s.poetries.work/uploads/2022/06/710cbc17f21b8d93.png" alt></p>
<blockquote>
<p>上传成功后，可以在管理后台中查看</p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/534042fe753270f5.png" alt></p>
<ul>
<li>自定义菜单展示微应用</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/44a89633db979007.png" alt></p>
<ul>
<li>设置后，在关联的项目中可见</li>
</ul>
<p><img src="https://s.poetries.work/uploads/2022/06/48a0980a8ea7075a.png" alt></p>
<p><strong>2. react微应用接入</strong></p>
<blockquote>
<p>接入文档 <a href="https://docs.cloudbase.net/cms/microapp/dev" target="_blank" rel="noopener">https://docs.cloudbase.net/cms/microapp/dev</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 新建 React 微应用项目</span></span><br><span class="line">tcb new react-app cms-microapp-react</span><br></pre></td></tr></table></figure>
<h4 id="Resful-API-形式访问"><a href="#Resful-API-形式访问" class="headerlink" title="Resful API 形式访问"></a>Resful API 形式访问</h4><blockquote>
<p>文档 <a href="https://docs.cloudbase.net/cms/usage/restful/intro" target="_blank" rel="noopener">https://docs.cloudbase.net/cms/usage/restful/intro</a></p>
</blockquote>
<p><strong>在系统设置中开启API访问</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/359d527fd134c1a3.png" alt></p>
<p><img src="https://s.poetries.work/uploads/2022/06/a066957524d06f9d.png" alt></p>
<p><strong>在项目设置中的 API 访问 Tab 设置允许通过 RESTful API 访问</strong></p>
<p><img src="https://s.poetries.work/uploads/2022/06/19a698c8050fa3eb.png" alt></p>
<p>然后复制访问连接，在postman中访问查看效果</p>
<p><img src="https://s.poetries.work/uploads/2022/06/3fefbba31221042c.png" alt></p>
<p><strong>API鉴权访问</strong></p>
<p>在系统设置中开启API鉴权访问，并创建token</p>
<p><img src="https://s.poetries.work/uploads/2022/06/26f7c1f886045461.png" alt></p>
<p>提示需要接口授权才可以访问</p>
<p><img src="https://s.poetries.work/uploads/2022/06/33b9b9370a87a245.png" alt></p>
<p>在请求头加入创建好的token即可</p>
<blockquote>
<p>当使用 API Token 调用 RESTful API 时，需要在 HTTP 请求 <code>Header</code> 中添加下面的配置</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Authorization: Bearer API_TOKEN</span><br></pre></td></tr></table></figure>
<p><code>API_Token</code> 为在系统设置中生成的 <code>Token</code>，<code>Bearer</code> 为固有字段，两者通过空格连接。</p>
<p><img src="https://s.poetries.work/uploads/2022/06/e083278e128641d0.png" alt></p>
<p><img src="https://s.poetries.work/uploads/2022/06/2baff45a779d611a.png" alt></p>
<h3 id="9-3-微信开发者工具部署"><a href="#9-3-微信开发者工具部署" class="headerlink" title="9.3 微信开发者工具部署"></a>9.3 微信开发者工具部署</h3><blockquote>
<p>参考 <a href="https://docs.cloudbase.net/cms/install/mp" target="_blank" rel="noopener">https://docs.cloudbase.net/cms/install/mp</a></p>
</blockquote>
<p><img src="https://s.poetries.work/uploads/2022/06/4ba6ed3a0a6541da.png" alt><br><img src="https://s.poetries.work/uploads/2022/06/81875bb480c85e7d.png" alt></p>
<h2 id="十、云开发部署腾讯微搭低代码"><a href="#十、云开发部署腾讯微搭低代码" class="headerlink" title="十、云开发部署腾讯微搭低代码"></a>十、云开发部署腾讯微搭低代码</h2><blockquote>
<p>文档地址 <a href="https://docs.cloudbase.net/lowcode/introduce" target="_blank" rel="noopener">https://docs.cloudbase.net/lowcode/introduce</a></p>
</blockquote>
<p>控制台 <a href="https://console.cloud.tencent.com/lowcode/overview/index" target="_blank" rel="noopener">https://console.cloud.tencent.com/lowcode/overview/index</a></p>
<h2 id="十一、参考文档"><a href="#十一、参考文档" class="headerlink" title="十一、参考文档"></a>十一、参考文档</h2><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://cloudbase.net/" target="_blank" rel="noopener">云开发 CloudBase 云原生一体化应用开发平台，快速构建小程序、Web、移动应用</a></li>
<li><a href="https://docs.cloudbase.net/database/introduce" target="_blank" rel="noopener">云开发 CloudBase文档</a></li>
<li><a href="https://cloud.tencent.com/document/product/876" target="_blank" rel="noopener">云开发 CloudBase官方文档</a></li>
<li><a href="https://docs.cloudbase.net/cli-v1/quick-start" target="_blank" rel="noopener">CloudBase CLI</a></li>
<li><a href="https://cloud.tencent.com/document/product/876/46332" target="_blank" rel="noopener">CloudBase SDK</a></li>
<li><a href="https://www.cloudbase.net/marketplace.html" target="_blank" rel="noopener">CloudBase 应用中心拥有各类热门应用，以及大量的生产级项目模板，案例模板，开发者可以自由选择，并将项目一键部署到云开发</a></li>
<li><a href="https://github.com/TencentCloudBase/cloudbase-action" target="_blank" rel="noopener">云开发 Tencent CloudBase Github Action 可以将 Github 项目自动部署到云开发环境</a></li>
<li><a href="https://github.com/Tencent/cloudbase-framework/tree/master/packages/framework-plugin-container" target="_blank" rel="noopener">cloudbase-framework-github</a></li>
<li><a href="https://github.com/TencentCloudBase" target="_blank" rel="noopener">Tencent CloudBase Github</a></li>
<li><a href="https://docs.cloudbase.net/cli-v1/config" target="_blank" rel="noopener">cloudbaserc.json 配置文件</a></li>
<li><a href="https://docs.cloudbase.net/cloudbase-ui/introduce" target="_blank" rel="noopener">云开发 React UI 组件 是云开发官方维护的 UI 组件库，提供基于云开发封装的一系列能力，目前已支持统一登录能力</a></li>
<li><a href="https://docs.cloudbase.net/cloudbase-vue/introduce" target="_blank" rel="noopener">云开发 Vue 插件是云开发官方维护的 Vue 插件，提供全局入口、Vue 逻辑组件等功能</a></li>
<li><a href="https://docs.cloudbase.net/api-reference/server/node-sdk/introduction" target="_blank" rel="noopener">Cloudbase Server Node.js SDK 让您可以在服务端（如腾讯云云函数或 云主机 等）使用 Node.js 服务访问 TCB 的的服务，如云函数调用，文件上传下载，数据库集合文档操作等，方便快速搭建应用</a></li>
<li><a href="https://docs.cloudbase.net/api-reference/webv2/initialization" target="_blank" rel="noopener">@cloudbase/js-sdk 让您可以在 Web 端（如 PC Web 页面、微信公众平台 H5 等）使用 JavaScript 访问 Cloudbase 服务和资源</a></li>
<li><a href="https://docs.cloudbase.net/cms/intro" target="_blank" rel="noopener">CloudBase CMS 是云开发推出的，基于 Node.js 的 Headless 内容管理平台，提供了丰富的内容管理功能</a></li>
<li><a href="https://webify.cloudbase.net/" target="_blank" rel="noopener">云开发 Webify：专为 Web 开发者打造的应用托管平台，极速开发、部署、上线</a></li>
<li><a href="https://github.com/TencentCloudBase/cloudbase-templates" target="_blank" rel="noopener">云开发工程模板示例，可通过 CloudBaseFramework 一键创建和部署</a></li>
<li><a href="https://framework-1258016615.tcloudbaseapp.com/mp-key-tool/" target="_blank" rel="noopener">微信小程序密钥工具</a></li>
</ul>
<h3 id="社区提问"><a href="#社区提问" class="headerlink" title="社区提问"></a>社区提问</h3><ul>
<li>「腾讯云·云开发」相关：<a href="https://support.qq.com/products/148793" target="_blank" rel="noopener">腾讯兔小巢</a> （云开发能力相关的首选这里）</li>
<li>「微信·云开发」相关：<a href="https://developers.weixin.qq.com/community/minihome/mixflow/1286298401038155776" target="_blank" rel="noopener">微信开放社区</a> （微信相关的都在这里问）</li>
<li>「微信·云托管」相关：<a href="https://developers.weixin.qq.com/community/minihome/mixflow/1919566493118201863" target="_blank" rel="noopener">微信开放社区</a> （云托管相关的都在这里问）</li>
</ul>

      </div>
    
  </div>

</article>

<!-- <button class="assist-btn2 circle" id="assist_btn2" title="点亮屏幕" style="left: 27px; top: 152px;">
  <i class="iconfont" style="display:inline-block;color:red;width:20px;height:20px;">&#xe61d;</i>
</button>
<button class="assist-btn1 circle" id="assist_btn1" title="关闭屏幕亮度" style="left: 27px; top: 152px;">
  <i class="iconfont toc-title" style="display:inline-block;color:red;width:20px;height:20px;">&#xe61d;</i>
</button> -->


<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>	

<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
  function getCookie(key) {
    if (document.cookie.length > 0) {
      var start = document.cookie.indexOf(key + "=");
      if (start !== -1) {
        start = start + key.length + 1;
        var end = document.cookie.indexOf(";", start);
        if (end === -1) end = document.cookie.length;
        return unescape(document.cookie.substring(start, end));
      }
    }
    return "";
  }
  const feToken = getCookie('fe-token');
  const btw = new BTWPlugin();
  console.log('ft', feToken)
  if(!feToken) {
    btw.init({
      id: "container",
      blogId: "22699-1592137983091-414",
      name: "前端进阶之旅",
      qrcode: "https://poetries1.gitee.io/img-repo/2020/06/qrcode.jpg",
      keyword: "3a3b3c",
    });
  }
</script>

<script type="text/javascript">

// white theme
var body = {color: "#555", background: "#000"};
var a_tag = {color: "#222"};
var header = { background: "#222"};
var logo_line_i = {background: "#222"};
// var post_code = {background: "#eee", color: "#222"};

function switch_theme() {
 $("body").css(body);
 $("a:not('.links-of-author-item a, .site-state-item a, .site-state-posts a, .feed-link a, .motion-element a, .post-tags a, .show-commit-cls a, #donate_board a')").css(a_tag);
 $(".header, .footer").css(header);
 $(".logo-line-before i, .logo-line-after i").css(logo_line_i);
 //$(".post code").css(post_code);
 $("#idhyt-surprise-ball #idhyt-surprise-ball-animation .drag").css(a_tag);
 $(".post-title-link, .posts-expand .post-meta, .post-comments-count, .disqus-comment-count, .post-category a, .post-nav-next a, .post-nav-item a").css(a_tag);
 
 // $("code").css({color: '#c5c8c6', background: '#1d1f21'});
 //$("#assist_btn1").hide(1500);
}

$(function () {
$("#assist_btn2").css("display","none");
 $("#assist_btn1").click(function() {
     switch_theme();
$("div#toc.toc-article").css({
 "background":"#eaeaea",
 "opacity":1
});
$(".toc-article ol").show();
$("#toc.toc-article .toc-title").css("color","#a98602");
$("#assist_btn1").css("display","none");
$("#assist_btn2").css("display","block");
 });
$("#assist_btn2").click(function() {
$("#assist_btn2").css("display","none");
$("#assist_btn1").css("display","block");
$("body").css("background","url(http://www.miaov.com/static/ie/images/news/bg.png)")
     $(".header, .footer").css("background","url(http://www.miaov.com/static/ie/images/news/bg.png)")
$(".toc-article ol").toggle(1000);
 });
});


//背景随机

var Y, O, E, L, B, C, T, z, N, S, A, I;
!function() {
var e = function() {
for (O.clearRect(0, 0, L, B), T = [{
x: 0,
y: .7 * B + C
}, {
x: 0,
y: .7 * B - C
}]; T[1].x < L + C;) t(T[0], T[1])
}, t = function(e, t) {
O.beginPath(), O.moveTo(e.x, e.y), O.lineTo(t.x, t.y);
var n = t.x + (2 * I() - .25) * C,
 r = a(t.y);
O.lineTo(n, r), O.closePath(), N -= S / -50, O.fillStyle = "#" + (127 * A(N) + 128 << 16 | 127 * A(N + S / 3) + 128 << 8 | 127 * A(N + S / 3 * 2) + 128).toString(16), O.fill(), T[0] = T[1], T[1] = {
 x: n,
 y: r
}
}, a = function n(e) {
var t = e + (2 * I() - 1.1) * C;
return t > B || t < 0 ? n(e) : t
};
Y = document.getElementById("evanyou"), O = Y.getContext("2d"), E = window.devicePixelRatio || 1, L = window.innerWidth, B = window.innerHeight, C = 90, z = Math, N = 0, S = 2 * z.PI, A = z.cos, I = z.random, Y.width = L * E, Y.height = B * E, O.scale(E, E), O.globalAlpha = .6, document.onclick = e, document.ontouchstart = e, e()
}()

   
$("#toc-eye").click(function(){
$("#toc.toc-article").toggle(1000);
});

</script>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持poetries</div>
        <ul>
        
          <li class="item">
            
              <span>微信扫一扫</span>
            
            <img src="/images/weixin.jpg" alt="">
          </li>
        
          <li class="item">
            
              <span>支付宝扫一扫</span>
            
            <img src="/images/zhifubao.jpg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2022/06/19/wxcloud-intro/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2022/06/30/linux-summary/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/categories/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

<!-- Gitalk评论插件通用代码 -->
<div id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
const gitalk = new Gitalk({
  clientID: '5567a2c4abb858009d96',
  clientSecret: 'b9039ec056cf5c2346b3cdb63308a28c163f91e5',
  repo: 'poetries.github.io',
  owner: 'poetries',
  // 在这里设置一下截取前50个字符串, 这是因为 github 对 label 的长度有了要求, 如果超过
  // 50个字符串则会报错.
  // id: location.pathname.split('/').pop().substring(0, 49),
  id: location.pathname,
  admin: ['poetries'],
  // facebook-like distraction free mode
  distractionFreeMode: false
})
gitalk.render('gitalk-container')
</script>
<!-- Gitalk代码结束 -->



  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>


  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/clicklove.js"></script>
 
  
</body>
</html>
